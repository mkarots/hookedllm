
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Async-first, scoped hook system for LLM observability with SOLID/DI architecture">
      
      
        <meta name="author" content="Michael Karotsieris">
      
      
        <link rel="canonical" href="https://cepstrumlabs.github.io/hookedllm/api/">
      
      
        <link rel="prev" href="../guides/error-handling/">
      
      
        <link rel="next" href="../contributing/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>API Reference - HookedLLM</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="HookedLLM" class="md-header__button md-logo" aria-label="HookedLLM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HookedLLM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/CepstrumLabs/hookedllm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    CepstrumLabs/hookedllm
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../quick-start/" class="md-tabs__link">
        
  
  
    
  
  Quick Start

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../scopes/" class="md-tabs__link">
          
  
  
  Core Concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../examples/basic-usage/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../guides/dependency-injection/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../advanced-setup/" class="md-tabs__link">
          
  
  
  Advanced Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="HookedLLM" class="md-nav__button md-logo" aria-label="HookedLLM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    HookedLLM
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/CepstrumLabs/hookedllm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    CepstrumLabs/hookedllm
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scopes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scopes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/basic-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic Usage Example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/scopes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scopes Example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/advanced/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced Examples
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/travel-assistant/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Travel Assistant Example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/dependency-injection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dependency Injection Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Advanced Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Advanced Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced Setup Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lifecycle &amp; Concurrency Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observability Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/error-handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#main-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        Main Module
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hookedllm" class="md-nav__link">
    <span class="md-ellipsis">
      
        hookedllm
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hookedllm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm--register-hooks-to-scopes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Register hooks to scopes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm--wrap-client-with-scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        Wrap client with scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm--use-normally-hooks-auto-execute" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use normally - hooks auto-execute!
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.DefaultHookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        DefaultHookExecutor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DefaultHookExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.DefaultHookExecutor-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.DefaultHookExecutor.execute_after" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.DefaultHookExecutor.execute_before" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.DefaultHookExecutor.execute_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.DefaultHookExecutor.execute_finally" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_finally
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookedLLMContext
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HookedLLMContext">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.after" class="md-nav__link">
    <span class="md-ellipsis">
      
        after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.before" class="md-nav__link">
    <span class="md-ellipsis">
      
        before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.error" class="md-nav__link">
    <span class="md-ellipsis">
      
        error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.finally_" class="md-nav__link">
    <span class="md-ellipsis">
      
        finally_
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.global_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        global_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.wrap" class="md-nav__link">
    <span class="md-ellipsis">
      
        wrap
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.InMemoryScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeRegistry
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="InMemoryScopeRegistry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.InMemoryScopeRegistry-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.InMemoryScopeRegistry.get_global_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_global_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.InMemoryScopeRegistry.get_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.InMemoryScopeRegistry.get_scopes_for_client" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scopes_for_client
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.InMemoryScopeRegistry.scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        scope
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.after" class="md-nav__link">
    <span class="md-ellipsis">
      
        after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.before" class="md-nav__link">
    <span class="md-ellipsis">
      
        before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.create_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_context
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.error" class="md-nav__link">
    <span class="md-ellipsis">
      
        error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.finally_" class="md-nav__link">
    <span class="md-ellipsis">
      
        finally_
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.wrap" class="md-nav__link">
    <span class="md-ellipsis">
      
        wrap
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config" class="md-nav__link">
    <span class="md-ellipsis">
      
        config
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.HookConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.RootConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        RootConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.ScopeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.WhenConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        WhenConfig
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.load_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_config
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.loader" class="md-nav__link">
    <span class="md-ellipsis">
      
        loader
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        schema
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core" class="md-nav__link">
    <span class="md-ellipsis">
      
        core
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallContext" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallContext
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallInput" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallInput
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallOutput" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallOutput
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallResult" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallResult
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CompositeRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        CompositeRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CustomRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        CustomRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        DefaultHookExecutor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookExecutor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookedClientWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookedClientWrapper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeHookStore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeRegistry
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Message" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.MetadataRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetadataRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ModelRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        ModelRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.NotRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        NotRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      
        RuleBuilder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeHookStore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeRegistry
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.TagRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        TagRule
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.executor" class="md-nav__link">
    <span class="md-ellipsis">
      
        executor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols" class="md-nav__link">
    <span class="md-ellipsis">
      
        protocols
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        rules
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.scopes" class="md-nav__link">
    <span class="md-ellipsis">
      
        scopes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types" class="md-nav__link">
    <span class="md-ellipsis">
      
        types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        wrapper
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        hooks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hooks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.EvaluationHook" class="md-nav__link">
    <span class="md-ellipsis">
      
        EvaluationHook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetricsHook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook--later-access-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Later, access metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      
        evaluation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.metrics.MetricsHook--later-access-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Later, access metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers" class="md-nav__link">
    <span class="md-ellipsis">
      
        providers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="providers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        ProviderAdapter
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.anthropic" class="md-nav__link">
    <span class="md-ellipsis">
      
        anthropic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.openai" class="md-nav__link">
    <span class="md-ellipsis">
      
        openai
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.protocol" class="md-nav__link">
    <span class="md-ellipsis">
      
        protocol
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Components
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hookedllm.core" class="md-nav__link">
    <span class="md-ellipsis">
      
        core
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallContext" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallContext
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallInput" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallInput
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallOutput" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallOutput
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallResult" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallResult
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CompositeRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        CompositeRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CustomRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        CustomRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        DefaultHookExecutor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DefaultHookExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor.execute_after" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor.execute_before" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor.execute_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor.execute_finally" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_finally
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookExecutor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HookExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor.execute_after" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor.execute_before" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor.execute_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor.execute_finally" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_finally
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookedClientWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookedClientWrapper
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HookedClientWrapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookedClientWrapper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookedClientWrapper.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __getattr__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeHookStore
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="InMemoryScopeHookStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Attributes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.name" class="md-nav__link">
    <span class="md-ellipsis">
      
        name
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.add_after" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.add_before" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.add_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.add_finally" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_finally
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.after" class="md-nav__link">
    <span class="md-ellipsis">
      
        after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.before" class="md-nav__link">
    <span class="md-ellipsis">
      
        before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.error" class="md-nav__link">
    <span class="md-ellipsis">
      
        error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.finally_" class="md-nav__link">
    <span class="md-ellipsis">
      
        finally_
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.get_after_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_after_hooks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.get_before_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_before_hooks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.get_error_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_error_hooks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.get_finally_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_finally_hooks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeRegistry
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="InMemoryScopeRegistry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry.get_global_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_global_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry.get_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry.get_scopes_for_client" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scopes_for_client
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry.scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        scope
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Message" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.MetadataRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetadataRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ModelRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        ModelRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.NotRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        NotRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rule
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule.__and__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __and__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule.__invert__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __invert__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule.__or__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __or__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule.matches" class="md-nav__link">
    <span class="md-ellipsis">
      
        matches
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      
        RuleBuilder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RuleBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder.always" class="md-nav__link">
    <span class="md-ellipsis">
      
        always
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder.custom" class="md-nav__link">
    <span class="md-ellipsis">
      
        custom
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder.model" class="md-nav__link">
    <span class="md-ellipsis">
      
        model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder.never" class="md-nav__link">
    <span class="md-ellipsis">
      
        never
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder.tag" class="md-nav__link">
    <span class="md-ellipsis">
      
        tag
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeHookStore
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ScopeHookStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.add_after" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.add_before" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.add_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.add_finally" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_finally
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.get_after_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_after_hooks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.get_before_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_before_hooks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.get_error_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_error_hooks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.get_finally_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_finally_hooks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeRegistry
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ScopeRegistry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeRegistry-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeRegistry.get_global_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_global_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeRegistry.get_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeRegistry.get_scopes_for_client" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scopes_for_client
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.TagRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        TagRule
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.executor" class="md-nav__link">
    <span class="md-ellipsis">
      
        executor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="executor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.executor-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.executor.DefaultHookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        DefaultHookExecutor
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols" class="md-nav__link">
    <span class="md-ellipsis">
      
        protocols
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="protocols">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols.HookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookExecutor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols.Rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols.ScopeHookStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeHookStore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols.ScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeRegistry
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        rules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.CompositeRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        CompositeRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.CustomRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        CustomRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.MetadataRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetadataRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.ModelRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        ModelRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.NotRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        NotRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.RuleBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      
        RuleBuilder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.TagRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        TagRule
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.scopes" class="md-nav__link">
    <span class="md-ellipsis">
      
        scopes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="scopes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.scopes-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.scopes.InMemoryScopeHookStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeHookStore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.scopes.InMemoryScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeRegistry
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types" class="md-nav__link">
    <span class="md-ellipsis">
      
        types
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types.CallContext" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallContext
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types.CallInput" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallInput
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types.CallOutput" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallOutput
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types.CallResult" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallResult
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types.Message" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        wrapper
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="wrapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.wrapper-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.wrapper.HookedClientWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookedClientWrapper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.wrapper.HookedCompletionsWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookedCompletionsWrapper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.wrapper.HookedPathWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookedPathWrapper
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hooks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hookedllm.hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        hooks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hooks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.EvaluationHook" class="md-nav__link">
    <span class="md-ellipsis">
      
        EvaluationHook
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EvaluationHook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.EvaluationHook-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.EvaluationHook.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __call__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetricsHook
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetricsHook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook--later-access-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Later, access metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Attributes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook.average_latency_ms" class="md-nav__link">
    <span class="md-ellipsis">
      
        average_latency_ms
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook.error_rate" class="md-nav__link">
    <span class="md-ellipsis">
      
        error_rate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook.success_rate" class="md-nav__link">
    <span class="md-ellipsis">
      
        success_rate
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __call__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook.reset" class="md-nav__link">
    <span class="md-ellipsis">
      
        reset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook.summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        summary
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      
        evaluation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.evaluation-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.evaluation.EvaluationHook" class="md-nav__link">
    <span class="md-ellipsis">
      
        EvaluationHook
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        metrics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.metrics-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.metrics.MetricsHook" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetricsHook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.metrics.MetricsHook--later-access-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Later, access metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hookedllm.config" class="md-nav__link">
    <span class="md-ellipsis">
      
        config
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.HookConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.RootConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        RootConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.ScopeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.WhenConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        WhenConfig
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.load_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_config
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.loader" class="md-nav__link">
    <span class="md-ellipsis">
      
        loader
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="loader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.loader-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.loader-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.loader.load_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_config
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        schema
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema.HookConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema.RootConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        RootConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema.ScopeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema.WhenConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        WhenConfig
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#providers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Providers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hookedllm.providers" class="md-nav__link">
    <span class="md-ellipsis">
      
        providers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="providers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        ProviderAdapter
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProviderAdapter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter.detect" class="md-nav__link">
    <span class="md-ellipsis">
      
        detect
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter.get_callable" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_callable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter.get_wrapper_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_wrapper_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter.normalize_input" class="md-nav__link">
    <span class="md-ellipsis">
      
        normalize_input
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter.normalize_output" class="md-nav__link">
    <span class="md-ellipsis">
      
        normalize_output
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.anthropic" class="md-nav__link">
    <span class="md-ellipsis">
      
        anthropic
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="anthropic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.anthropic-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.anthropic.AnthropicAdapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        AnthropicAdapter
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.openai" class="md-nav__link">
    <span class="md-ellipsis">
      
        openai
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="openai">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.openai-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.openai.OpenAIAdapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        OpenAIAdapter
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.protocol" class="md-nav__link">
    <span class="md-ellipsis">
      
        protocol
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="protocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.protocol-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.protocol.ProviderAdapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        ProviderAdapter
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#main-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        Main Module
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hookedllm" class="md-nav__link">
    <span class="md-ellipsis">
      
        hookedllm
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hookedllm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm--register-hooks-to-scopes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Register hooks to scopes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm--wrap-client-with-scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        Wrap client with scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm--use-normally-hooks-auto-execute" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use normally - hooks auto-execute!
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.DefaultHookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        DefaultHookExecutor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DefaultHookExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.DefaultHookExecutor-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.DefaultHookExecutor.execute_after" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.DefaultHookExecutor.execute_before" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.DefaultHookExecutor.execute_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.DefaultHookExecutor.execute_finally" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_finally
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookedLLMContext
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HookedLLMContext">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.after" class="md-nav__link">
    <span class="md-ellipsis">
      
        after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.before" class="md-nav__link">
    <span class="md-ellipsis">
      
        before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.error" class="md-nav__link">
    <span class="md-ellipsis">
      
        error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.finally_" class="md-nav__link">
    <span class="md-ellipsis">
      
        finally_
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.global_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        global_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.HookedLLMContext.wrap" class="md-nav__link">
    <span class="md-ellipsis">
      
        wrap
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.InMemoryScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeRegistry
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="InMemoryScopeRegistry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.InMemoryScopeRegistry-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.InMemoryScopeRegistry.get_global_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_global_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.InMemoryScopeRegistry.get_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.InMemoryScopeRegistry.get_scopes_for_client" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scopes_for_client
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.InMemoryScopeRegistry.scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        scope
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.after" class="md-nav__link">
    <span class="md-ellipsis">
      
        after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.before" class="md-nav__link">
    <span class="md-ellipsis">
      
        before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.create_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_context
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.error" class="md-nav__link">
    <span class="md-ellipsis">
      
        error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.finally_" class="md-nav__link">
    <span class="md-ellipsis">
      
        finally_
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.wrap" class="md-nav__link">
    <span class="md-ellipsis">
      
        wrap
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config" class="md-nav__link">
    <span class="md-ellipsis">
      
        config
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.HookConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.RootConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        RootConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.ScopeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.WhenConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        WhenConfig
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.load_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_config
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.loader" class="md-nav__link">
    <span class="md-ellipsis">
      
        loader
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        schema
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core" class="md-nav__link">
    <span class="md-ellipsis">
      
        core
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallContext" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallContext
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallInput" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallInput
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallOutput" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallOutput
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallResult" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallResult
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CompositeRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        CompositeRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CustomRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        CustomRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        DefaultHookExecutor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookExecutor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookedClientWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookedClientWrapper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeHookStore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeRegistry
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Message" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.MetadataRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetadataRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ModelRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        ModelRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.NotRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        NotRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      
        RuleBuilder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeHookStore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeRegistry
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.TagRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        TagRule
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.executor" class="md-nav__link">
    <span class="md-ellipsis">
      
        executor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols" class="md-nav__link">
    <span class="md-ellipsis">
      
        protocols
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        rules
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.scopes" class="md-nav__link">
    <span class="md-ellipsis">
      
        scopes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types" class="md-nav__link">
    <span class="md-ellipsis">
      
        types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        wrapper
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        hooks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hooks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.EvaluationHook" class="md-nav__link">
    <span class="md-ellipsis">
      
        EvaluationHook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetricsHook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook--later-access-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Later, access metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      
        evaluation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.metrics.MetricsHook--later-access-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Later, access metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers" class="md-nav__link">
    <span class="md-ellipsis">
      
        providers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="providers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        ProviderAdapter
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.anthropic" class="md-nav__link">
    <span class="md-ellipsis">
      
        anthropic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.openai" class="md-nav__link">
    <span class="md-ellipsis">
      
        openai
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.protocol" class="md-nav__link">
    <span class="md-ellipsis">
      
        protocol
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Components
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hookedllm.core" class="md-nav__link">
    <span class="md-ellipsis">
      
        core
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallContext" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallContext
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallInput" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallInput
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallOutput" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallOutput
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CallResult" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallResult
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CompositeRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        CompositeRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.CustomRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        CustomRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        DefaultHookExecutor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DefaultHookExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor.execute_after" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor.execute_before" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor.execute_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.DefaultHookExecutor.execute_finally" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_finally
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookExecutor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HookExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor.execute_after" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor.execute_before" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor.execute_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookExecutor.execute_finally" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute_finally
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookedClientWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookedClientWrapper
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HookedClientWrapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookedClientWrapper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.HookedClientWrapper.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __getattr__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeHookStore
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="InMemoryScopeHookStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Attributes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.name" class="md-nav__link">
    <span class="md-ellipsis">
      
        name
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.add_after" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.add_before" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.add_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.add_finally" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_finally
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.after" class="md-nav__link">
    <span class="md-ellipsis">
      
        after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.before" class="md-nav__link">
    <span class="md-ellipsis">
      
        before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.error" class="md-nav__link">
    <span class="md-ellipsis">
      
        error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.finally_" class="md-nav__link">
    <span class="md-ellipsis">
      
        finally_
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.get_after_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_after_hooks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.get_before_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_before_hooks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.get_error_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_error_hooks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeHookStore.get_finally_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_finally_hooks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeRegistry
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="InMemoryScopeRegistry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry.get_global_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_global_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry.get_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry.get_scopes_for_client" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scopes_for_client
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.InMemoryScopeRegistry.scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        scope
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Message" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.MetadataRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetadataRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ModelRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        ModelRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.NotRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        NotRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rule
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule.__and__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __and__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule.__invert__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __invert__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule.__or__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __or__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.Rule.matches" class="md-nav__link">
    <span class="md-ellipsis">
      
        matches
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      
        RuleBuilder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RuleBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder.always" class="md-nav__link">
    <span class="md-ellipsis">
      
        always
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder.custom" class="md-nav__link">
    <span class="md-ellipsis">
      
        custom
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder.model" class="md-nav__link">
    <span class="md-ellipsis">
      
        model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder.never" class="md-nav__link">
    <span class="md-ellipsis">
      
        never
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.RuleBuilder.tag" class="md-nav__link">
    <span class="md-ellipsis">
      
        tag
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeHookStore
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ScopeHookStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.add_after" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_after
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.add_before" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_before
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.add_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.add_finally" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_finally
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.get_after_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_after_hooks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.get_before_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_before_hooks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.get_error_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_error_hooks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeHookStore.get_finally_hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_finally_hooks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeRegistry
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ScopeRegistry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeRegistry-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeRegistry.get_global_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_global_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeRegistry.get_scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.ScopeRegistry.get_scopes_for_client" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scopes_for_client
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.TagRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        TagRule
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.executor" class="md-nav__link">
    <span class="md-ellipsis">
      
        executor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="executor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.executor-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.executor.DefaultHookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        DefaultHookExecutor
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols" class="md-nav__link">
    <span class="md-ellipsis">
      
        protocols
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="protocols">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols.HookExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookExecutor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols.Rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols.ScopeHookStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeHookStore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.protocols.ScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeRegistry
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        rules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.CompositeRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        CompositeRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.CustomRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        CustomRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.MetadataRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetadataRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.ModelRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        ModelRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.NotRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        NotRule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.RuleBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      
        RuleBuilder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.rules.TagRule" class="md-nav__link">
    <span class="md-ellipsis">
      
        TagRule
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.scopes" class="md-nav__link">
    <span class="md-ellipsis">
      
        scopes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="scopes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.scopes-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.scopes.InMemoryScopeHookStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeHookStore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.scopes.InMemoryScopeRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        InMemoryScopeRegistry
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types" class="md-nav__link">
    <span class="md-ellipsis">
      
        types
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types.CallContext" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallContext
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types.CallInput" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallInput
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types.CallOutput" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallOutput
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types.CallResult" class="md-nav__link">
    <span class="md-ellipsis">
      
        CallResult
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.types.Message" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        wrapper
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="wrapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.wrapper-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.wrapper.HookedClientWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookedClientWrapper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.wrapper.HookedCompletionsWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookedCompletionsWrapper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.core.wrapper.HookedPathWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookedPathWrapper
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hooks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hookedllm.hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        hooks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hooks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.EvaluationHook" class="md-nav__link">
    <span class="md-ellipsis">
      
        EvaluationHook
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EvaluationHook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.EvaluationHook-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.EvaluationHook.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __call__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetricsHook
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetricsHook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook--later-access-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Later, access metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Attributes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook.average_latency_ms" class="md-nav__link">
    <span class="md-ellipsis">
      
        average_latency_ms
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook.error_rate" class="md-nav__link">
    <span class="md-ellipsis">
      
        error_rate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook.success_rate" class="md-nav__link">
    <span class="md-ellipsis">
      
        success_rate
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __call__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook.reset" class="md-nav__link">
    <span class="md-ellipsis">
      
        reset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.MetricsHook.summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        summary
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      
        evaluation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.evaluation-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.evaluation.EvaluationHook" class="md-nav__link">
    <span class="md-ellipsis">
      
        EvaluationHook
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        metrics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.metrics-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.metrics.MetricsHook" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetricsHook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.hooks.metrics.MetricsHook--later-access-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Later, access metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hookedllm.config" class="md-nav__link">
    <span class="md-ellipsis">
      
        config
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.HookConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.RootConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        RootConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.ScopeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.WhenConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        WhenConfig
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.load_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_config
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.loader" class="md-nav__link">
    <span class="md-ellipsis">
      
        loader
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="loader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.loader-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.loader-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.loader.load_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_config
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        schema
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema.HookConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        HookConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema.RootConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        RootConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema.ScopeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScopeConfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.config.schema.WhenConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        WhenConfig
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#providers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Providers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hookedllm.providers" class="md-nav__link">
    <span class="md-ellipsis">
      
        providers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="providers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        ProviderAdapter
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProviderAdapter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter.detect" class="md-nav__link">
    <span class="md-ellipsis">
      
        detect
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter.get_callable" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_callable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter.get_wrapper_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_wrapper_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter.normalize_input" class="md-nav__link">
    <span class="md-ellipsis">
      
        normalize_input
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.ProviderAdapter.normalize_output" class="md-nav__link">
    <span class="md-ellipsis">
      
        normalize_output
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.anthropic" class="md-nav__link">
    <span class="md-ellipsis">
      
        anthropic
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="anthropic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.anthropic-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.anthropic.AnthropicAdapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        AnthropicAdapter
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.openai" class="md-nav__link">
    <span class="md-ellipsis">
      
        openai
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="openai">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.openai-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.openai.OpenAIAdapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        OpenAIAdapter
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.protocol" class="md-nav__link">
    <span class="md-ellipsis">
      
        protocol
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="protocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.protocol-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookedllm.providers.protocol.ProviderAdapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        ProviderAdapter
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h1>
<p>Complete API reference for HookedLLM.</p>
<h2 id="main-module">Main Module<a class="headerlink" href="#main-module" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="hookedllm" class="doc doc-heading">
            <code>hookedllm</code>


<a href="#hookedllm" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>HookedLLM - Scoped observability for LLM calls with SOLID/DI architecture.</p>


<details class="simple-usage" open>
  <summary>Simple usage</summary>
  <p>import hookedllm
from openai import AsyncOpenAI</p>
<h3 id="hookedllm--register-hooks-to-scopes">Register hooks to scopes<a class="headerlink" href="#hookedllm--register-hooks-to-scopes" title="Permanent link">&para;</a></h3>
<p>hookedllm.scope("evaluation").after(evaluate_hook)</p>
<h3 id="hookedllm--wrap-client-with-scope">Wrap client with scope<a class="headerlink" href="#hookedllm--wrap-client-with-scope" title="Permanent link">&para;</a></h3>
<p>client = hookedllm.wrap(AsyncOpenAI(), scope="evaluation")</p>
<h3 id="hookedllm--use-normally-hooks-auto-execute">Use normally - hooks auto-execute!<a class="headerlink" href="#hookedllm--use-normally-hooks-auto-execute" title="Permanent link">&para;</a></h3>
<p>response = await client.chat.completions.create(...)</p>
</details>        <p>Advanced usage (custom DI):
    ctx = hookedllm.create_context(
        executor=CustomExecutor(logger=my_logger)
    )
    client = ctx.wrap(AsyncOpenAI(), scope="test")</p>










<div class="doc doc-children">







<h3 id="hookedllm-classes">Classes<a href="#hookedllm-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.DefaultHookExecutor" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">DefaultHookExecutor</span><span class="p">(</span><span class="n">error_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="ne">Exception</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#hookedllm.DefaultHookExecutor" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Concrete hook executor with dependency injection.</p>
<p>Single Responsibility: Only executes hooks, doesn't store them.
Dependencies injected: error_handler, logger</p>
<p>Guarantees:
- Hook failures never break the main LLM call
- Hooks execute in order
- Rules are evaluated before execution</p>

        <p>Initialize executor with optional dependencies.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>error_handler</code>
            </td>
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[[<span title="Exception">Exception</span>, <span title="str">str</span>], None] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Called when a hook fails. Signature: (error, context_str)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger instance (must have .error() method)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">error_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="ne">Exception</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">logger</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="p">):</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    Initialize executor with optional dependencies.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        error_handler: Called when a hook fails. Signature: (error, context_str)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        logger: Logger instance (must have .error() method)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span> <span class="o">=</span> <span class="n">error_handler</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_error_handler</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logger</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h5 id="hookedllm.DefaultHookExecutor-functions">Functions<a href="#hookedllm.DefaultHookExecutor-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.DefaultHookExecutor.execute_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_after</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.DefaultHookExecutor.execute_after" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Execute after hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.AfterHook">AfterHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_output</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call output</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_after</span><span class="p">(</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Execute after hooks with rule matching.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        call_output: The LLM call output</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">call_output</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;After hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.DefaultHookExecutor.execute_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_before</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.DefaultHookExecutor.execute_before" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Execute before hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.BeforeHook">BeforeHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_before</span><span class="p">(</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    Execute before hooks with rule matching.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Before hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Before hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.DefaultHookExecutor.execute_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_error</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.DefaultHookExecutor.execute_error" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Execute error hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.ErrorHook">ErrorHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>error</code>
            </td>
            <td>
                  <code><span title="BaseException">BaseException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The error that occurred</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_error</span><span class="p">(</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    Execute error hooks with rule matching.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        error: The error that occurred</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Error hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.DefaultHookExecutor.execute_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_finally</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.DefaultHookExecutor.execute_finally" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Execute finally hooks.</p>
<p>Note: Finally hooks don't use rule matching - they always run.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.FinallyHook">FinallyHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples (rule is ignored for finally hooks)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallResult(input: CallInput, output: CallOutput | None, context: CallContext, error: BaseException | None, ended_at: datetime, elapsed_ms: float)

  
      dataclass
   (hookedllm.core.types.CallResult)" href="#hookedllm.core.types.CallResult">CallResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complete call result</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_finally</span><span class="p">(</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Execute finally hooks.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    Note: Finally hooks don&#39;t use rule matching - they always run.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        hooks: List of (hook, rule) tuples (rule is ignored for finally hooks)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        result: The complete call result</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">_rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="c1"># Finally hooks always run, ignore rule</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Finally hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finally hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.HookedLLMContext" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">HookedLLMContext</span><span class="p">(</span><span class="n">registry</span><span class="p">:</span> <span class="n">ScopeRegistry</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#hookedllm.HookedLLMContext" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Dependency Injection container for hookedllm.</p>
<p>Holds all dependencies (registry, executor) and provides
factory methods for creating wrapped clients and accessing scopes.</p>
<p>Benefits:
- Testable: inject mock dependencies
- Flexible: swap implementations
- Explicit: dependencies are clear</p>

        <p>Initialize context with optional dependency injection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>registry</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ScopeRegistry (hookedllm.core.ScopeRegistry)" href="#hookedllm.core.ScopeRegistry">ScopeRegistry</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom scope registry (default: InMemoryScopeRegistry)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>executor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="HookExecutor (hookedllm.core.HookExecutor)" href="#hookedllm.core.HookExecutor">HookExecutor</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom hook executor (default: DefaultHookExecutor)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">registry</span><span class="p">:</span> <span class="n">ScopeRegistry</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    Initialize context with optional dependency injection.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        registry: Custom scope registry (default: InMemoryScopeRegistry)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        executor: Custom hook executor (default: DefaultHookExecutor)</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="c1"># Allow injection of custom implementations (DIP)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">registry</span> <span class="o">=</span> <span class="n">registry</span> <span class="ow">or</span> <span class="n">InMemoryScopeRegistry</span><span class="p">()</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">executor</span> <span class="o">=</span> <span class="n">executor</span> <span class="ow">or</span> <span class="n">DefaultHookExecutor</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h5 id="hookedllm.HookedLLMContext-functions">Functions<a href="#hookedllm.HookedLLMContext-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.HookedLLMContext.after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.HookedLLMContext.after" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Register a global after hook.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="k">def</span><span class="w"> </span><span class="nf">after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Register a global after hook.&quot;&quot;&quot;</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">global_scope</span><span class="p">()</span><span class="o">.</span><span class="n">add_after</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.HookedLLMContext.before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.HookedLLMContext.before" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Register a global before hook.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="k">def</span><span class="w"> </span><span class="nf">before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Register a global before hook.&quot;&quot;&quot;</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">global_scope</span><span class="p">()</span><span class="o">.</span><span class="n">add_before</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.HookedLLMContext.error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.HookedLLMContext.error" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Register a global error hook.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Register a global error hook.&quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">global_scope</span><span class="p">()</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.HookedLLMContext.finally_" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finally_</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.HookedLLMContext.finally_" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Register a global finally hook.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="k">def</span><span class="w"> </span><span class="nf">finally_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Register a global finally hook.&quot;&quot;&quot;</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">global_scope</span><span class="p">()</span><span class="o">.</span><span class="n">add_finally</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.HookedLLMContext.global_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">global_scope</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span></code>

<a href="#hookedllm.HookedLLMContext.global_scope" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get the global scope (always active).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.ScopeHookStore)" href="#hookedllm.core.ScopeHookStore">ScopeHookStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Global scope hook store</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="k">def</span><span class="w"> </span><span class="nf">global_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">    Get the global scope (always active).</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        Global scope hook store</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">get_global_scope</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.HookedLLMContext.scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span></code>

<a href="#hookedllm.HookedLLMContext.scope" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get a scope manager from this context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.ScopeHookStore)" href="#hookedllm.core.ScopeHookStore">ScopeHookStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope hook store</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>ctx.scope("evaluation").after(my_hook)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="k">def</span><span class="w"> </span><span class="nf">scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    Get a scope manager from this context.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        name: Scope name</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        Scope hook store</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        ctx.scope(&quot;evaluation&quot;).after(my_hook)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.HookedLLMContext.wrap" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wrap</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HookedClientWrapper</span></code>

<a href="#hookedllm.HookedLLMContext.wrap" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Wrap a client using this context's dependencies.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OpenAI-compatible client</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scope</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None, single scope name, or list of scope names</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="HookedClientWrapper(original_client: Any, scopes: list[ScopeHookStore], executor: HookExecutor) (hookedllm.core.HookedClientWrapper)" href="#hookedllm.core.HookedClientWrapper">HookedClientWrapper</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wrapped client with injected dependencies</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>client = ctx.wrap(AsyncOpenAI(), scope="evaluation")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="k">def</span><span class="w"> </span><span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HookedClientWrapper</span><span class="p">:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Wrap a client using this context&#39;s dependencies.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        client: OpenAI-compatible client</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        scope: None, single scope name, or list of scope names</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        Wrapped client with injected dependencies</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        client = ctx.wrap(AsyncOpenAI(), scope=&quot;evaluation&quot;)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="c1"># Convert scope to list</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">if</span> <span class="n">scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">scope_list</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">scope_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">scope</span><span class="p">]</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="n">scope_list</span> <span class="o">=</span> <span class="n">scope</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="c1"># Get scopes from registry</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="n">scopes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">get_scopes_for_client</span><span class="p">(</span><span class="n">scope_list</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="c1"># Create wrapper with injected dependencies (DI!)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">return</span> <span class="n">HookedClientWrapper</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">scopes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.InMemoryScopeRegistry" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">InMemoryScopeRegistry</span><span class="p">()</span></code>

<a href="#hookedllm.InMemoryScopeRegistry" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Concrete implementation of ScopeRegistry.</p>
<p>Single Responsibility: Only manages scope lifecycle.
Creates and retrieves scopes, manages global scope.</p>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InMemoryScopeHookStore</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_global</span> <span class="o">=</span> <span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="s2">&quot;__global__&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h5 id="hookedllm.InMemoryScopeRegistry-functions">Functions<a href="#hookedllm.InMemoryScopeRegistry-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.InMemoryScopeRegistry.get_global_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_global_scope</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.InMemoryScopeRegistry.get_global_scope" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get the global scope (always active).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="InMemoryScopeHookStore(scope_name: str) (hookedllm.core.scopes.InMemoryScopeHookStore)" href="#hookedllm.core.scopes.InMemoryScopeHookStore">InMemoryScopeHookStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The global scope hook store</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_global_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    Get the global scope (always active).</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        The global scope hook store</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.InMemoryScopeRegistry.get_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.InMemoryScopeRegistry.get_scope" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get or create a named scope.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="InMemoryScopeHookStore(scope_name: str) (hookedllm.core.scopes.InMemoryScopeHookStore)" href="#hookedllm.core.scopes.InMemoryScopeHookStore">InMemoryScopeHookStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope hook store for the named scope</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Get or create a named scope.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        name: Scope name</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        Scope hook store for the named scope</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.InMemoryScopeRegistry.get_scopes_for_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scopes_for_client</span><span class="p">(</span><span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span></code>

<a href="#hookedllm.InMemoryScopeRegistry.get_scopes_for_client" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get list of scopes for a client.</p>
<p>Always includes the global scope, plus any requested scopes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>scope_names</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope names, or None for global only</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.protocols.ScopeHookStore)" href="#hookedllm.core.protocols.ScopeHookStore">ScopeHookStore</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope hook stores (global + requested scopes)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scopes_for_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Get list of scopes for a client.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Always includes the global scope, plus any requested scopes.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        scope_names: List of scope names, or None for global only</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        List of scope hook stores (global + requested scopes)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_global</span><span class="p">]</span>  <span class="c1"># Always include global</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="n">scope_names</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">scope_names</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">scopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">return</span> <span class="n">scopes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.InMemoryScopeRegistry.scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.InMemoryScopeRegistry.scope" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Alias for get_scope for more fluent API.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="k">def</span><span class="w"> </span><span class="nf">scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for get_scope for more fluent API.&quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h3 id="hookedllm-functions">Functions<a href="#hookedllm-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="hookedllm.after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.after" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Register a global after hook (uses default context).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hook</code>
            </td>
            <td>
                  <code><span title="hookedllm.core.AfterHook">AfterHook</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>After hook function</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>when</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Rule (hookedllm.core.Rule)" href="#hookedllm.core.Rule">Rule</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional rule for conditional execution</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>hookedllm.after(my_hook, when=hookedllm.when.tag("production"))</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="k">def</span><span class="w"> </span><span class="nf">after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    Register a global after hook (uses default context).</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        hook: After hook function</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        when: Optional rule for conditional execution</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        hookedllm.after(my_hook, when=hookedllm.when.tag(&quot;production&quot;))</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="n">_default_context</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="hookedllm.before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.before" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Register a global before hook (uses default context).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hook</code>
            </td>
            <td>
                  <code><span title="hookedllm.core.BeforeHook">BeforeHook</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Before hook function</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>when</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Rule (hookedllm.core.Rule)" href="#hookedllm.core.Rule">Rule</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional rule for conditional execution</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>hookedllm.before(my_hook, when=hookedllm.when.model("gpt-4"))</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="k">def</span><span class="w"> </span><span class="nf">before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    Register a global before hook (uses default context).</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        hook: Before hook function</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        when: Optional rule for conditional execution</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        hookedllm.before(my_hook, when=hookedllm.when.model(&quot;gpt-4&quot;))</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="n">_default_context</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="hookedllm.create_context" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_context</span><span class="p">(</span><span class="n">registry</span><span class="p">:</span> <span class="n">ScopeRegistry</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HookedLLMContext</span></code>

<a href="#hookedllm.create_context" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Create a custom context with injected dependencies.</p>
<p>Use this for:
- Testing (inject mocks)
- Custom implementations
- Isolated environments</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>registry</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ScopeRegistry (hookedllm.core.ScopeRegistry)" href="#hookedllm.core.ScopeRegistry">ScopeRegistry</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom scope registry</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>executor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="HookExecutor (hookedllm.core.HookExecutor)" href="#hookedllm.core.HookExecutor">HookExecutor</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom hook executor</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="HookedLLMContext(registry: ScopeRegistry | None = None, executor: HookExecutor | None = None) (hookedllm.HookedLLMContext)" href="#hookedllm.HookedLLMContext">HookedLLMContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New context instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>ctx = hookedllm.create_context(
    executor=MyCustomExecutor(logger=my_logger)
)
client = ctx.wrap(AsyncOpenAI(), scope="test")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_context</span><span class="p">(</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="n">registry</span><span class="p">:</span> <span class="n">ScopeRegistry</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HookedLLMContext</span><span class="p">:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    Create a custom context with injected dependencies.</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    Use this for:</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">    - Testing (inject mocks)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">    - Custom implementations</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">    - Isolated environments</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        registry: Custom scope registry</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">        executor: Custom hook executor</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">        New context instance</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">        ctx = hookedllm.create_context(</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">            executor=MyCustomExecutor(logger=my_logger)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">        )</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">        client = ctx.wrap(AsyncOpenAI(), scope=&quot;test&quot;)</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="k">return</span> <span class="n">HookedLLMContext</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="hookedllm.error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.error" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Register a global error hook (uses default context).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hook</code>
            </td>
            <td>
                  <code><span title="hookedllm.core.ErrorHook">ErrorHook</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Error hook function</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>when</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Rule (hookedllm.core.Rule)" href="#hookedllm.core.Rule">Rule</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional rule for conditional execution</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>hookedllm.error(my_hook)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">    Register a global error hook (uses default context).</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        hook: Error hook function</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        when: Optional rule for conditional execution</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">        hookedllm.error(my_hook)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="n">_default_context</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="hookedllm.finally_" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finally_</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.finally_" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Register a global finally hook (uses default context).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hook</code>
            </td>
            <td>
                  <code><span title="hookedllm.core.FinallyHook">FinallyHook</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Finally hook function</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>when</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Rule (hookedllm.core.Rule)" href="#hookedllm.core.Rule">Rule</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional rule for conditional execution</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>hookedllm.finally_(my_hook)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="k">def</span><span class="w"> </span><span class="nf">finally_</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    Register a global finally hook (uses default context).</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        hook: Finally hook function</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        when: Optional rule for conditional execution</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">        hookedllm.finally_(my_hook)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="n">_default_context</span><span class="o">.</span><span class="n">finally_</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="hookedllm.scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span></code>

<a href="#hookedllm.scope" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get a scope manager (uses default context).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.ScopeHookStore)" href="#hookedllm.core.ScopeHookStore">ScopeHookStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope hook store</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>hookedllm.scope("evaluation").after(my_hook)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="k">def</span><span class="w"> </span><span class="nf">scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    Get a scope manager (uses default context).</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        name: Scope name</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        Scope hook store</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        hookedllm.scope(&quot;evaluation&quot;).after(my_hook)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="k">return</span> <span class="n">_default_context</span><span class="o">.</span><span class="n">scope</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="hookedllm.wrap" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wrap</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HookedClientWrapper</span></code>

<a href="#hookedllm.wrap" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Wrap a client with hook support (uses default context).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OpenAI-compatible client</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scope</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None, single scope name, or list of scope names</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="HookedClientWrapper(original_client: Any, scopes: list[ScopeHookStore], executor: HookExecutor) (hookedllm.core.HookedClientWrapper)" href="#hookedllm.core.HookedClientWrapper">HookedClientWrapper</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wrapped client</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>from openai import AsyncOpenAI
client = hookedllm.wrap(AsyncOpenAI(), scope="evaluation")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="k">def</span><span class="w"> </span><span class="nf">wrap</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HookedClientWrapper</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    Wrap a client with hook support (uses default context).</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        client: OpenAI-compatible client</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        scope: None, single scope name, or list of scope names</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        Wrapped client</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        from openai import AsyncOpenAI</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        client = hookedllm.wrap(AsyncOpenAI(), scope=&quot;evaluation&quot;)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="k">return</span> <span class="n">_default_context</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h3 id="hookedllm-modules">Modules<a href="#hookedllm-modules" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.config" class="doc doc-heading">
            <code>config</code>


<a href="#hookedllm.config" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Configuration loading for hookedllm.</p>
<p>Provides YAML-based configuration loading (requires pyyaml).</p>










<div class="doc doc-children">







<h5 id="hookedllm.config-classes">Classes<a href="#hookedllm.config-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.config.HookConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">HookConfig</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;finally&#39;</span><span class="p">],</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">function</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">WhenConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.HookConfig" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Single hook configuration from YAML.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.config.RootConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">RootConfig</span><span class="p">(</span><span class="n">global_hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HookConfig</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ScopeConfig</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.RootConfig" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Root configuration schema.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.config.ScopeConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">ScopeConfig</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HookConfig</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.ScopeConfig" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Scope configuration with its hooks.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.config.WhenConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">WhenConfig</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">all_calls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.WhenConfig" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Rule configuration from YAML.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>
<h5 id="hookedllm.config-functions">Functions<a href="#hookedllm.config-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.config.load_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_config</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.config.load_config" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Load hooks from a YAML configuration file.</p>
<p>Requires pyyaml: pip install hookedllm[config]</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML config file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional HookedLLMContext to use (default: uses default context)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example-yaml" open>
  <summary>Example YAML</summary>
  <p>global_hooks:
  - name: metrics
    type: finally
    module: hookedllm.hooks.metrics
    class_name: MetricsHook</p>
<p>scopes:
  evaluation:
    hooks:
      - name: evaluate
        type: after
        module: my_app.hooks
        function: evaluate_response
        when:
          model: gpt-4</p>
</details>

<details class="example-usage" open>
  <summary>Example usage</summary>
  <p>import hookedllm
hookedllm.load_config("hooks.yaml")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/config/loader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_config</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    Load hooks from a YAML configuration file.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    Requires pyyaml: pip install hookedllm[config]</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        path: Path to YAML config file</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        context: Optional HookedLLMContext to use (default: uses default context)</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Example YAML:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        global_hooks:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">          - name: metrics</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">            type: finally</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">            module: hookedllm.hooks.metrics</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">            class_name: MetricsHook</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        scopes:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">          evaluation:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            hooks:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">              - name: evaluate</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">                type: after</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                module: my_app.hooks</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                function: evaluate_response</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                when:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                  model: gpt-4</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Example usage:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        import hookedllm</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        hookedllm.load_config(&quot;hooks.yaml&quot;)</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="s2">&quot;PyYAML is required for config loading. &quot;</span> <span class="s2">&quot;Install with: pip install hookedllm[config]&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="c1"># Load YAML file</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="n">config_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">config_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config file not found: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="k">return</span>  <span class="c1"># Empty config</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="c1"># Use provided context or default</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">hookedllm</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">ctx</span> <span class="o">=</span> <span class="n">hookedllm</span><span class="o">.</span><span class="n">_default_context</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="c1"># Load global hooks</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="k">if</span> <span class="s2">&quot;global_hooks&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;global_hooks&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">for</span> <span class="n">hook_config</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;global_hooks&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="n">_register_hook_from_config</span><span class="p">(</span><span class="n">hook_config</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">global_scope</span><span class="p">(),</span> <span class="n">ctx</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="c1"># Load scoped hooks</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">if</span> <span class="s2">&quot;scopes&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;scopes&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="k">for</span> <span class="n">scope_name</span><span class="p">,</span> <span class="n">scope_data</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;scopes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">scope</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">scope</span><span class="p">(</span><span class="n">scope_name</span><span class="p">)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="k">if</span> <span class="s2">&quot;hooks&quot;</span> <span class="ow">in</span> <span class="n">scope_data</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>                <span class="k">for</span> <span class="n">hook_config</span> <span class="ow">in</span> <span class="n">scope_data</span><span class="p">[</span><span class="s2">&quot;hooks&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>                    <span class="n">_register_hook_from_config</span><span class="p">(</span><span class="n">hook_config</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="hookedllm.config-modules">Modules<a href="#hookedllm.config-modules" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-module">



<h6 id="hookedllm.config.loader" class="doc doc-heading">
            <code>loader</code>


<a href="#hookedllm.config.loader" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

        <p>YAML configuration loader for hookedllm.</p>
<p>Loads hook configurations from YAML files and registers them.</p>










<div class="doc doc-children">







<h7 id="hookedllm.config.loader-classes">Classes<a href="#hookedllm.config.loader-classes" class="headerlink" title="Permanent link">&para;</a></h7>
<h7 id="hookedllm.config.loader-functions">Functions<a href="#hookedllm.config.loader-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.config.loader.load_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_config</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.config.loader.load_config" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Load hooks from a YAML configuration file.</p>
<p>Requires pyyaml: pip install hookedllm[config]</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML config file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional HookedLLMContext to use (default: uses default context)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example-yaml" open>
  <summary>Example YAML</summary>
  <p>global_hooks:
  - name: metrics
    type: finally
    module: hookedllm.hooks.metrics
    class_name: MetricsHook</p>
<p>scopes:
  evaluation:
    hooks:
      - name: evaluate
        type: after
        module: my_app.hooks
        function: evaluate_response
        when:
          model: gpt-4</p>
</details>

<details class="example-usage" open>
  <summary>Example usage</summary>
  <p>import hookedllm
hookedllm.load_config("hooks.yaml")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/config/loader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_config</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    Load hooks from a YAML configuration file.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    Requires pyyaml: pip install hookedllm[config]</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        path: Path to YAML config file</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        context: Optional HookedLLMContext to use (default: uses default context)</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Example YAML:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        global_hooks:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">          - name: metrics</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">            type: finally</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">            module: hookedllm.hooks.metrics</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">            class_name: MetricsHook</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        scopes:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">          evaluation:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            hooks:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">              - name: evaluate</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">                type: after</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                module: my_app.hooks</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                function: evaluate_response</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                when:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                  model: gpt-4</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Example usage:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        import hookedllm</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        hookedllm.load_config(&quot;hooks.yaml&quot;)</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="s2">&quot;PyYAML is required for config loading. &quot;</span> <span class="s2">&quot;Install with: pip install hookedllm[config]&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="c1"># Load YAML file</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="n">config_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">config_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config file not found: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="k">return</span>  <span class="c1"># Empty config</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="c1"># Use provided context or default</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">hookedllm</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">ctx</span> <span class="o">=</span> <span class="n">hookedllm</span><span class="o">.</span><span class="n">_default_context</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="c1"># Load global hooks</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="k">if</span> <span class="s2">&quot;global_hooks&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;global_hooks&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">for</span> <span class="n">hook_config</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;global_hooks&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="n">_register_hook_from_config</span><span class="p">(</span><span class="n">hook_config</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">global_scope</span><span class="p">(),</span> <span class="n">ctx</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="c1"># Load scoped hooks</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">if</span> <span class="s2">&quot;scopes&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;scopes&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="k">for</span> <span class="n">scope_name</span><span class="p">,</span> <span class="n">scope_data</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;scopes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">scope</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">scope</span><span class="p">(</span><span class="n">scope_name</span><span class="p">)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="k">if</span> <span class="s2">&quot;hooks&quot;</span> <span class="ow">in</span> <span class="n">scope_data</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>                <span class="k">for</span> <span class="n">hook_config</span> <span class="ow">in</span> <span class="n">scope_data</span><span class="p">[</span><span class="s2">&quot;hooks&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>                    <span class="n">_register_hook_from_config</span><span class="p">(</span><span class="n">hook_config</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h6 id="hookedllm.config.schema" class="doc doc-heading">
            <code>schema</code>


<a href="#hookedllm.config.schema" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

        <p>Configuration schema for YAML-based hook registration.</p>
<p>Defines the structure of YAML configuration files.</p>










<div class="doc doc-children">







<h7 id="hookedllm.config.schema-classes">Classes<a href="#hookedllm.config.schema-classes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.config.schema.HookConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">HookConfig</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;finally&#39;</span><span class="p">],</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">function</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">WhenConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.schema.HookConfig" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Single hook configuration from YAML.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.config.schema.RootConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">RootConfig</span><span class="p">(</span><span class="n">global_hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HookConfig</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ScopeConfig</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.schema.RootConfig" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Root configuration schema.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.config.schema.ScopeConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">ScopeConfig</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HookConfig</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.schema.ScopeConfig" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Scope configuration with its hooks.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.config.schema.WhenConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">WhenConfig</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">all_calls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.schema.WhenConfig" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Rule configuration from YAML.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.core" class="doc doc-heading">
            <code>core</code>


<a href="#hookedllm.core" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Core module for hookedllm.</p>
<p>Contains the fundamental types, protocols, and implementations.</p>










<div class="doc doc-children">







<h5 id="hookedllm.core-classes">Classes<a href="#hookedllm.core-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.CallContext" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallContext</span><span class="p">(</span><span class="n">call_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))(),</span> <span class="n">parent_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">route</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;chat&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="n">started_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))(),</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">())</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.CallContext" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Context for a single LLM call lifecycle.</p>
<p>Contains metadata about the call including timing, tags, and custom metadata.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.CallInput" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallInput</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Message</span><span class="p">],</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">())</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.CallInput" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Normalized input for an LLM call.</p>
<p>This represents the input parameters in a provider-agnostic way.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.CallOutput" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallOutput</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">raw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">usage</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">finish_reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.CallOutput" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Normalized output from an LLM call.</p>
<p>This represents the response in a provider-agnostic way while
preserving the original response object.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.CallResult" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallResult</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">CallOutput</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ended_at</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">elapsed_ms</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.CallResult" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Complete result of an LLM call.</p>
<p>Contains the input, output, context, any error that occurred,
and timing information. This is passed to finally hooks.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.CompositeRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CompositeRule</span><span class="p">(</span><span class="n">rules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">operator</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;and&#39;</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.CompositeRule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Combine multiple rules with AND/OR logic.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.CustomRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CustomRule</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.CustomRule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Custom predicate function.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.DefaultHookExecutor" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">DefaultHookExecutor</span><span class="p">(</span><span class="n">error_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="ne">Exception</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#hookedllm.core.DefaultHookExecutor" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Concrete hook executor with dependency injection.</p>
<p>Single Responsibility: Only executes hooks, doesn't store them.
Dependencies injected: error_handler, logger</p>
<p>Guarantees:
- Hook failures never break the main LLM call
- Hooks execute in order
- Rules are evaluated before execution</p>

        <p>Initialize executor with optional dependencies.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>error_handler</code>
            </td>
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[[<span title="Exception">Exception</span>, <span title="str">str</span>], None] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Called when a hook fails. Signature: (error, context_str)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger instance (must have .error() method)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">error_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="ne">Exception</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">logger</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="p">):</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    Initialize executor with optional dependencies.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        error_handler: Called when a hook fails. Signature: (error, context_str)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        logger: Logger instance (must have .error() method)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span> <span class="o">=</span> <span class="n">error_handler</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_error_handler</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logger</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h7 id="hookedllm.core.DefaultHookExecutor-functions">Functions<a href="#hookedllm.core.DefaultHookExecutor-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.DefaultHookExecutor.execute_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_after</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.DefaultHookExecutor.execute_after" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute after hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.AfterHook">AfterHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_output</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call output</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_after</span><span class="p">(</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Execute after hooks with rule matching.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        call_output: The LLM call output</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">call_output</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;After hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.DefaultHookExecutor.execute_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_before</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.DefaultHookExecutor.execute_before" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute before hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.BeforeHook">BeforeHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_before</span><span class="p">(</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    Execute before hooks with rule matching.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Before hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Before hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.DefaultHookExecutor.execute_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_error</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.DefaultHookExecutor.execute_error" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute error hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.ErrorHook">ErrorHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>error</code>
            </td>
            <td>
                  <code><span title="BaseException">BaseException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The error that occurred</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_error</span><span class="p">(</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    Execute error hooks with rule matching.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        error: The error that occurred</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Error hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.DefaultHookExecutor.execute_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_finally</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.DefaultHookExecutor.execute_finally" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute finally hooks.</p>
<p>Note: Finally hooks don't use rule matching - they always run.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.FinallyHook">FinallyHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples (rule is ignored for finally hooks)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallResult(input: CallInput, output: CallOutput | None, context: CallContext, error: BaseException | None, ended_at: datetime, elapsed_ms: float)

  
      dataclass
   (hookedllm.core.types.CallResult)" href="#hookedllm.core.types.CallResult">CallResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complete call result</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_finally</span><span class="p">(</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Execute finally hooks.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    Note: Finally hooks don&#39;t use rule matching - they always run.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        hooks: List of (hook, rule) tuples (rule is ignored for finally hooks)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        result: The complete call result</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">_rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="c1"># Finally hooks always run, ignore rule</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Finally hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finally hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.HookExecutor" class="doc doc-heading">
            <code>HookExecutor</code>


<a href="#hookedllm.core.HookExecutor" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for executing hooks.</p>
<p>Single Responsibility: Hook execution only, no storage.</p>











<div class="doc doc-children">








<h7 id="hookedllm.core.HookExecutor-functions">Functions<a href="#hookedllm.core.HookExecutor-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.HookExecutor.execute_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_after</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.HookExecutor.execute_after" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute after hooks with rule matching.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_after</span><span class="p">(</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute after hooks with rule matching.&quot;&quot;&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.HookExecutor.execute_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_before</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.HookExecutor.execute_before" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute before hooks with rule matching.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_before</span><span class="p">(</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute before hooks with rule matching.&quot;&quot;&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.HookExecutor.execute_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_error</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.HookExecutor.execute_error" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute error hooks with rule matching.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_error</span><span class="p">(</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute error hooks with rule matching.&quot;&quot;&quot;</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.HookExecutor.execute_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_finally</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.HookExecutor.execute_finally" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute finally hooks.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_finally</span><span class="p">(</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute finally hooks.&quot;&quot;&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.HookedClientWrapper" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">HookedClientWrapper</span><span class="p">(</span><span class="n">original_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">)</span></code>

<a href="#hookedllm.core.HookedClientWrapper" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Transparent proxy with all dependencies injected.</p>
<p>No global state - all dependencies passed via constructor (DI).
Intercepts provider SDK methods to inject hook execution.</p>

        <p>Initialize wrapper with injected dependencies.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>original_client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The original provider client</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scopes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.protocols.ScopeHookStore)" href="#hookedllm.core.protocols.ScopeHookStore">ScopeHookStore</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope hook stores to use</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>executor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="HookExecutor (hookedllm.core.protocols.HookExecutor)" href="#hookedllm.core.protocols.HookExecutor">HookExecutor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hook executor instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">):</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Initialize wrapper with injected dependencies.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        original_client: The original provider client</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        scopes: List of scope hook stores to use</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        executor: Hook executor instance</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_original</span> <span class="o">=</span> <span class="n">original_client</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span> <span class="o">=</span> <span class="n">scopes</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">executor</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span> <span class="o">=</span> <span class="n">_detect_provider_adapter</span><span class="p">(</span><span class="n">original_client</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span><span class="o">.</span><span class="n">get_wrapper_path</span><span class="p">(</span><span class="n">original_client</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h7 id="hookedllm.core.HookedClientWrapper-functions">Functions<a href="#hookedllm.core.HookedClientWrapper-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.HookedClientWrapper.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

<a href="#hookedllm.core.HookedClientWrapper.__getattr__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Intercept attribute access.</p>
<p>Wraps attributes based on the detected provider's wrapper path.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Intercept attribute access.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Wraps attributes based on the detected provider&#39;s wrapper path.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="c1"># Check if this attribute is part of the wrapper path</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="c1"># Create a dynamic wrapper for the next level</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">return</span> <span class="n">_create_wrapper_for_path</span><span class="p">(</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">return</span> <span class="n">attr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.InMemoryScopeHookStore" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="n">scope_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Concrete implementation of ScopeHookStore.</p>
<p>Single Responsibility: Only stores hooks.
Stores hooks in memory with their associated rules.</p>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_name</span> <span class="o">=</span> <span class="n">scope_name</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_finally</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">





<h7 id="hookedllm.core.InMemoryScopeHookStore-attributes">Attributes<a href="#hookedllm.core.InMemoryScopeHookStore-attributes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-attribute">



<h8 id="hookedllm.core.InMemoryScopeHookStore.name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.core.InMemoryScopeHookStore.name" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the scope name.</p>

    </div>

</div>


<h7 id="hookedllm.core.InMemoryScopeHookStore-functions">Functions<a href="#hookedllm.core.InMemoryScopeHookStore-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeHookStore.add_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.add_after" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add an after hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an after hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeHookStore.add_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.add_before" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add a before hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a before hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeHookStore.add_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.add_error" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add an error hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an error hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeHookStore.add_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_finally</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.add_finally" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add a finally hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_finally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a finally hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_finally</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeHookStore.after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.after" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Alias for add_after with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span><span class="w"> </span><span class="nf">after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_after with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_after</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeHookStore.before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.before" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Alias for add_before with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="k">def</span><span class="w"> </span><span class="nf">before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_before with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_before</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeHookStore.error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.error" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Alias for add_error with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_error with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeHookStore.finally_" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finally_</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.finally_" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Alias for add_finally with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="nf">finally_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_finally with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_finally</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeHookStore.get_after_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_after_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.get_after_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all after hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_after_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all after hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeHookStore.get_before_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_before_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.get_before_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all before hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_before_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all before hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeHookStore.get_error_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_error_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.get_error_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all error hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_error_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all error hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeHookStore.get_finally_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_finally_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.get_finally_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all finally hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_finally_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all finally hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finally</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.InMemoryScopeRegistry" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">InMemoryScopeRegistry</span><span class="p">()</span></code>

<a href="#hookedllm.core.InMemoryScopeRegistry" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Concrete implementation of ScopeRegistry.</p>
<p>Single Responsibility: Only manages scope lifecycle.
Creates and retrieves scopes, manages global scope.</p>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InMemoryScopeHookStore</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_global</span> <span class="o">=</span> <span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="s2">&quot;__global__&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h7 id="hookedllm.core.InMemoryScopeRegistry-functions">Functions<a href="#hookedllm.core.InMemoryScopeRegistry-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeRegistry.get_global_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_global_scope</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.core.InMemoryScopeRegistry.get_global_scope" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the global scope (always active).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="InMemoryScopeHookStore(scope_name: str) (hookedllm.core.scopes.InMemoryScopeHookStore)" href="#hookedllm.core.scopes.InMemoryScopeHookStore">InMemoryScopeHookStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The global scope hook store</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_global_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    Get the global scope (always active).</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        The global scope hook store</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeRegistry.get_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.core.InMemoryScopeRegistry.get_scope" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get or create a named scope.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="InMemoryScopeHookStore(scope_name: str) (hookedllm.core.scopes.InMemoryScopeHookStore)" href="#hookedllm.core.scopes.InMemoryScopeHookStore">InMemoryScopeHookStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope hook store for the named scope</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Get or create a named scope.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        name: Scope name</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        Scope hook store for the named scope</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeRegistry.get_scopes_for_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scopes_for_client</span><span class="p">(</span><span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span></code>

<a href="#hookedllm.core.InMemoryScopeRegistry.get_scopes_for_client" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get list of scopes for a client.</p>
<p>Always includes the global scope, plus any requested scopes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>scope_names</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope names, or None for global only</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.protocols.ScopeHookStore)" href="#hookedllm.core.protocols.ScopeHookStore">ScopeHookStore</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope hook stores (global + requested scopes)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scopes_for_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Get list of scopes for a client.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Always includes the global scope, plus any requested scopes.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        scope_names: List of scope names, or None for global only</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        List of scope hook stores (global + requested scopes)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_global</span><span class="p">]</span>  <span class="c1"># Always include global</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="n">scope_names</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">scope_names</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">scopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">return</span> <span class="n">scopes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.InMemoryScopeRegistry.scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.core.InMemoryScopeRegistry.scope" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Alias for get_scope for more fluent API.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="k">def</span><span class="w"> </span><span class="nf">scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for get_scope for more fluent API.&quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.Message" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">Message</span><span class="p">(</span><span class="n">role</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.Message" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>A single message in an LLM conversation.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.MetadataRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">MetadataRule</span><span class="p">(</span><span class="n">conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.MetadataRule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Match based on metadata key-value pairs.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.ModelRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">ModelRule</span><span class="p">(</span><span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.ModelRule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Match specific model(s).</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.NotRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">NotRule</span><span class="p">(</span><span class="n">rule</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.NotRule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Negate a rule.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.Rule" class="doc doc-heading">
            <code>Rule</code>


<a href="#hookedllm.core.Rule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for hook execution rules.</p>
<p>Rules determine whether a hook should execute based on the
call input and context.</p>











<div class="doc doc-children">








<h7 id="hookedllm.core.Rule-functions">Functions<a href="#hookedllm.core.Rule-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.Rule.__and__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__and__</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span></code>

<a href="#hookedllm.core.Rule.__and__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Combine rules with AND logic.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="k">def</span><span class="w"> </span><span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span><span class="p">:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine rules with AND logic.&quot;&quot;&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.Rule.__invert__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__invert__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Rule</span></code>

<a href="#hookedllm.core.Rule.__invert__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Negate the rule (NOT logic).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span><span class="w"> </span><span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Negate the rule (NOT logic).&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.Rule.__or__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__or__</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span></code>

<a href="#hookedllm.core.Rule.__or__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Combine rules with OR logic.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="k">def</span><span class="w"> </span><span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine rules with OR logic.&quot;&quot;&quot;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.Rule.matches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

<a href="#hookedllm.core.Rule.matches" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Check if this rule matches the given call.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="k">def</span><span class="w"> </span><span class="nf">matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if this rule matches the given call.&quot;&quot;&quot;</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.RuleBuilder" class="doc doc-heading">
            <code>RuleBuilder</code>


<a href="#hookedllm.core.RuleBuilder" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Fluent API for building rules.</p>
<p>Used via the 'when' global instance.</p>











<div class="doc doc-children">








<h7 id="hookedllm.core.RuleBuilder-functions">Functions<a href="#hookedllm.core.RuleBuilder-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.RuleBuilder.always" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">always</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.RuleBuilder.always" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Always matches.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="k">def</span><span class="w"> </span><span class="nf">always</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span><span class="p">:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Always matches.&quot;&quot;&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="k">return</span> <span class="n">CustomRule</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.RuleBuilder.custom" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">custom</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.RuleBuilder.custom" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Custom predicate function.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>when.custom(lambda i, c: c.metadata.get("score", 0) &gt; 0.8)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="k">def</span><span class="w"> </span><span class="nf">custom</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    Custom predicate function.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        when.custom(lambda i, c: c.metadata.get(&quot;score&quot;, 0) &gt; 0.8)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">return</span> <span class="n">CustomRule</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.RuleBuilder.metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metadata</span><span class="p">(</span><span class="o">**</span><span class="n">conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetadataRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.RuleBuilder.metadata" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Match metadata conditions.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>when.metadata(user_tier="premium", region="us-east")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="k">def</span><span class="w"> </span><span class="nf">metadata</span><span class="p">(</span><span class="o">**</span><span class="n">conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetadataRule</span><span class="p">:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    Match metadata conditions.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        when.metadata(user_tier=&quot;premium&quot;, region=&quot;us-east&quot;)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">return</span> <span class="n">MetadataRule</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.RuleBuilder.model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model</span><span class="p">(</span><span class="o">*</span><span class="n">models</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.RuleBuilder.model" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Match specific model(s).</p>


<details class="example" open>
  <summary>Example</summary>
  <p>when.model("gpt-4", "gpt-4-turbo")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="o">*</span><span class="n">models</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelRule</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    Match specific model(s).</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        when.model(&quot;gpt-4&quot;, &quot;gpt-4-turbo&quot;)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="k">return</span> <span class="n">ModelRule</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.RuleBuilder.never" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">never</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.RuleBuilder.never" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Never matches.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="k">def</span><span class="w"> </span><span class="nf">never</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Never matches.&quot;&quot;&quot;</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="k">return</span> <span class="n">CustomRule</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.RuleBuilder.tag" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tag</span><span class="p">(</span><span class="o">*</span><span class="n">tags</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">all_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TagRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.RuleBuilder.tag" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Match if context has tag(s).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>*tags</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tag names to match</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>all_</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, all tags must be present. If False, any tag matches.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>when.tag("production", "critical")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="k">def</span><span class="w"> </span><span class="nf">tag</span><span class="p">(</span><span class="o">*</span><span class="n">tags</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">all_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TagRule</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    Match if context has tag(s).</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        *tags: Tag names to match</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        all_: If True, all tags must be present. If False, any tag matches.</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        when.tag(&quot;production&quot;, &quot;critical&quot;)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">return</span> <span class="n">TagRule</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">),</span> <span class="n">require_all</span><span class="o">=</span><span class="n">all_</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.ScopeHookStore" class="doc doc-heading">
            <code>ScopeHookStore</code>


<a href="#hookedllm.core.ScopeHookStore" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for storing hooks in a scope.</p>
<p>Single Responsibility: Storage only, no execution logic.</p>











<div class="doc doc-children">








<h7 id="hookedllm.core.ScopeHookStore-functions">Functions<a href="#hookedllm.core.ScopeHookStore-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.ScopeHookStore.add_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.ScopeHookStore.add_after" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add an after hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an after hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.ScopeHookStore.add_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.ScopeHookStore.add_before" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add a before hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a before hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.ScopeHookStore.add_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.ScopeHookStore.add_error" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add an error hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an error hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.ScopeHookStore.add_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_finally</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.ScopeHookStore.add_finally" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add a finally hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_finally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a finally hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.ScopeHookStore.get_after_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_after_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.ScopeHookStore.get_after_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all after hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_after_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all after hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.ScopeHookStore.get_before_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_before_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.ScopeHookStore.get_before_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all before hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_before_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all before hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.ScopeHookStore.get_error_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_error_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.ScopeHookStore.get_error_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all error hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_error_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all error hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.ScopeHookStore.get_finally_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_finally_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.ScopeHookStore.get_finally_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all finally hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_finally_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all finally hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.ScopeRegistry" class="doc doc-heading">
            <code>ScopeRegistry</code>


<a href="#hookedllm.core.ScopeRegistry" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for managing scopes.</p>
<p>Single Responsibility: Scope lifecycle management only.</p>











<div class="doc doc-children">








<h7 id="hookedllm.core.ScopeRegistry-functions">Functions<a href="#hookedllm.core.ScopeRegistry-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.ScopeRegistry.get_global_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_global_scope</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span></code>

<a href="#hookedllm.core.ScopeRegistry.get_global_scope" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the global scope (always active).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_global_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the global scope (always active).&quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.ScopeRegistry.get_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span></code>

<a href="#hookedllm.core.ScopeRegistry.get_scope" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get or create a named scope.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get or create a named scope.&quot;&quot;&quot;</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.ScopeRegistry.get_scopes_for_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scopes_for_client</span><span class="p">(</span><span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span></code>

<a href="#hookedllm.core.ScopeRegistry.get_scopes_for_client" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get list of scopes for a client.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scopes_for_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of scopes for a client.&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.TagRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">TagRule</span><span class="p">(</span><span class="n">tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">require_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.TagRule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Match if context has specific tag(s).</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<h5 id="hookedllm.core-modules">Modules<a href="#hookedllm.core-modules" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-module">



<h6 id="hookedllm.core.executor" class="doc doc-heading">
            <code>executor</code>


<a href="#hookedllm.core.executor" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

        <p>Hook executor with dependency injection.</p>
<p>Executes hooks with rule matching while isolating failures.</p>










<div class="doc doc-children">







<h7 id="hookedllm.core.executor-classes">Classes<a href="#hookedllm.core.executor-classes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.executor.DefaultHookExecutor" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">DefaultHookExecutor</span><span class="p">(</span><span class="n">error_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="ne">Exception</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#hookedllm.core.executor.DefaultHookExecutor" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Concrete hook executor with dependency injection.</p>
<p>Single Responsibility: Only executes hooks, doesn't store them.
Dependencies injected: error_handler, logger</p>
<p>Guarantees:
- Hook failures never break the main LLM call
- Hooks execute in order
- Rules are evaluated before execution</p>

        <p>Initialize executor with optional dependencies.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>error_handler</code>
            </td>
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[[<span title="Exception">Exception</span>, <span title="str">str</span>], None] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Called when a hook fails. Signature: (error, context_str)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger instance (must have .error() method)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">error_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="ne">Exception</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">logger</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="p">):</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    Initialize executor with optional dependencies.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        error_handler: Called when a hook fails. Signature: (error, context_str)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        logger: Logger instance (must have .error() method)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span> <span class="o">=</span> <span class="n">error_handler</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_error_handler</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logger</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h9 id="hookedllm.core.executor.DefaultHookExecutor-functions">Functions<a href="#hookedllm.core.executor.DefaultHookExecutor-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.executor.DefaultHookExecutor.execute_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_after</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.executor.DefaultHookExecutor.execute_after" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Execute after hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.AfterHook">AfterHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_output</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call output</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_after</span><span class="p">(</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Execute after hooks with rule matching.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        call_output: The LLM call output</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">call_output</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;After hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.executor.DefaultHookExecutor.execute_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_before</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.executor.DefaultHookExecutor.execute_before" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Execute before hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.BeforeHook">BeforeHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_before</span><span class="p">(</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    Execute before hooks with rule matching.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Before hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Before hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.executor.DefaultHookExecutor.execute_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_error</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.executor.DefaultHookExecutor.execute_error" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Execute error hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.ErrorHook">ErrorHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>error</code>
            </td>
            <td>
                  <code><span title="BaseException">BaseException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The error that occurred</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_error</span><span class="p">(</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    Execute error hooks with rule matching.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        error: The error that occurred</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Error hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.executor.DefaultHookExecutor.execute_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_finally</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.executor.DefaultHookExecutor.execute_finally" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Execute finally hooks.</p>
<p>Note: Finally hooks don't use rule matching - they always run.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.FinallyHook">FinallyHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples (rule is ignored for finally hooks)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallResult(input: CallInput, output: CallOutput | None, context: CallContext, error: BaseException | None, ended_at: datetime, elapsed_ms: float)

  
      dataclass
   (hookedllm.core.types.CallResult)" href="#hookedllm.core.types.CallResult">CallResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complete call result</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_finally</span><span class="p">(</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Execute finally hooks.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    Note: Finally hooks don&#39;t use rule matching - they always run.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        hooks: List of (hook, rule) tuples (rule is ignored for finally hooks)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        result: The complete call result</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">_rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="c1"># Finally hooks always run, ignore rule</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Finally hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finally hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h6 id="hookedllm.core.protocols" class="doc doc-heading">
            <code>protocols</code>


<a href="#hookedllm.core.protocols" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

        <p>Protocol definitions for hooks and dependency injection.</p>
<p>These protocols define the interfaces that components must implement,
following the Dependency Inversion Principle.</p>










<div class="doc doc-children">







<h7 id="hookedllm.core.protocols-classes">Classes<a href="#hookedllm.core.protocols-classes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.protocols.HookExecutor" class="doc doc-heading">
            <code>HookExecutor</code>


<a href="#hookedllm.core.protocols.HookExecutor" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for executing hooks.</p>
<p>Single Responsibility: Hook execution only, no storage.</p>











<div class="doc doc-children">








<h9 id="hookedllm.core.protocols.HookExecutor-functions">Functions<a href="#hookedllm.core.protocols.HookExecutor-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.HookExecutor.execute_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_after</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.protocols.HookExecutor.execute_after" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Execute after hooks with rule matching.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_after</span><span class="p">(</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute after hooks with rule matching.&quot;&quot;&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.HookExecutor.execute_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_before</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.protocols.HookExecutor.execute_before" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Execute before hooks with rule matching.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_before</span><span class="p">(</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute before hooks with rule matching.&quot;&quot;&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.HookExecutor.execute_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_error</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.protocols.HookExecutor.execute_error" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Execute error hooks with rule matching.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_error</span><span class="p">(</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute error hooks with rule matching.&quot;&quot;&quot;</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.HookExecutor.execute_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_finally</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.protocols.HookExecutor.execute_finally" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Execute finally hooks.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_finally</span><span class="p">(</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute finally hooks.&quot;&quot;&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.protocols.Rule" class="doc doc-heading">
            <code>Rule</code>


<a href="#hookedllm.core.protocols.Rule" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for hook execution rules.</p>
<p>Rules determine whether a hook should execute based on the
call input and context.</p>











<div class="doc doc-children">








<h9 id="hookedllm.core.protocols.Rule-functions">Functions<a href="#hookedllm.core.protocols.Rule-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.Rule.__and__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__and__</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span></code>

<a href="#hookedllm.core.protocols.Rule.__and__" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Combine rules with AND logic.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="k">def</span><span class="w"> </span><span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span><span class="p">:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine rules with AND logic.&quot;&quot;&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.Rule.__invert__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__invert__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Rule</span></code>

<a href="#hookedllm.core.protocols.Rule.__invert__" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Negate the rule (NOT logic).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span><span class="w"> </span><span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Negate the rule (NOT logic).&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.Rule.__or__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__or__</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span></code>

<a href="#hookedllm.core.protocols.Rule.__or__" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Combine rules with OR logic.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="k">def</span><span class="w"> </span><span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine rules with OR logic.&quot;&quot;&quot;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.Rule.matches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

<a href="#hookedllm.core.protocols.Rule.matches" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Check if this rule matches the given call.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="k">def</span><span class="w"> </span><span class="nf">matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if this rule matches the given call.&quot;&quot;&quot;</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.protocols.ScopeHookStore" class="doc doc-heading">
            <code>ScopeHookStore</code>


<a href="#hookedllm.core.protocols.ScopeHookStore" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for storing hooks in a scope.</p>
<p>Single Responsibility: Storage only, no execution logic.</p>











<div class="doc doc-children">








<h9 id="hookedllm.core.protocols.ScopeHookStore-functions">Functions<a href="#hookedllm.core.protocols.ScopeHookStore-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.ScopeHookStore.add_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.add_after" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Add an after hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an after hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.ScopeHookStore.add_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.add_before" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Add a before hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a before hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.ScopeHookStore.add_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.add_error" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Add an error hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an error hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.ScopeHookStore.add_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_finally</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.add_finally" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Add a finally hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_finally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a finally hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.ScopeHookStore.get_after_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_after_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.get_after_hooks" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get all after hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_after_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all after hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.ScopeHookStore.get_before_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_before_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.get_before_hooks" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get all before hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_before_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all before hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.ScopeHookStore.get_error_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_error_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.get_error_hooks" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get all error hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_error_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all error hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.ScopeHookStore.get_finally_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_finally_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.get_finally_hooks" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get all finally hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_finally_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all finally hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.protocols.ScopeRegistry" class="doc doc-heading">
            <code>ScopeRegistry</code>


<a href="#hookedllm.core.protocols.ScopeRegistry" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for managing scopes.</p>
<p>Single Responsibility: Scope lifecycle management only.</p>











<div class="doc doc-children">








<h9 id="hookedllm.core.protocols.ScopeRegistry-functions">Functions<a href="#hookedllm.core.protocols.ScopeRegistry-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.ScopeRegistry.get_global_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_global_scope</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span></code>

<a href="#hookedllm.core.protocols.ScopeRegistry.get_global_scope" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get the global scope (always active).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_global_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the global scope (always active).&quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.ScopeRegistry.get_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span></code>

<a href="#hookedllm.core.protocols.ScopeRegistry.get_scope" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get or create a named scope.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get or create a named scope.&quot;&quot;&quot;</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.protocols.ScopeRegistry.get_scopes_for_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scopes_for_client</span><span class="p">(</span><span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span></code>

<a href="#hookedllm.core.protocols.ScopeRegistry.get_scopes_for_client" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get list of scopes for a client.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scopes_for_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of scopes for a client.&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h6 id="hookedllm.core.rules" class="doc doc-heading">
            <code>rules</code>


<a href="#hookedllm.core.rules" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

        <p>Rule system for conditional hook execution.</p>
<p>Rules determine when hooks should execute based on call input and context.
Supports composition via AND, OR, NOT operations.</p>










<div class="doc doc-children">







<h7 id="hookedllm.core.rules-classes">Classes<a href="#hookedllm.core.rules-classes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.rules.CompositeRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CompositeRule</span><span class="p">(</span><span class="n">rules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">operator</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;and&#39;</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.rules.CompositeRule" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Combine multiple rules with AND/OR logic.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.rules.CustomRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CustomRule</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.rules.CustomRule" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Custom predicate function.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.rules.MetadataRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">MetadataRule</span><span class="p">(</span><span class="n">conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.rules.MetadataRule" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Match based on metadata key-value pairs.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.rules.ModelRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">ModelRule</span><span class="p">(</span><span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.rules.ModelRule" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Match specific model(s).</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.rules.NotRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">NotRule</span><span class="p">(</span><span class="n">rule</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.rules.NotRule" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Negate a rule.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.rules.RuleBuilder" class="doc doc-heading">
            <code>RuleBuilder</code>


<a href="#hookedllm.core.rules.RuleBuilder" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Fluent API for building rules.</p>
<p>Used via the 'when' global instance.</p>











<div class="doc doc-children">








<h9 id="hookedllm.core.rules.RuleBuilder-functions">Functions<a href="#hookedllm.core.rules.RuleBuilder-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.rules.RuleBuilder.always" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">always</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.rules.RuleBuilder.always" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Always matches.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="k">def</span><span class="w"> </span><span class="nf">always</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span><span class="p">:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Always matches.&quot;&quot;&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="k">return</span> <span class="n">CustomRule</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.rules.RuleBuilder.custom" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">custom</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.rules.RuleBuilder.custom" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Custom predicate function.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>when.custom(lambda i, c: c.metadata.get("score", 0) &gt; 0.8)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="k">def</span><span class="w"> </span><span class="nf">custom</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    Custom predicate function.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        when.custom(lambda i, c: c.metadata.get(&quot;score&quot;, 0) &gt; 0.8)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">return</span> <span class="n">CustomRule</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.rules.RuleBuilder.metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metadata</span><span class="p">(</span><span class="o">**</span><span class="n">conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetadataRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.rules.RuleBuilder.metadata" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Match metadata conditions.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>when.metadata(user_tier="premium", region="us-east")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="k">def</span><span class="w"> </span><span class="nf">metadata</span><span class="p">(</span><span class="o">**</span><span class="n">conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetadataRule</span><span class="p">:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    Match metadata conditions.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        when.metadata(user_tier=&quot;premium&quot;, region=&quot;us-east&quot;)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">return</span> <span class="n">MetadataRule</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.rules.RuleBuilder.model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model</span><span class="p">(</span><span class="o">*</span><span class="n">models</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.rules.RuleBuilder.model" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Match specific model(s).</p>


<details class="example" open>
  <summary>Example</summary>
  <p>when.model("gpt-4", "gpt-4-turbo")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="o">*</span><span class="n">models</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelRule</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    Match specific model(s).</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        when.model(&quot;gpt-4&quot;, &quot;gpt-4-turbo&quot;)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="k">return</span> <span class="n">ModelRule</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.rules.RuleBuilder.never" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">never</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.rules.RuleBuilder.never" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Never matches.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="k">def</span><span class="w"> </span><span class="nf">never</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Never matches.&quot;&quot;&quot;</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="k">return</span> <span class="n">CustomRule</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.rules.RuleBuilder.tag" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tag</span><span class="p">(</span><span class="o">*</span><span class="n">tags</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">all_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TagRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.rules.RuleBuilder.tag" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Match if context has tag(s).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>*tags</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tag names to match</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>all_</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, all tags must be present. If False, any tag matches.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>when.tag("production", "critical")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="k">def</span><span class="w"> </span><span class="nf">tag</span><span class="p">(</span><span class="o">*</span><span class="n">tags</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">all_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TagRule</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    Match if context has tag(s).</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        *tags: Tag names to match</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        all_: If True, all tags must be present. If False, any tag matches.</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        when.tag(&quot;production&quot;, &quot;critical&quot;)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">return</span> <span class="n">TagRule</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">),</span> <span class="n">require_all</span><span class="o">=</span><span class="n">all_</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.rules.TagRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">TagRule</span><span class="p">(</span><span class="n">tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">require_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.rules.TagRule" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Match if context has specific tag(s).</p>











<div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h6 id="hookedllm.core.scopes" class="doc doc-heading">
            <code>scopes</code>


<a href="#hookedllm.core.scopes" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

        <p>Scope management for isolated hook execution.</p>
<p>Scopes allow hooks to be registered and executed only for specific clients,
preventing interference across different application contexts.</p>










<div class="doc doc-children">







<h7 id="hookedllm.core.scopes-classes">Classes<a href="#hookedllm.core.scopes-classes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="n">scope_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Concrete implementation of ScopeHookStore.</p>
<p>Single Responsibility: Only stores hooks.
Stores hooks in memory with their associated rules.</p>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_name</span> <span class="o">=</span> <span class="n">scope_name</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_finally</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">





<h9 id="hookedllm.core.scopes.InMemoryScopeHookStore-attributes">Attributes<a href="#hookedllm.core.scopes.InMemoryScopeHookStore-attributes" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-attribute">



<h10 id="hookedllm.core.scopes.InMemoryScopeHookStore.name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.name" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get the scope name.</p>

    </div>

</div>


<h9 id="hookedllm.core.scopes.InMemoryScopeHookStore-functions">Functions<a href="#hookedllm.core.scopes.InMemoryScopeHookStore-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeHookStore.add_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.add_after" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Add an after hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an after hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeHookStore.add_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.add_before" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Add a before hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a before hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeHookStore.add_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.add_error" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Add an error hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an error hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeHookStore.add_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_finally</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.add_finally" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Add a finally hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_finally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a finally hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_finally</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeHookStore.after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.after" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Alias for add_after with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span><span class="w"> </span><span class="nf">after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_after with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_after</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeHookStore.before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.before" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Alias for add_before with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="k">def</span><span class="w"> </span><span class="nf">before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_before with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_before</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeHookStore.error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.error" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Alias for add_error with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_error with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeHookStore.finally_" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finally_</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.finally_" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Alias for add_finally with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="nf">finally_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_finally with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_finally</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeHookStore.get_after_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_after_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.get_after_hooks" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get all after hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_after_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all after hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeHookStore.get_before_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_before_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.get_before_hooks" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get all before hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_before_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all before hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeHookStore.get_error_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_error_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.get_error_hooks" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get all error hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_error_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all error hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeHookStore.get_finally_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_finally_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.get_finally_hooks" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get all finally hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_finally_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all finally hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finally</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.scopes.InMemoryScopeRegistry" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">InMemoryScopeRegistry</span><span class="p">()</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeRegistry" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Concrete implementation of ScopeRegistry.</p>
<p>Single Responsibility: Only manages scope lifecycle.
Creates and retrieves scopes, manages global scope.</p>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InMemoryScopeHookStore</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_global</span> <span class="o">=</span> <span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="s2">&quot;__global__&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h9 id="hookedllm.core.scopes.InMemoryScopeRegistry-functions">Functions<a href="#hookedllm.core.scopes.InMemoryScopeRegistry-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeRegistry.get_global_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_global_scope</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeRegistry.get_global_scope" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get the global scope (always active).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="InMemoryScopeHookStore(scope_name: str) (hookedllm.core.scopes.InMemoryScopeHookStore)" href="#hookedllm.core.scopes.InMemoryScopeHookStore">InMemoryScopeHookStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The global scope hook store</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_global_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    Get the global scope (always active).</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        The global scope hook store</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeRegistry.get_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeRegistry.get_scope" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get or create a named scope.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="InMemoryScopeHookStore(scope_name: str) (hookedllm.core.scopes.InMemoryScopeHookStore)" href="#hookedllm.core.scopes.InMemoryScopeHookStore">InMemoryScopeHookStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope hook store for the named scope</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Get or create a named scope.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        name: Scope name</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        Scope hook store for the named scope</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeRegistry.get_scopes_for_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scopes_for_client</span><span class="p">(</span><span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeRegistry.get_scopes_for_client" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get list of scopes for a client.</p>
<p>Always includes the global scope, plus any requested scopes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>scope_names</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope names, or None for global only</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.protocols.ScopeHookStore)" href="#hookedllm.core.protocols.ScopeHookStore">ScopeHookStore</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope hook stores (global + requested scopes)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scopes_for_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Get list of scopes for a client.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Always includes the global scope, plus any requested scopes.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        scope_names: List of scope names, or None for global only</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        List of scope hook stores (global + requested scopes)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_global</span><span class="p">]</span>  <span class="c1"># Always include global</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="n">scope_names</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">scope_names</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">scopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">return</span> <span class="n">scopes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.scopes.InMemoryScopeRegistry.scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeRegistry.scope" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Alias for get_scope for more fluent API.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="k">def</span><span class="w"> </span><span class="nf">scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for get_scope for more fluent API.&quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h6 id="hookedllm.core.types" class="doc doc-heading">
            <code>types</code>


<a href="#hookedllm.core.types" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

        <p>Core data types for hookedllm.</p>
<p>These types represent the data that flows through the hook system.</p>










<div class="doc doc-children">







<h7 id="hookedllm.core.types-classes">Classes<a href="#hookedllm.core.types-classes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.types.CallContext" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallContext</span><span class="p">(</span><span class="n">call_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))(),</span> <span class="n">parent_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">route</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;chat&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="n">started_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))(),</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">())</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.types.CallContext" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Context for a single LLM call lifecycle.</p>
<p>Contains metadata about the call including timing, tags, and custom metadata.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.types.CallInput" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallInput</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Message</span><span class="p">],</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">())</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.types.CallInput" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Normalized input for an LLM call.</p>
<p>This represents the input parameters in a provider-agnostic way.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.types.CallOutput" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallOutput</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">raw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">usage</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">finish_reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.types.CallOutput" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Normalized output from an LLM call.</p>
<p>This represents the response in a provider-agnostic way while
preserving the original response object.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.types.CallResult" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallResult</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">CallOutput</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ended_at</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">elapsed_ms</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.types.CallResult" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Complete result of an LLM call.</p>
<p>Contains the input, output, context, any error that occurred,
and timing information. This is passed to finally hooks.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.types.Message" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">Message</span><span class="p">(</span><span class="n">role</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.types.Message" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>A single message in an LLM conversation.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h6 id="hookedllm.core.wrapper" class="doc doc-heading">
            <code>wrapper</code>


<a href="#hookedllm.core.wrapper" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

        <p>Transparent wrapper for intercepting LLM API calls.</p>
<p>Wraps provider clients to inject hook execution while preserving
the original SDK interface and return types.</p>










<div class="doc doc-children">







<h7 id="hookedllm.core.wrapper-classes">Classes<a href="#hookedllm.core.wrapper-classes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.wrapper.HookedClientWrapper" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">HookedClientWrapper</span><span class="p">(</span><span class="n">original_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">)</span></code>

<a href="#hookedllm.core.wrapper.HookedClientWrapper" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Transparent proxy with all dependencies injected.</p>
<p>No global state - all dependencies passed via constructor (DI).
Intercepts provider SDK methods to inject hook execution.</p>

        <p>Initialize wrapper with injected dependencies.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>original_client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The original provider client</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scopes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.protocols.ScopeHookStore)" href="#hookedllm.core.protocols.ScopeHookStore">ScopeHookStore</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope hook stores to use</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>executor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="HookExecutor (hookedllm.core.protocols.HookExecutor)" href="#hookedllm.core.protocols.HookExecutor">HookExecutor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hook executor instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">):</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Initialize wrapper with injected dependencies.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        original_client: The original provider client</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        scopes: List of scope hook stores to use</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        executor: Hook executor instance</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_original</span> <span class="o">=</span> <span class="n">original_client</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span> <span class="o">=</span> <span class="n">scopes</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">executor</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span> <span class="o">=</span> <span class="n">_detect_provider_adapter</span><span class="p">(</span><span class="n">original_client</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span><span class="o">.</span><span class="n">get_wrapper_path</span><span class="p">(</span><span class="n">original_client</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h9 id="hookedllm.core.wrapper.HookedClientWrapper-functions">Functions<a href="#hookedllm.core.wrapper.HookedClientWrapper-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.wrapper.HookedClientWrapper.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

<a href="#hookedllm.core.wrapper.HookedClientWrapper.__getattr__" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Intercept attribute access.</p>
<p>Wraps attributes based on the detected provider's wrapper path.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Intercept attribute access.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Wraps attributes based on the detected provider&#39;s wrapper path.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="c1"># Check if this attribute is part of the wrapper path</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="c1"># Create a dynamic wrapper for the next level</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">return</span> <span class="n">_create_wrapper_for_path</span><span class="p">(</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">return</span> <span class="n">attr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.wrapper.HookedCompletionsWrapper" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">HookedCompletionsWrapper</span><span class="p">(</span><span class="n">original_completions</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">,</span> <span class="n">adapter</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span></code>

<a href="#hookedllm.core.wrapper.HookedCompletionsWrapper" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Wraps completions.create() with hook execution.</p>
<p>All dependencies injected, no global state.</p>

        <p>Initialize completions wrapper.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>original_completions</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original completions object from SDK</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scopes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.protocols.ScopeHookStore)" href="#hookedllm.core.protocols.ScopeHookStore">ScopeHookStore</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope hook stores</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>executor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="HookExecutor (hookedllm.core.protocols.HookExecutor)" href="#hookedllm.core.protocols.HookExecutor">HookExecutor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hook executor instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>adapter</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Provider adapter instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="n">original_completions</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">,</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="n">adapter</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="p">):</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    Initialize completions wrapper.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        original_completions: Original completions object from SDK</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        scopes: List of scope hook stores</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        executor: Hook executor instance</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        adapter: Provider adapter instance</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_original</span> <span class="o">=</span> <span class="n">original_completions</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span> <span class="o">=</span> <span class="n">scopes</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">executor</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span> <span class="o">=</span> <span class="n">adapter</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h9 id="hookedllm.core.wrapper.HookedCompletionsWrapper-functions">Functions<a href="#hookedllm.core.wrapper.HookedCompletionsWrapper-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.wrapper.HookedCompletionsWrapper.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

<a href="#hookedllm.core.wrapper.HookedCompletionsWrapper.__getattr__" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Pass through other attributes to original object.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass through other attributes to original object.&quot;&quot;&quot;</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.wrapper.HookedCompletionsWrapper.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.wrapper.HookedCompletionsWrapper.create" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Hooked create method.</p>
<p>Flow:
1. Use adapter to normalize input (extracts tags, metadata, creates CallInput/Context)
2. Collect all hooks from all scopes
3. Execute before hooks
4. Call original SDK method
5. Use adapter to normalize output
6. Execute after hooks (on success) or error hooks (on failure)
7. Always execute finally hooks
8. Return original SDK response type</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>messages</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of message dicts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Other parameters passed to SDK</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original SDK response object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    Hooked create method.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">    Flow:</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">    1. Use adapter to normalize input (extracts tags, metadata, creates CallInput/Context)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    2. Collect all hooks from all scopes</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    3. Execute before hooks</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    4. Call original SDK method</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">    5. Use adapter to normalize output</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    6. Execute after hooks (on success) or error hooks (on failure)</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    7. Always execute finally hooks</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    8. Return original SDK response type</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        model: Model name</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        messages: List of message dicts</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        **kwargs: Other parameters passed to SDK</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        Original SDK response object</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="c1"># Use adapter to normalize input</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="n">call_input</span><span class="p">,</span> <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span><span class="o">.</span><span class="n">normalize_input</span><span class="p">(</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span><span class="o">.</span><span class="n">PROVIDER_NAME</span><span class="p">,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="o">.</span><span class="n">create</span><span class="p">,</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="c1"># Collect all hooks from all scopes</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="n">all_before</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="n">all_after</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="n">all_error</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="n">all_finally</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="k">for</span> <span class="n">scope</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="n">all_before</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">get_before_hooks</span><span class="p">())</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">all_after</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">get_after_hooks</span><span class="p">())</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">all_error</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">get_error_hooks</span><span class="p">())</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="n">all_finally</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">get_finally_hooks</span><span class="p">())</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="c1"># Execute hook flow</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="c1"># Before hooks</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">execute_before</span><span class="p">(</span><span class="n">all_before</span><span class="p">,</span> <span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="c1"># Original SDK call</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="c1"># Use adapter to normalize output</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span><span class="o">.</span><span class="n">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="c1"># After hooks</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">execute_after</span><span class="p">(</span><span class="n">all_after</span><span class="p">,</span> <span class="n">call_input</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="k">return</span> <span class="n">response</span>  <span class="c1"># Return ORIGINAL SDK response!</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="n">error</span> <span class="o">=</span> <span class="n">e</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">execute_error</span><span class="p">(</span><span class="n">all_error</span><span class="p">,</span> <span class="n">call_input</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="k">raise</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="n">elapsed</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1000.0</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">CallResult</span><span class="p">(</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="nb">input</span><span class="o">=</span><span class="n">call_input</span><span class="p">,</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="n">ended_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="n">elapsed_ms</span><span class="o">=</span><span class="n">elapsed</span><span class="p">,</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">execute_finally</span><span class="p">(</span><span class="n">all_finally</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.core.wrapper.HookedPathWrapper" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">HookedPathWrapper</span><span class="p">(</span><span class="n">original_obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">remaining_path</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">,</span> <span class="n">adapter</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span></code>

<a href="#hookedllm.core.wrapper.HookedPathWrapper" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Intermediate wrapper for provider-specific attribute paths.</p>
<p>Handles paths like ["chat", "completions"] for OpenAI or ["messages"] for Anthropic.</p>

        <p>Initialize path wrapper.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>original_obj</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The object being wrapped</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>remaining_path</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Remaining attribute names to intercept</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scopes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.protocols.ScopeHookStore)" href="#hookedllm.core.protocols.ScopeHookStore">ScopeHookStore</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope hook stores</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>executor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="HookExecutor (hookedllm.core.protocols.HookExecutor)" href="#hookedllm.core.protocols.HookExecutor">HookExecutor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hook executor instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>adapter</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Provider adapter instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="n">original_obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="n">remaining_path</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="n">adapter</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="p">):</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    Initialize path wrapper.</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        original_obj: The object being wrapped</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        remaining_path: Remaining attribute names to intercept</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        scopes: List of scope hook stores</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        executor: Hook executor instance</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        adapter: Provider adapter instance</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_original</span> <span class="o">=</span> <span class="n">original_obj</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_remaining_path</span> <span class="o">=</span> <span class="n">remaining_path</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span> <span class="o">=</span> <span class="n">scopes</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">executor</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span> <span class="o">=</span> <span class="n">adapter</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h9 id="hookedllm.core.wrapper.HookedPathWrapper-functions">Functions<a href="#hookedllm.core.wrapper.HookedPathWrapper-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.core.wrapper.HookedPathWrapper.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

<a href="#hookedllm.core.wrapper.HookedPathWrapper.__getattr__" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Intercept attribute access.</p>
<p>If the attribute matches the next in the path, wrap it.
Otherwise pass through.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    Intercept attribute access.</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    If the attribute matches the next in the path, wrap it.</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    Otherwise pass through.</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_remaining_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remaining_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="c1"># Continue wrapping down the path</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="k">return</span> <span class="n">_create_wrapper_for_path</span><span class="p">(</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remaining_path</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="p">)</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="k">return</span> <span class="n">attr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.hooks" class="doc doc-heading">
            <code>hooks</code>


<a href="#hookedllm.hooks" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Built-in hook helpers for common use cases.</p>










<div class="doc doc-children">







<h5 id="hookedllm.hooks-classes">Classes<a href="#hookedllm.hooks-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.hooks.EvaluationHook" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">EvaluationHook</span><span class="p">(</span><span class="n">evaluator_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;gpt-4o-mini&#39;</span><span class="p">,</span> <span class="n">store_in_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></code>

<a href="#hookedllm.hooks.EvaluationHook" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Evaluate LLM responses using another LLM.</p>
<p>This is an after hook that calls a separate "evaluator" LLM to assess
the quality of responses based on configurable criteria.</p>


<details class="usage" open>
  <summary>Usage</summary>
  <p>from openai import AsyncOpenAI</p>
<p>evaluator = AsyncOpenAI()  # Separate client for evaluation
criteria = {
    "clarity": "Is the response clear and easy to understand?",
    "accuracy": "Is the response factually accurate?",
    "relevance": "Does the response address the user's question?"
}</p>
<p>eval_hook = EvaluationHook(evaluator, criteria)
hookedllm.scope("evaluation").after(eval_hook)</p>
</details>
        <p>Initialize evaluation hook.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>evaluator_client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OpenAI-compatible client for evaluation calls</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>criteria</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping criterion name to description</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model to use for evaluation (default: gpt-4o-mini)</p>
              </div>
            </td>
            <td>
                  <code>&#39;gpt-4o-mini&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>store_in_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, store results in context.metadata</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/hooks/evaluation.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">evaluator_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">criteria</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">store_in_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="p">):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Initialize evaluation hook.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        evaluator_client: OpenAI-compatible client for evaluation calls</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        criteria: Dict mapping criterion name to description</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        model: Model to use for evaluation (default: gpt-4o-mini)</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        store_in_metadata: If True, store results in context.metadata</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">evaluator_client</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">store_in_metadata</span> <span class="o">=</span> <span class="n">store_in_metadata</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h7 id="hookedllm.hooks.EvaluationHook-functions">Functions<a href="#hookedllm.hooks.EvaluationHook-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.hooks.EvaluationHook.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.hooks.EvaluationHook.__call__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Evaluate the LLM response.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The original call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_output</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM response</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/evaluation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Evaluate the LLM response.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        call_input: The original call input</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        call_output: The LLM response</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">call_output</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="c1"># Nothing to evaluate</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="k">return</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="c1"># Extract the original query</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">original_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_query</span><span class="p">(</span><span class="n">call_input</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="c1"># Build evaluation prompt</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">eval_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_evaluation_prompt</span><span class="p">(</span><span class="n">original_query</span><span class="p">,</span> <span class="n">call_output</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="c1"># Call evaluator</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">eval_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">eval_prompt</span><span class="p">}],</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="n">temperature</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Deterministic evaluation</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="c1"># Extract evaluation result</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">eval_text</span> <span class="o">=</span> <span class="n">eval_response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="c1"># Try to parse as JSON</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">eval_result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">eval_text</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="c1"># If not JSON, store raw text</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">eval_result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;raw_evaluation&quot;</span><span class="p">:</span> <span class="n">eval_text</span><span class="p">}</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="c1"># Store in context if requested</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_in_metadata</span><span class="p">:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">context</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;evaluation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eval_result</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">context</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;evaluation_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="c1"># Evaluation failed - don&#39;t break the main flow</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_in_metadata</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="n">context</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;evaluation_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.hooks.MetricsHook" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">MetricsHook</span><span class="p">(</span><span class="n">stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#hookedllm.hooks.MetricsHook" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Track metrics across LLM calls.</p>
<p>This is a finally hook that aggregates metrics including:
- Total calls
- Total tokens used
- Error count
- Average latency</p>


<details class="usage" open>
  <summary>Usage</summary>
  <p>metrics = MetricsHook()
hookedllm.finally_(metrics)</p>
<h6 id="hookedllm.hooks.MetricsHook--later-access-metrics">Later, access metrics<a class="headerlink" href="#hookedllm.hooks.MetricsHook--later-access-metrics" title="Permanent link">&para;</a></h6>
<p>print(metrics.stats)</p>
</details>
        <p>Initialize metrics hook.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>stats</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional existing stats dict to update.
   If None, creates a new dict.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    Initialize metrics hook.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        stats: Optional existing stats dict to update.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">               If None, creates a new dict.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="k">if</span> <span class="n">stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>            <span class="s2">&quot;total_calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>            <span class="s2">&quot;successful_calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="s2">&quot;failed_calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="s2">&quot;total_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="s2">&quot;prompt_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>            <span class="s2">&quot;completion_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="s2">&quot;total_latency_ms&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="p">}</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">





<h7 id="hookedllm.hooks.MetricsHook-attributes">Attributes<a href="#hookedllm.hooks.MetricsHook-attributes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-attribute">



<h8 id="hookedllm.hooks.MetricsHook.average_latency_ms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">average_latency_ms</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.hooks.MetricsHook.average_latency_ms" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Calculate average latency.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="hookedllm.hooks.MetricsHook.error_rate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">error_rate</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.hooks.MetricsHook.error_rate" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Calculate error rate (0.0 to 1.0).</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="hookedllm.hooks.MetricsHook.success_rate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">success_rate</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.hooks.MetricsHook.success_rate" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Calculate success rate (0.0 to 1.0).</p>

    </div>

</div>


<h7 id="hookedllm.hooks.MetricsHook-functions">Functions<a href="#hookedllm.hooks.MetricsHook-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.hooks.MetricsHook.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.hooks.MetricsHook.__call__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Update metrics based on call result.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallResult(input: CallInput, output: CallOutput | None, context: CallContext, error: BaseException | None, ended_at: datetime, elapsed_ms: float)

  
      dataclass
   (hookedllm.core.types.CallResult)" href="#hookedllm.core.types.CallResult">CallResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complete call result</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Update metrics based on call result.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        result: The complete call result</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="c1"># Increment total calls</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;total_calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="c1"># Track success/failure</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;successful_calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;failed_calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="c1"># Track tokens</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">usage</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">usage</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">usage</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;total_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;prompt_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prompt_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;completion_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;completion_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="c1"># Track latency</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;total_latency_ms&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">result</span><span class="o">.</span><span class="n">elapsed_ms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.hooks.MetricsHook.reset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reset</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.hooks.MetricsHook.reset" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Reset all metrics to zero.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset all metrics to zero.&quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">:</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.hooks.MetricsHook.summary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">summary</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>

<a href="#hookedllm.hooks.MetricsHook.summary" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get a summary of metrics including calculated values.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict with all metrics plus calculated averages</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    Get a summary of metrics including calculated values.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        Dict with all metrics plus calculated averages</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="s2">&quot;average_latency_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_latency_ms</span><span class="p">,</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="s2">&quot;success_rate&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_rate</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="s2">&quot;error_rate&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_rate</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<h5 id="hookedllm.hooks-modules">Modules<a href="#hookedllm.hooks-modules" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-module">



<h6 id="hookedllm.hooks.evaluation" class="doc doc-heading">
            <code>evaluation</code>


<a href="#hookedllm.hooks.evaluation" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

        <p>Built-in evaluation hook helper.</p>
<p>Provides a helper for evaluating LLM responses using another LLM.</p>










<div class="doc doc-children">







<h7 id="hookedllm.hooks.evaluation-classes">Classes<a href="#hookedllm.hooks.evaluation-classes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.hooks.evaluation.EvaluationHook" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">EvaluationHook</span><span class="p">(</span><span class="n">evaluator_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;gpt-4o-mini&#39;</span><span class="p">,</span> <span class="n">store_in_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></code>

<a href="#hookedllm.hooks.evaluation.EvaluationHook" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Evaluate LLM responses using another LLM.</p>
<p>This is an after hook that calls a separate "evaluator" LLM to assess
the quality of responses based on configurable criteria.</p>


<details class="usage" open>
  <summary>Usage</summary>
  <p>from openai import AsyncOpenAI</p>
<p>evaluator = AsyncOpenAI()  # Separate client for evaluation
criteria = {
    "clarity": "Is the response clear and easy to understand?",
    "accuracy": "Is the response factually accurate?",
    "relevance": "Does the response address the user's question?"
}</p>
<p>eval_hook = EvaluationHook(evaluator, criteria)
hookedllm.scope("evaluation").after(eval_hook)</p>
</details>
        <p>Initialize evaluation hook.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>evaluator_client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OpenAI-compatible client for evaluation calls</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>criteria</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping criterion name to description</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model to use for evaluation (default: gpt-4o-mini)</p>
              </div>
            </td>
            <td>
                  <code>&#39;gpt-4o-mini&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>store_in_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, store results in context.metadata</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/hooks/evaluation.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">evaluator_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">criteria</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">store_in_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="p">):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Initialize evaluation hook.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        evaluator_client: OpenAI-compatible client for evaluation calls</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        criteria: Dict mapping criterion name to description</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        model: Model to use for evaluation (default: gpt-4o-mini)</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        store_in_metadata: If True, store results in context.metadata</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">evaluator_client</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">store_in_metadata</span> <span class="o">=</span> <span class="n">store_in_metadata</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h9 id="hookedllm.hooks.evaluation.EvaluationHook-functions">Functions<a href="#hookedllm.hooks.evaluation.EvaluationHook-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.hooks.evaluation.EvaluationHook.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.hooks.evaluation.EvaluationHook.__call__" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Evaluate the LLM response.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The original call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_output</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM response</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/evaluation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Evaluate the LLM response.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        call_input: The original call input</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        call_output: The LLM response</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">call_output</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="c1"># Nothing to evaluate</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="k">return</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="c1"># Extract the original query</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">original_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_query</span><span class="p">(</span><span class="n">call_input</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="c1"># Build evaluation prompt</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">eval_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_evaluation_prompt</span><span class="p">(</span><span class="n">original_query</span><span class="p">,</span> <span class="n">call_output</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="c1"># Call evaluator</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">eval_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">eval_prompt</span><span class="p">}],</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="n">temperature</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Deterministic evaluation</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="c1"># Extract evaluation result</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">eval_text</span> <span class="o">=</span> <span class="n">eval_response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="c1"># Try to parse as JSON</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">eval_result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">eval_text</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="c1"># If not JSON, store raw text</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">eval_result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;raw_evaluation&quot;</span><span class="p">:</span> <span class="n">eval_text</span><span class="p">}</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="c1"># Store in context if requested</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_in_metadata</span><span class="p">:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">context</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;evaluation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eval_result</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">context</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;evaluation_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="c1"># Evaluation failed - don&#39;t break the main flow</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_in_metadata</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="n">context</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;evaluation_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h6 id="hookedllm.hooks.metrics" class="doc doc-heading">
            <code>metrics</code>


<a href="#hookedllm.hooks.metrics" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

        <p>Built-in metrics tracking hook.</p>
<p>Tracks token usage, call counts, and error rates across LLM calls.</p>










<div class="doc doc-children">







<h7 id="hookedllm.hooks.metrics-classes">Classes<a href="#hookedllm.hooks.metrics-classes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.hooks.metrics.MetricsHook" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">MetricsHook</span><span class="p">(</span><span class="n">stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#hookedllm.hooks.metrics.MetricsHook" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Track metrics across LLM calls.</p>
<p>This is a finally hook that aggregates metrics including:
- Total calls
- Total tokens used
- Error count
- Average latency</p>


<details class="usage" open>
  <summary>Usage</summary>
  <p>metrics = MetricsHook()
hookedllm.finally_(metrics)</p>
<h6 id="hookedllm.hooks.metrics.MetricsHook--later-access-metrics">Later, access metrics<a class="headerlink" href="#hookedllm.hooks.metrics.MetricsHook--later-access-metrics" title="Permanent link">&para;</a></h6>
<p>print(metrics.stats)</p>
</details>
        <p>Initialize metrics hook.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>stats</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional existing stats dict to update.
   If None, creates a new dict.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    Initialize metrics hook.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        stats: Optional existing stats dict to update.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">               If None, creates a new dict.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="k">if</span> <span class="n">stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>            <span class="s2">&quot;total_calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>            <span class="s2">&quot;successful_calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="s2">&quot;failed_calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="s2">&quot;total_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="s2">&quot;prompt_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>            <span class="s2">&quot;completion_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="s2">&quot;total_latency_ms&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="p">}</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">





<h9 id="hookedllm.hooks.metrics.MetricsHook-attributes">Attributes<a href="#hookedllm.hooks.metrics.MetricsHook-attributes" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-attribute">



<h10 id="hookedllm.hooks.metrics.MetricsHook.average_latency_ms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">average_latency_ms</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.hooks.metrics.MetricsHook.average_latency_ms" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Calculate average latency.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h10 id="hookedllm.hooks.metrics.MetricsHook.error_rate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">error_rate</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.hooks.metrics.MetricsHook.error_rate" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Calculate error rate (0.0 to 1.0).</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h10 id="hookedllm.hooks.metrics.MetricsHook.success_rate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">success_rate</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.hooks.metrics.MetricsHook.success_rate" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Calculate success rate (0.0 to 1.0).</p>

    </div>

</div>


<h9 id="hookedllm.hooks.metrics.MetricsHook-functions">Functions<a href="#hookedllm.hooks.metrics.MetricsHook-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.hooks.metrics.MetricsHook.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.hooks.metrics.MetricsHook.__call__" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Update metrics based on call result.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallResult(input: CallInput, output: CallOutput | None, context: CallContext, error: BaseException | None, ended_at: datetime, elapsed_ms: float)

  
      dataclass
   (hookedllm.core.types.CallResult)" href="#hookedllm.core.types.CallResult">CallResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complete call result</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Update metrics based on call result.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        result: The complete call result</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="c1"># Increment total calls</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;total_calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="c1"># Track success/failure</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;successful_calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;failed_calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="c1"># Track tokens</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">usage</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">usage</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">usage</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;total_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;prompt_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prompt_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;completion_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;completion_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="c1"># Track latency</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;total_latency_ms&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">result</span><span class="o">.</span><span class="n">elapsed_ms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.hooks.metrics.MetricsHook.reset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reset</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.hooks.metrics.MetricsHook.reset" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Reset all metrics to zero.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset all metrics to zero.&quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">:</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.hooks.metrics.MetricsHook.summary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">summary</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>

<a href="#hookedllm.hooks.metrics.MetricsHook.summary" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get a summary of metrics including calculated values.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict with all metrics plus calculated averages</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    Get a summary of metrics including calculated values.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        Dict with all metrics plus calculated averages</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="s2">&quot;average_latency_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_latency_ms</span><span class="p">,</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="s2">&quot;success_rate&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_rate</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="s2">&quot;error_rate&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_rate</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.providers" class="doc doc-heading">
            <code>providers</code>


<a href="#hookedllm.providers" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Provider adapters for multi-provider support.</p>
<p>Each adapter handles provider-specific logic for detecting clients,
normalizing input/output, and extracting callable methods.</p>










<div class="doc doc-children">







<h5 id="hookedllm.providers-classes">Classes<a href="#hookedllm.providers-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.providers.ProviderAdapter" class="doc doc-heading">
            <code>ProviderAdapter</code>


<a href="#hookedllm.providers.ProviderAdapter" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for provider-specific adapters.</p>
<p>Each adapter handles:
- Detecting if a client belongs to this provider
- Normalizing provider-specific input/output formats
- Extracting the callable method from the client</p>
<p>This follows the Open/Closed Principle: new providers can be added
by implementing this protocol without modifying existing code.</p>











<div class="doc doc-children">








<h7 id="hookedllm.providers.ProviderAdapter-functions">Functions<a href="#hookedllm.providers.ProviderAdapter-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.ProviderAdapter.detect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.ProviderAdapter.detect" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Detect if a client belongs to this provider.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if this adapter can handle the client, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Detect if a client belongs to this provider.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        client: The client instance to check</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        True if this adapter can handle the client, False otherwise</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.ProviderAdapter.get_callable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.ProviderAdapter.get_callable" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the callable method from the client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The callable method (e.g., client.chat.completions.create)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AttributeError">AttributeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the callable cannot be found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Get the callable method from the client.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        client: The client instance</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        The callable method (e.g., client.chat.completions.create)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        AttributeError: If the callable cannot be found</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.ProviderAdapter.get_wrapper_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.ProviderAdapter.get_wrapper_path" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the attribute path to wrap (e.g., ["chat", "completions"]).</p>
<p>This is used by the wrapper to intercept the correct attributes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of attribute names to wrap</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    Get the attribute path to wrap (e.g., [&quot;chat&quot;, &quot;completions&quot;]).</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    This is used by the wrapper to intercept the correct attributes.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        client: The client instance</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        List of attribute names to wrap</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.ProviderAdapter.normalize_input" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_input</span><span class="p">(</span><span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.ProviderAdapter.normalize_input" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Normalize provider-specific input to CallInput and CallContext.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>provider_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the provider (e.g., "openai", "anthropic")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callable_method</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The callable method being called</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Positional arguments passed to the callable</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments passed to the callable</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a>, <a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (CallInput, CallContext)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_input</span><span class="p">(</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Normalize provider-specific input to CallInput and CallContext.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        provider_name: Name of the provider (e.g., &quot;openai&quot;, &quot;anthropic&quot;)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        callable_method: The callable method being called</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        *args: Positional arguments passed to the callable</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        **kwargs: Keyword arguments passed to the callable</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        Tuple of (CallInput, CallContext)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.ProviderAdapter.normalize_output" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.ProviderAdapter.normalize_output" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Normalize provider-specific response to CallOutput.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>response</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The raw response from the provider SDK</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized CallOutput</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span><span class="p">:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    Normalize provider-specific response to CallOutput.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        response: The raw response from the provider SDK</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Normalized CallOutput</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<h5 id="hookedllm.providers-modules">Modules<a href="#hookedllm.providers-modules" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-module">



<h6 id="hookedllm.providers.anthropic" class="doc doc-heading">
            <code>anthropic</code>


<a href="#hookedllm.providers.anthropic" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

        <p>Anthropic provider adapter.</p>
<p>Handles Anthropic SDK-specific logic for detecting clients,
normalizing input/output, and extracting callable methods.</p>










<div class="doc doc-children">







<h7 id="hookedllm.providers.anthropic-classes">Classes<a href="#hookedllm.providers.anthropic-classes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.providers.anthropic.AnthropicAdapter" class="doc doc-heading">
            <code>AnthropicAdapter</code>


<a href="#hookedllm.providers.anthropic.AnthropicAdapter" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Adapter for Anthropic SDK clients.</p>
<p>Supports both AsyncAnthropic and Anthropic clients.
Handles the Anthropic-specific API structure: client.messages.create()</p>











<div class="doc doc-children">








<h9 id="hookedllm.providers.anthropic.AnthropicAdapter-functions">Functions<a href="#hookedllm.providers.anthropic.AnthropicAdapter-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.anthropic.AnthropicAdapter.detect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.anthropic.AnthropicAdapter.detect" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Detect if a client is an Anthropic client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if client has Anthropic SDK structure, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/anthropic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    Detect if a client is an Anthropic client.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        client: The client instance to check</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        True if client has Anthropic SDK structure, False otherwise</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="c1"># Check for Anthropic structure</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="c1"># Must have messages.create and it should be callable</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">):</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="c1"># Verify it&#39;s actually callable (not just a MagicMock attribute)</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>            <span class="n">create_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">create_method</span><span class="p">):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>                <span class="c1"># Additional check: if client also has OpenAI structure (chat.completions.create),</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>                <span class="c1"># we need to prefer Anthropic only if messages.create was explicitly set</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>                <span class="c1"># For MagicMock, check if chat.completions.create exists - if it does and is callable,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>                <span class="c1"># we need to verify which one was set explicitly</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>                <span class="c1"># Since Anthropic is checked first, if both exist, prefer Anthropic</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>                <span class="c1"># But we should verify messages.create is the primary structure</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>                <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="k">pass</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.anthropic.AnthropicAdapter.get_callable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.anthropic.AnthropicAdapter.get_callable" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get the Anthropic messages.create callable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Anthropic client instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The messages.create method</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AttributeError">AttributeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the callable cannot be found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/anthropic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    Get the Anthropic messages.create callable.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        client: The Anthropic client instance</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        The messages.create method</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        AttributeError: If the callable cannot be found</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">create</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.anthropic.AnthropicAdapter.get_wrapper_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.anthropic.AnthropicAdapter.get_wrapper_path" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get the attribute path to wrap for Anthropic.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>["messages"] - the path to intercept</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/anthropic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    Get the attribute path to wrap for Anthropic.</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        [&quot;messages&quot;] - the path to intercept</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.anthropic.AnthropicAdapter.normalize_input" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_input</span><span class="p">(</span><span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.anthropic.AnthropicAdapter.normalize_input" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Normalize Anthropic input to CallInput and CallContext.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>provider_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Provider name (should be "anthropic")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callable_method</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The callable method (unused for Anthropic)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Positional arguments (unused for Anthropic)</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments including model, messages, etc.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a>, <a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (CallInput, CallContext)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/anthropic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_input</span><span class="p">(</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    Normalize Anthropic input to CallInput and CallContext.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        provider_name: Provider name (should be &quot;anthropic&quot;)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        callable_method: The callable method (unused for Anthropic)</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        *args: Positional arguments (unused for Anthropic)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        **kwargs: Keyword arguments including model, messages, etc.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        Tuple of (CallInput, CallContext)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">messages</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;messages&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="c1"># Anthropic uses metadata parameter instead of extra_body</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="n">metadata_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">tags</span> <span class="o">=</span> <span class="n">metadata_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;hookedllm_tags&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">custom_metadata</span> <span class="o">=</span> <span class="n">metadata_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;hookedllm_metadata&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">custom_metadata</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="c1"># Normalize messages to internal format</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="c1"># Anthropic messages have role and content fields</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">normalized_messages</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">role</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="c1"># Anthropic content can be a string or list of content blocks</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">content</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="c1"># Extract text from first text block if it&#39;s a list</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="n">first_block</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_block</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">first_block</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">first_block</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_block</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">first_block</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">normalized_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Message</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">))</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="c1"># Create normalized input</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">call_input</span> <span class="o">=</span> <span class="n">CallInput</span><span class="p">(</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">normalized_messages</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">custom_metadata</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="c1"># Create context</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="n">context</span> <span class="o">=</span> <span class="n">CallContext</span><span class="p">(</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">provider</span><span class="o">=</span><span class="n">provider_name</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">custom_metadata</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="k">return</span> <span class="n">call_input</span><span class="p">,</span> <span class="n">context</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.anthropic.AnthropicAdapter.normalize_output" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.anthropic.AnthropicAdapter.normalize_output" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Normalize Anthropic response to CallOutput.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>response</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Anthropic SDK response object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized CallOutput</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/anthropic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    Normalize Anthropic response to CallOutput.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        response: Anthropic SDK response object</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        Normalized CallOutput</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="c1"># Extract text from response</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="c1"># Anthropic response has content as a list of content blocks</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">text</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="n">first_content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_content</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">first_content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">first_content</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">first_content</span><span class="o">.</span><span class="n">text</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="c1"># Extract usage</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="c1"># Anthropic uses input_tokens and output_tokens</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="n">usage</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;usage&quot;</span><span class="p">):</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="n">usage_obj</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">usage</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;input_tokens&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;output_tokens&quot;</span><span class="p">):</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                <span class="c1"># Convert to dict format</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;model_dump&quot;</span><span class="p">):</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                    <span class="n">usage</span> <span class="o">=</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;dict&quot;</span><span class="p">):</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                    <span class="n">usage</span> <span class="o">=</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;__dict__&quot;</span><span class="p">):</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                    <span class="n">usage</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">usage_obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                    <span class="c1"># Fallback: create dict manually</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                    <span class="n">usage</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                        <span class="s2">&quot;input_tokens&quot;</span><span class="p">:</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">input_tokens</span><span class="p">,</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                        <span class="s2">&quot;output_tokens&quot;</span><span class="p">:</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">output_tokens</span><span class="p">,</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                        <span class="s2">&quot;total_tokens&quot;</span><span class="p">:</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">input_tokens</span> <span class="o">+</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">output_tokens</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                    <span class="p">}</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                <span class="c1"># Ensure total_tokens is present</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="k">if</span> <span class="n">usage</span> <span class="ow">and</span> <span class="s2">&quot;total_tokens&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">usage</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                    <span class="n">usage</span><span class="p">[</span><span class="s2">&quot;total_tokens&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;input_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                        <span class="s2">&quot;output_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                    <span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="c1"># Extract stop_reason (Anthropic&#39;s finish_reason)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">finish_reason</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;stop_reason&quot;</span><span class="p">):</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="n">finish_reason</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">stop_reason</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="k">return</span> <span class="n">CallOutput</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">,</span> <span class="n">finish_reason</span><span class="o">=</span><span class="n">finish_reason</span><span class="p">)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="c1"># If normalization fails, return minimal output with raw response</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="k">return</span> <span class="n">CallOutput</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">finish_reason</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h6 id="hookedllm.providers.openai" class="doc doc-heading">
            <code>openai</code>


<a href="#hookedllm.providers.openai" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

        <p>OpenAI provider adapter.</p>
<p>Handles OpenAI SDK-specific logic for detecting clients,
normalizing input/output, and extracting callable methods.</p>










<div class="doc doc-children">







<h7 id="hookedllm.providers.openai-classes">Classes<a href="#hookedllm.providers.openai-classes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.providers.openai.OpenAIAdapter" class="doc doc-heading">
            <code>OpenAIAdapter</code>


<a href="#hookedllm.providers.openai.OpenAIAdapter" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">



        <p>Adapter for OpenAI SDK clients.</p>
<p>Supports both AsyncOpenAI and OpenAI clients.
Handles the OpenAI-specific API structure: client.chat.completions.create()</p>











<div class="doc doc-children">








<h9 id="hookedllm.providers.openai.OpenAIAdapter-functions">Functions<a href="#hookedllm.providers.openai.OpenAIAdapter-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.openai.OpenAIAdapter.detect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.openai.OpenAIAdapter.detect" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Detect if a client is an OpenAI client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if client has OpenAI SDK structure, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/openai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    Detect if a client is an OpenAI client.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        client: The client instance to check</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        True if client has OpenAI SDK structure, False otherwise</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="c1"># Check for OpenAI structure</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="c1"># Must have chat.completions.create and it should be callable</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="c1"># Use getattr with sentinel to avoid MagicMock auto-creation</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="n">_SENTINEL</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="c1"># Check for OpenAI structure</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="n">chat</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s2">&quot;chat&quot;</span><span class="p">,</span> <span class="n">_SENTINEL</span><span class="p">)</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="k">if</span> <span class="n">chat</span> <span class="ow">is</span> <span class="n">_SENTINEL</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="n">completions</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">chat</span><span class="p">,</span> <span class="s2">&quot;completions&quot;</span><span class="p">,</span> <span class="n">_SENTINEL</span><span class="p">)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="k">if</span> <span class="n">completions</span> <span class="ow">is</span> <span class="n">_SENTINEL</span><span class="p">:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="n">create_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">completions</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="n">_SENTINEL</span><span class="p">)</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="k">if</span> <span class="n">create_method</span> <span class="ow">is</span> <span class="n">_SENTINEL</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">create_method</span><span class="p">):</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="c1"># Check if it also has Anthropic structure</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="c1"># If both exist, Anthropic should have matched first</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="c1"># But if Anthropic didn&#39;t match, it means messages.create wasn&#39;t properly set</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="c1"># So we can match OpenAI</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="c1"># However, to avoid false positives with MagicMock, we check:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="c1"># If messages.create exists and is callable, don&#39;t match OpenAI</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="c1"># (Anthropic should have matched if it was properly set)</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="n">messages</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">,</span> <span class="n">_SENTINEL</span><span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="k">if</span> <span class="n">messages</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_SENTINEL</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="n">messages_create</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="n">_SENTINEL</span><span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="k">if</span> <span class="n">messages_create</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_SENTINEL</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">messages_create</span><span class="p">):</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="c1"># Both structures exist - since Anthropic is checked first,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                <span class="c1"># if we get here, Anthropic didn&#39;t match, which means messages.create</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>                <span class="c1"># was auto-created by MagicMock. So we should still match OpenAI.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                <span class="c1"># But to be safe, if both are properly callable, prefer Anthropic</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                <span class="c1"># Actually, let&#39;s be conservative: if both exist, don&#39;t match OpenAI</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">pass</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.openai.OpenAIAdapter.get_callable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.openai.OpenAIAdapter.get_callable" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get the OpenAI completions.create callable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The OpenAI client instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The chat.completions.create method</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AttributeError">AttributeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the callable cannot be found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/openai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Get the OpenAI completions.create callable.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        client: The OpenAI client instance</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        The chat.completions.create method</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        AttributeError: If the callable cannot be found</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.openai.OpenAIAdapter.get_wrapper_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.openai.OpenAIAdapter.get_wrapper_path" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get the attribute path to wrap for OpenAI.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>["chat", "completions"] - the path to intercept</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/openai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    Get the attribute path to wrap for OpenAI.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        [&quot;chat&quot;, &quot;completions&quot;] - the path to intercept</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;chat&quot;</span><span class="p">,</span> <span class="s2">&quot;completions&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.openai.OpenAIAdapter.normalize_input" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_input</span><span class="p">(</span><span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.openai.OpenAIAdapter.normalize_input" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Normalize OpenAI input to CallInput and CallContext.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>provider_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Provider name (should be "openai")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callable_method</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The callable method (unused for OpenAI)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Positional arguments (unused for OpenAI)</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments including model, messages, etc.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a>, <a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (CallInput, CallContext)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/openai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_input</span><span class="p">(</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    Normalize OpenAI input to CallInput and CallContext.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        provider_name: Provider name (should be &quot;openai&quot;)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        callable_method: The callable method (unused for OpenAI)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        *args: Positional arguments (unused for OpenAI)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        **kwargs: Keyword arguments including model, messages, etc.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        Tuple of (CallInput, CallContext)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">messages</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;messages&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="c1"># Extract hookedllm-specific params from extra_body</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">extra_body</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extra_body&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">extra_body</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">tags</span> <span class="o">=</span> <span class="n">extra_body</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;hookedllm_tags&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">extra_body</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;hookedllm_metadata&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="c1"># Normalize messages to internal format</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="n">normalized_messages</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">Message</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">content</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">messages</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="p">]</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="c1"># Create normalized input</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="n">call_input</span> <span class="o">=</span> <span class="n">CallInput</span><span class="p">(</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">normalized_messages</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="c1"># Create context</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">context</span> <span class="o">=</span> <span class="n">CallContext</span><span class="p">(</span><span class="n">provider</span><span class="o">=</span><span class="n">provider_name</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">return</span> <span class="n">call_input</span><span class="p">,</span> <span class="n">context</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.openai.OpenAIAdapter.normalize_output" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.openai.OpenAIAdapter.normalize_output" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Normalize OpenAI response to CallOutput.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>response</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OpenAI SDK response object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized CallOutput</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/openai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    Normalize OpenAI response to CallOutput.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        response: OpenAI SDK response object</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        Normalized CallOutput</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="c1"># Extract text from response</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">text</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;choices&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">choice</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">choice</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">):</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="n">text</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="c1"># Extract usage</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="n">usage</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;usage&quot;</span><span class="p">):</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="c1"># Try to convert to dict</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">usage_obj</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">usage</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;model_dump&quot;</span><span class="p">):</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="n">usage</span> <span class="o">=</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;dict&quot;</span><span class="p">):</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                <span class="n">usage</span> <span class="o">=</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;__dict__&quot;</span><span class="p">):</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                <span class="n">usage</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">usage_obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="c1"># Extract finish_reason</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">finish_reason</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;choices&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">finish_reason</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;finish_reason&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="k">return</span> <span class="n">CallOutput</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">,</span> <span class="n">finish_reason</span><span class="o">=</span><span class="n">finish_reason</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="c1"># If normalization fails, return minimal output with raw response</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="k">return</span> <span class="n">CallOutput</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">finish_reason</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h6 id="hookedllm.providers.protocol" class="doc doc-heading">
            <code>protocol</code>


<a href="#hookedllm.providers.protocol" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

        <p>Provider adapter protocol for multi-provider support.</p>
<p>Defines the interface that all provider adapters must implement,
following the Dependency Inversion Principle.</p>










<div class="doc doc-children">







<h7 id="hookedllm.providers.protocol-classes">Classes<a href="#hookedllm.providers.protocol-classes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-class">



<h8 id="hookedllm.providers.protocol.ProviderAdapter" class="doc doc-heading">
            <code>ProviderAdapter</code>


<a href="#hookedllm.providers.protocol.ProviderAdapter" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for provider-specific adapters.</p>
<p>Each adapter handles:
- Detecting if a client belongs to this provider
- Normalizing provider-specific input/output formats
- Extracting the callable method from the client</p>
<p>This follows the Open/Closed Principle: new providers can be added
by implementing this protocol without modifying existing code.</p>











<div class="doc doc-children">








<h9 id="hookedllm.providers.protocol.ProviderAdapter-functions">Functions<a href="#hookedllm.providers.protocol.ProviderAdapter-functions" class="headerlink" title="Permanent link">&para;</a></h9>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.protocol.ProviderAdapter.detect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.protocol.ProviderAdapter.detect" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Detect if a client belongs to this provider.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if this adapter can handle the client, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Detect if a client belongs to this provider.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        client: The client instance to check</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        True if this adapter can handle the client, False otherwise</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.protocol.ProviderAdapter.get_callable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.protocol.ProviderAdapter.get_callable" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get the callable method from the client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The callable method (e.g., client.chat.completions.create)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AttributeError">AttributeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the callable cannot be found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Get the callable method from the client.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        client: The client instance</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        The callable method (e.g., client.chat.completions.create)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        AttributeError: If the callable cannot be found</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.protocol.ProviderAdapter.get_wrapper_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.protocol.ProviderAdapter.get_wrapper_path" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Get the attribute path to wrap (e.g., ["chat", "completions"]).</p>
<p>This is used by the wrapper to intercept the correct attributes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of attribute names to wrap</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    Get the attribute path to wrap (e.g., [&quot;chat&quot;, &quot;completions&quot;]).</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    This is used by the wrapper to intercept the correct attributes.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        client: The client instance</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        List of attribute names to wrap</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.protocol.ProviderAdapter.normalize_input" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_input</span><span class="p">(</span><span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.protocol.ProviderAdapter.normalize_input" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Normalize provider-specific input to CallInput and CallContext.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>provider_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the provider (e.g., "openai", "anthropic")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callable_method</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The callable method being called</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Positional arguments passed to the callable</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments passed to the callable</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a>, <a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (CallInput, CallContext)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_input</span><span class="p">(</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Normalize provider-specific input to CallInput and CallContext.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        provider_name: Name of the provider (e.g., &quot;openai&quot;, &quot;anthropic&quot;)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        callable_method: The callable method being called</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        *args: Positional arguments passed to the callable</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        **kwargs: Keyword arguments passed to the callable</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        Tuple of (CallInput, CallContext)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h10 id="hookedllm.providers.protocol.ProviderAdapter.normalize_output" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.protocol.ProviderAdapter.normalize_output" class="headerlink" title="Permanent link">&para;</a></h10>


    <div class="doc doc-contents ">

        <p>Normalize provider-specific response to CallOutput.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>response</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The raw response from the provider SDK</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized CallOutput</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span><span class="p">:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    Normalize provider-specific response to CallOutput.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        response: The raw response from the provider SDK</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Normalized CallOutput</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div><h2 id="core-components">Core Components<a class="headerlink" href="#core-components" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="hookedllm.core" class="doc doc-heading">
            <code>core</code>


<a href="#hookedllm.core" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Core module for hookedllm.</p>
<p>Contains the fundamental types, protocols, and implementations.</p>










<div class="doc doc-children">







<h3 id="hookedllm.core-classes">Classes<a href="#hookedllm.core-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.CallContext" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallContext</span><span class="p">(</span><span class="n">call_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))(),</span> <span class="n">parent_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">route</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;chat&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="n">started_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))(),</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">())</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.CallContext" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Context for a single LLM call lifecycle.</p>
<p>Contains metadata about the call including timing, tags, and custom metadata.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.CallInput" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallInput</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Message</span><span class="p">],</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">())</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.CallInput" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Normalized input for an LLM call.</p>
<p>This represents the input parameters in a provider-agnostic way.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.CallOutput" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallOutput</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">raw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">usage</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">finish_reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.CallOutput" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Normalized output from an LLM call.</p>
<p>This represents the response in a provider-agnostic way while
preserving the original response object.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.CallResult" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallResult</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">CallOutput</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ended_at</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">elapsed_ms</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.CallResult" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Complete result of an LLM call.</p>
<p>Contains the input, output, context, any error that occurred,
and timing information. This is passed to finally hooks.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.CompositeRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CompositeRule</span><span class="p">(</span><span class="n">rules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">operator</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;and&#39;</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.CompositeRule" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Combine multiple rules with AND/OR logic.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.CustomRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CustomRule</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.CustomRule" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Custom predicate function.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.DefaultHookExecutor" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">DefaultHookExecutor</span><span class="p">(</span><span class="n">error_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="ne">Exception</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#hookedllm.core.DefaultHookExecutor" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Concrete hook executor with dependency injection.</p>
<p>Single Responsibility: Only executes hooks, doesn't store them.
Dependencies injected: error_handler, logger</p>
<p>Guarantees:
- Hook failures never break the main LLM call
- Hooks execute in order
- Rules are evaluated before execution</p>

        <p>Initialize executor with optional dependencies.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>error_handler</code>
            </td>
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[[<span title="Exception">Exception</span>, <span title="str">str</span>], None] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Called when a hook fails. Signature: (error, context_str)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger instance (must have .error() method)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">error_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="ne">Exception</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">logger</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="p">):</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    Initialize executor with optional dependencies.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        error_handler: Called when a hook fails. Signature: (error, context_str)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        logger: Logger instance (must have .error() method)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span> <span class="o">=</span> <span class="n">error_handler</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_error_handler</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logger</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h5 id="hookedllm.core.DefaultHookExecutor-functions">Functions<a href="#hookedllm.core.DefaultHookExecutor-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.DefaultHookExecutor.execute_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_after</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.DefaultHookExecutor.execute_after" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Execute after hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.AfterHook">AfterHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_output</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call output</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_after</span><span class="p">(</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Execute after hooks with rule matching.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        call_output: The LLM call output</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">call_output</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;After hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.DefaultHookExecutor.execute_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_before</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.DefaultHookExecutor.execute_before" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Execute before hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.BeforeHook">BeforeHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_before</span><span class="p">(</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    Execute before hooks with rule matching.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Before hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Before hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.DefaultHookExecutor.execute_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_error</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.DefaultHookExecutor.execute_error" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Execute error hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.ErrorHook">ErrorHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>error</code>
            </td>
            <td>
                  <code><span title="BaseException">BaseException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The error that occurred</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_error</span><span class="p">(</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    Execute error hooks with rule matching.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        error: The error that occurred</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Error hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.DefaultHookExecutor.execute_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_finally</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.DefaultHookExecutor.execute_finally" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Execute finally hooks.</p>
<p>Note: Finally hooks don't use rule matching - they always run.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.FinallyHook">FinallyHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples (rule is ignored for finally hooks)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallResult(input: CallInput, output: CallOutput | None, context: CallContext, error: BaseException | None, ended_at: datetime, elapsed_ms: float)

  
      dataclass
   (hookedllm.core.types.CallResult)" href="#hookedllm.core.types.CallResult">CallResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complete call result</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_finally</span><span class="p">(</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Execute finally hooks.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    Note: Finally hooks don&#39;t use rule matching - they always run.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        hooks: List of (hook, rule) tuples (rule is ignored for finally hooks)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        result: The complete call result</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">_rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="c1"># Finally hooks always run, ignore rule</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Finally hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finally hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.HookExecutor" class="doc doc-heading">
            <code>HookExecutor</code>


<a href="#hookedllm.core.HookExecutor" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for executing hooks.</p>
<p>Single Responsibility: Hook execution only, no storage.</p>











<div class="doc doc-children">








<h5 id="hookedllm.core.HookExecutor-functions">Functions<a href="#hookedllm.core.HookExecutor-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.HookExecutor.execute_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_after</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.HookExecutor.execute_after" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Execute after hooks with rule matching.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_after</span><span class="p">(</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute after hooks with rule matching.&quot;&quot;&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.HookExecutor.execute_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_before</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.HookExecutor.execute_before" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Execute before hooks with rule matching.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_before</span><span class="p">(</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute before hooks with rule matching.&quot;&quot;&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.HookExecutor.execute_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_error</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.HookExecutor.execute_error" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Execute error hooks with rule matching.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_error</span><span class="p">(</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute error hooks with rule matching.&quot;&quot;&quot;</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.HookExecutor.execute_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_finally</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.HookExecutor.execute_finally" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Execute finally hooks.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_finally</span><span class="p">(</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute finally hooks.&quot;&quot;&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.HookedClientWrapper" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">HookedClientWrapper</span><span class="p">(</span><span class="n">original_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">)</span></code>

<a href="#hookedllm.core.HookedClientWrapper" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Transparent proxy with all dependencies injected.</p>
<p>No global state - all dependencies passed via constructor (DI).
Intercepts provider SDK methods to inject hook execution.</p>

        <p>Initialize wrapper with injected dependencies.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>original_client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The original provider client</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scopes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.protocols.ScopeHookStore)" href="#hookedllm.core.protocols.ScopeHookStore">ScopeHookStore</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope hook stores to use</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>executor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="HookExecutor (hookedllm.core.protocols.HookExecutor)" href="#hookedllm.core.protocols.HookExecutor">HookExecutor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hook executor instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">):</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Initialize wrapper with injected dependencies.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        original_client: The original provider client</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        scopes: List of scope hook stores to use</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        executor: Hook executor instance</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_original</span> <span class="o">=</span> <span class="n">original_client</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span> <span class="o">=</span> <span class="n">scopes</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">executor</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span> <span class="o">=</span> <span class="n">_detect_provider_adapter</span><span class="p">(</span><span class="n">original_client</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span><span class="o">.</span><span class="n">get_wrapper_path</span><span class="p">(</span><span class="n">original_client</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h5 id="hookedllm.core.HookedClientWrapper-functions">Functions<a href="#hookedllm.core.HookedClientWrapper-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.HookedClientWrapper.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

<a href="#hookedllm.core.HookedClientWrapper.__getattr__" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Intercept attribute access.</p>
<p>Wraps attributes based on the detected provider's wrapper path.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Intercept attribute access.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Wraps attributes based on the detected provider&#39;s wrapper path.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="c1"># Check if this attribute is part of the wrapper path</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="c1"># Create a dynamic wrapper for the next level</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">return</span> <span class="n">_create_wrapper_for_path</span><span class="p">(</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">return</span> <span class="n">attr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.InMemoryScopeHookStore" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="n">scope_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Concrete implementation of ScopeHookStore.</p>
<p>Single Responsibility: Only stores hooks.
Stores hooks in memory with their associated rules.</p>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_name</span> <span class="o">=</span> <span class="n">scope_name</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_finally</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">





<h5 id="hookedllm.core.InMemoryScopeHookStore-attributes">Attributes<a href="#hookedllm.core.InMemoryScopeHookStore-attributes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-attribute">



<h6 id="hookedllm.core.InMemoryScopeHookStore.name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.core.InMemoryScopeHookStore.name" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get the scope name.</p>

    </div>

</div>


<h5 id="hookedllm.core.InMemoryScopeHookStore-functions">Functions<a href="#hookedllm.core.InMemoryScopeHookStore-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeHookStore.add_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.add_after" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Add an after hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an after hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeHookStore.add_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.add_before" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Add a before hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a before hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeHookStore.add_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.add_error" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Add an error hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an error hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeHookStore.add_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_finally</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.add_finally" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Add a finally hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_finally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a finally hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_finally</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeHookStore.after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.after" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Alias for add_after with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span><span class="w"> </span><span class="nf">after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_after with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_after</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeHookStore.before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.before" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Alias for add_before with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="k">def</span><span class="w"> </span><span class="nf">before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_before with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_before</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeHookStore.error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.error" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Alias for add_error with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_error with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeHookStore.finally_" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finally_</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.finally_" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Alias for add_finally with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="nf">finally_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_finally with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_finally</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeHookStore.get_after_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_after_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.get_after_hooks" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get all after hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_after_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all after hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeHookStore.get_before_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_before_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.get_before_hooks" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get all before hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_before_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all before hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeHookStore.get_error_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_error_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.get_error_hooks" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get all error hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_error_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all error hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeHookStore.get_finally_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_finally_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.InMemoryScopeHookStore.get_finally_hooks" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get all finally hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_finally_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all finally hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finally</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.InMemoryScopeRegistry" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">InMemoryScopeRegistry</span><span class="p">()</span></code>

<a href="#hookedllm.core.InMemoryScopeRegistry" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Concrete implementation of ScopeRegistry.</p>
<p>Single Responsibility: Only manages scope lifecycle.
Creates and retrieves scopes, manages global scope.</p>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InMemoryScopeHookStore</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_global</span> <span class="o">=</span> <span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="s2">&quot;__global__&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h5 id="hookedllm.core.InMemoryScopeRegistry-functions">Functions<a href="#hookedllm.core.InMemoryScopeRegistry-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeRegistry.get_global_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_global_scope</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.core.InMemoryScopeRegistry.get_global_scope" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get the global scope (always active).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="InMemoryScopeHookStore(scope_name: str) (hookedllm.core.scopes.InMemoryScopeHookStore)" href="#hookedllm.core.scopes.InMemoryScopeHookStore">InMemoryScopeHookStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The global scope hook store</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_global_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    Get the global scope (always active).</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        The global scope hook store</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeRegistry.get_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.core.InMemoryScopeRegistry.get_scope" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get or create a named scope.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="InMemoryScopeHookStore(scope_name: str) (hookedllm.core.scopes.InMemoryScopeHookStore)" href="#hookedllm.core.scopes.InMemoryScopeHookStore">InMemoryScopeHookStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope hook store for the named scope</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Get or create a named scope.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        name: Scope name</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        Scope hook store for the named scope</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeRegistry.get_scopes_for_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scopes_for_client</span><span class="p">(</span><span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span></code>

<a href="#hookedllm.core.InMemoryScopeRegistry.get_scopes_for_client" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get list of scopes for a client.</p>
<p>Always includes the global scope, plus any requested scopes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>scope_names</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope names, or None for global only</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.protocols.ScopeHookStore)" href="#hookedllm.core.protocols.ScopeHookStore">ScopeHookStore</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope hook stores (global + requested scopes)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scopes_for_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Get list of scopes for a client.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Always includes the global scope, plus any requested scopes.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        scope_names: List of scope names, or None for global only</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        List of scope hook stores (global + requested scopes)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_global</span><span class="p">]</span>  <span class="c1"># Always include global</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="n">scope_names</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">scope_names</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">scopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">return</span> <span class="n">scopes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.InMemoryScopeRegistry.scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.core.InMemoryScopeRegistry.scope" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Alias for get_scope for more fluent API.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="k">def</span><span class="w"> </span><span class="nf">scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for get_scope for more fluent API.&quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.Message" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">Message</span><span class="p">(</span><span class="n">role</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.Message" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>A single message in an LLM conversation.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.MetadataRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">MetadataRule</span><span class="p">(</span><span class="n">conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.MetadataRule" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Match based on metadata key-value pairs.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.ModelRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">ModelRule</span><span class="p">(</span><span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.ModelRule" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Match specific model(s).</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.NotRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">NotRule</span><span class="p">(</span><span class="n">rule</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.NotRule" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Negate a rule.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.Rule" class="doc doc-heading">
            <code>Rule</code>


<a href="#hookedllm.core.Rule" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for hook execution rules.</p>
<p>Rules determine whether a hook should execute based on the
call input and context.</p>











<div class="doc doc-children">








<h5 id="hookedllm.core.Rule-functions">Functions<a href="#hookedllm.core.Rule-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.Rule.__and__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__and__</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span></code>

<a href="#hookedllm.core.Rule.__and__" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Combine rules with AND logic.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="k">def</span><span class="w"> </span><span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span><span class="p">:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine rules with AND logic.&quot;&quot;&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.Rule.__invert__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__invert__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Rule</span></code>

<a href="#hookedllm.core.Rule.__invert__" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Negate the rule (NOT logic).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span><span class="w"> </span><span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Negate the rule (NOT logic).&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.Rule.__or__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__or__</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span></code>

<a href="#hookedllm.core.Rule.__or__" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Combine rules with OR logic.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="k">def</span><span class="w"> </span><span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine rules with OR logic.&quot;&quot;&quot;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.Rule.matches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

<a href="#hookedllm.core.Rule.matches" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Check if this rule matches the given call.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="k">def</span><span class="w"> </span><span class="nf">matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if this rule matches the given call.&quot;&quot;&quot;</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.RuleBuilder" class="doc doc-heading">
            <code>RuleBuilder</code>


<a href="#hookedllm.core.RuleBuilder" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Fluent API for building rules.</p>
<p>Used via the 'when' global instance.</p>











<div class="doc doc-children">








<h5 id="hookedllm.core.RuleBuilder-functions">Functions<a href="#hookedllm.core.RuleBuilder-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.RuleBuilder.always" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">always</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.RuleBuilder.always" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Always matches.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="k">def</span><span class="w"> </span><span class="nf">always</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span><span class="p">:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Always matches.&quot;&quot;&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="k">return</span> <span class="n">CustomRule</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.RuleBuilder.custom" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">custom</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.RuleBuilder.custom" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Custom predicate function.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>when.custom(lambda i, c: c.metadata.get("score", 0) &gt; 0.8)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="k">def</span><span class="w"> </span><span class="nf">custom</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    Custom predicate function.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        when.custom(lambda i, c: c.metadata.get(&quot;score&quot;, 0) &gt; 0.8)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">return</span> <span class="n">CustomRule</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.RuleBuilder.metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metadata</span><span class="p">(</span><span class="o">**</span><span class="n">conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetadataRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.RuleBuilder.metadata" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Match metadata conditions.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>when.metadata(user_tier="premium", region="us-east")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="k">def</span><span class="w"> </span><span class="nf">metadata</span><span class="p">(</span><span class="o">**</span><span class="n">conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetadataRule</span><span class="p">:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    Match metadata conditions.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        when.metadata(user_tier=&quot;premium&quot;, region=&quot;us-east&quot;)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">return</span> <span class="n">MetadataRule</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.RuleBuilder.model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model</span><span class="p">(</span><span class="o">*</span><span class="n">models</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.RuleBuilder.model" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Match specific model(s).</p>


<details class="example" open>
  <summary>Example</summary>
  <p>when.model("gpt-4", "gpt-4-turbo")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="o">*</span><span class="n">models</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelRule</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    Match specific model(s).</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        when.model(&quot;gpt-4&quot;, &quot;gpt-4-turbo&quot;)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="k">return</span> <span class="n">ModelRule</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.RuleBuilder.never" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">never</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.RuleBuilder.never" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Never matches.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="k">def</span><span class="w"> </span><span class="nf">never</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Never matches.&quot;&quot;&quot;</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="k">return</span> <span class="n">CustomRule</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.RuleBuilder.tag" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tag</span><span class="p">(</span><span class="o">*</span><span class="n">tags</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">all_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TagRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.RuleBuilder.tag" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Match if context has tag(s).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>*tags</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tag names to match</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>all_</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, all tags must be present. If False, any tag matches.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>when.tag("production", "critical")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="k">def</span><span class="w"> </span><span class="nf">tag</span><span class="p">(</span><span class="o">*</span><span class="n">tags</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">all_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TagRule</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    Match if context has tag(s).</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        *tags: Tag names to match</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        all_: If True, all tags must be present. If False, any tag matches.</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        when.tag(&quot;production&quot;, &quot;critical&quot;)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">return</span> <span class="n">TagRule</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">),</span> <span class="n">require_all</span><span class="o">=</span><span class="n">all_</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.ScopeHookStore" class="doc doc-heading">
            <code>ScopeHookStore</code>


<a href="#hookedllm.core.ScopeHookStore" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for storing hooks in a scope.</p>
<p>Single Responsibility: Storage only, no execution logic.</p>











<div class="doc doc-children">








<h5 id="hookedllm.core.ScopeHookStore-functions">Functions<a href="#hookedllm.core.ScopeHookStore-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.ScopeHookStore.add_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.ScopeHookStore.add_after" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Add an after hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an after hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.ScopeHookStore.add_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.ScopeHookStore.add_before" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Add a before hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a before hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.ScopeHookStore.add_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.ScopeHookStore.add_error" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Add an error hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an error hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.ScopeHookStore.add_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_finally</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.ScopeHookStore.add_finally" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Add a finally hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_finally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a finally hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.ScopeHookStore.get_after_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_after_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.ScopeHookStore.get_after_hooks" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get all after hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_after_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all after hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.ScopeHookStore.get_before_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_before_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.ScopeHookStore.get_before_hooks" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get all before hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_before_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all before hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.ScopeHookStore.get_error_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_error_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.ScopeHookStore.get_error_hooks" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get all error hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_error_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all error hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.ScopeHookStore.get_finally_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_finally_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.ScopeHookStore.get_finally_hooks" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get all finally hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_finally_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all finally hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.ScopeRegistry" class="doc doc-heading">
            <code>ScopeRegistry</code>


<a href="#hookedllm.core.ScopeRegistry" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for managing scopes.</p>
<p>Single Responsibility: Scope lifecycle management only.</p>











<div class="doc doc-children">








<h5 id="hookedllm.core.ScopeRegistry-functions">Functions<a href="#hookedllm.core.ScopeRegistry-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.ScopeRegistry.get_global_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_global_scope</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span></code>

<a href="#hookedllm.core.ScopeRegistry.get_global_scope" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get the global scope (always active).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_global_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the global scope (always active).&quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.ScopeRegistry.get_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span></code>

<a href="#hookedllm.core.ScopeRegistry.get_scope" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get or create a named scope.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get or create a named scope.&quot;&quot;&quot;</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.core.ScopeRegistry.get_scopes_for_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scopes_for_client</span><span class="p">(</span><span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span></code>

<a href="#hookedllm.core.ScopeRegistry.get_scopes_for_client" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get list of scopes for a client.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scopes_for_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of scopes for a client.&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.core.TagRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">TagRule</span><span class="p">(</span><span class="n">tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">require_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.TagRule" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Match if context has specific tag(s).</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<h3 id="hookedllm.core-modules">Modules<a href="#hookedllm.core-modules" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.core.executor" class="doc doc-heading">
            <code>executor</code>


<a href="#hookedllm.core.executor" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Hook executor with dependency injection.</p>
<p>Executes hooks with rule matching while isolating failures.</p>










<div class="doc doc-children">







<h5 id="hookedllm.core.executor-classes">Classes<a href="#hookedllm.core.executor-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.executor.DefaultHookExecutor" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">DefaultHookExecutor</span><span class="p">(</span><span class="n">error_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="ne">Exception</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#hookedllm.core.executor.DefaultHookExecutor" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Concrete hook executor with dependency injection.</p>
<p>Single Responsibility: Only executes hooks, doesn't store them.
Dependencies injected: error_handler, logger</p>
<p>Guarantees:
- Hook failures never break the main LLM call
- Hooks execute in order
- Rules are evaluated before execution</p>

        <p>Initialize executor with optional dependencies.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>error_handler</code>
            </td>
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[[<span title="Exception">Exception</span>, <span title="str">str</span>], None] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Called when a hook fails. Signature: (error, context_str)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger instance (must have .error() method)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">error_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="ne">Exception</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">logger</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="p">):</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    Initialize executor with optional dependencies.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        error_handler: Called when a hook fails. Signature: (error, context_str)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        logger: Logger instance (must have .error() method)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span> <span class="o">=</span> <span class="n">error_handler</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_error_handler</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logger</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h7 id="hookedllm.core.executor.DefaultHookExecutor-functions">Functions<a href="#hookedllm.core.executor.DefaultHookExecutor-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.executor.DefaultHookExecutor.execute_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_after</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.executor.DefaultHookExecutor.execute_after" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute after hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.AfterHook">AfterHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_output</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call output</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_after</span><span class="p">(</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Execute after hooks with rule matching.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        call_output: The LLM call output</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">call_output</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;After hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.executor.DefaultHookExecutor.execute_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_before</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.executor.DefaultHookExecutor.execute_before" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute before hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.BeforeHook">BeforeHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_before</span><span class="p">(</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    Execute before hooks with rule matching.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Before hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Before hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.executor.DefaultHookExecutor.execute_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_error</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.executor.DefaultHookExecutor.execute_error" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute error hooks with rule matching.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.ErrorHook">ErrorHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>error</code>
            </td>
            <td>
                  <code><span title="BaseException">BaseException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The error that occurred</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_error</span><span class="p">(</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    Execute error hooks with rule matching.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        hooks: List of (hook, rule) tuples</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        call_input: The LLM call input</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        error: The error that occurred</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="c1"># Check if rule matches</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">call_input</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Error hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.executor.DefaultHookExecutor.execute_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_finally</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.executor.DefaultHookExecutor.execute_finally" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute finally hooks.</p>
<p>Note: Finally hooks don't use rule matching - they always run.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hooks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="hookedllm.core.protocols.FinallyHook">FinallyHook</span>, <a class="autorefs autorefs-internal" title="Rule (hookedllm.core.protocols.Rule)" href="#hookedllm.core.protocols.Rule">Rule</a> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (hook, rule) tuples (rule is ignored for finally hooks)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallResult(input: CallInput, output: CallOutput | None, context: CallContext, error: BaseException | None, ended_at: datetime, elapsed_ms: float)

  
      dataclass
   (hookedllm.core.types.CallResult)" href="#hookedllm.core.types.CallResult">CallResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complete call result</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/executor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_finally</span><span class="p">(</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Execute finally hooks.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    Note: Finally hooks don&#39;t use rule matching - they always run.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        hooks: List of (hook, rule) tuples (rule is ignored for finally hooks)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        result: The complete call result</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">_rule</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="c1"># Finally hooks always run, ignore rule</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">hook_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hook</span><span class="p">))</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_error_handler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Finally hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finally hook </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.core.protocols" class="doc doc-heading">
            <code>protocols</code>


<a href="#hookedllm.core.protocols" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Protocol definitions for hooks and dependency injection.</p>
<p>These protocols define the interfaces that components must implement,
following the Dependency Inversion Principle.</p>










<div class="doc doc-children">







<h5 id="hookedllm.core.protocols-classes">Classes<a href="#hookedllm.core.protocols-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.protocols.HookExecutor" class="doc doc-heading">
            <code>HookExecutor</code>


<a href="#hookedllm.core.protocols.HookExecutor" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for executing hooks.</p>
<p>Single Responsibility: Hook execution only, no storage.</p>











<div class="doc doc-children">








<h7 id="hookedllm.core.protocols.HookExecutor-functions">Functions<a href="#hookedllm.core.protocols.HookExecutor-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.HookExecutor.execute_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_after</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.protocols.HookExecutor.execute_after" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute after hooks with rule matching.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_after</span><span class="p">(</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute after hooks with rule matching.&quot;&quot;&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.HookExecutor.execute_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_before</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.protocols.HookExecutor.execute_before" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute before hooks with rule matching.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_before</span><span class="p">(</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute before hooks with rule matching.&quot;&quot;&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.HookExecutor.execute_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_error</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.protocols.HookExecutor.execute_error" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute error hooks with rule matching.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_error</span><span class="p">(</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute error hooks with rule matching.&quot;&quot;&quot;</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.HookExecutor.execute_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_finally</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.protocols.HookExecutor.execute_finally" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Execute finally hooks.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_finally</span><span class="p">(</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute finally hooks.&quot;&quot;&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.protocols.Rule" class="doc doc-heading">
            <code>Rule</code>


<a href="#hookedllm.core.protocols.Rule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for hook execution rules.</p>
<p>Rules determine whether a hook should execute based on the
call input and context.</p>











<div class="doc doc-children">








<h7 id="hookedllm.core.protocols.Rule-functions">Functions<a href="#hookedllm.core.protocols.Rule-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.Rule.__and__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__and__</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span></code>

<a href="#hookedllm.core.protocols.Rule.__and__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Combine rules with AND logic.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="k">def</span><span class="w"> </span><span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span><span class="p">:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine rules with AND logic.&quot;&quot;&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.Rule.__invert__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__invert__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Rule</span></code>

<a href="#hookedllm.core.protocols.Rule.__invert__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Negate the rule (NOT logic).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span><span class="w"> </span><span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Negate the rule (NOT logic).&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.Rule.__or__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__or__</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span></code>

<a href="#hookedllm.core.protocols.Rule.__or__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Combine rules with OR logic.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="k">def</span><span class="w"> </span><span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rule</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine rules with OR logic.&quot;&quot;&quot;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.Rule.matches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">matches</span><span class="p">(</span><span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

<a href="#hookedllm.core.protocols.Rule.matches" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Check if this rule matches the given call.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="k">def</span><span class="w"> </span><span class="nf">matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if this rule matches the given call.&quot;&quot;&quot;</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.protocols.ScopeHookStore" class="doc doc-heading">
            <code>ScopeHookStore</code>


<a href="#hookedllm.core.protocols.ScopeHookStore" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for storing hooks in a scope.</p>
<p>Single Responsibility: Storage only, no execution logic.</p>











<div class="doc doc-children">








<h7 id="hookedllm.core.protocols.ScopeHookStore-functions">Functions<a href="#hookedllm.core.protocols.ScopeHookStore-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.ScopeHookStore.add_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.add_after" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add an after hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an after hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.ScopeHookStore.add_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.add_before" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add a before hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a before hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.ScopeHookStore.add_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.add_error" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add an error hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an error hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.ScopeHookStore.add_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_finally</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.add_finally" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add a finally hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_finally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a finally hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.ScopeHookStore.get_after_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_after_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.get_after_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all after hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_after_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all after hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.ScopeHookStore.get_before_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_before_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.get_before_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all before hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_before_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all before hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.ScopeHookStore.get_error_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_error_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.get_error_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all error hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_error_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all error hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.ScopeHookStore.get_finally_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_finally_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.protocols.ScopeHookStore.get_finally_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all finally hooks with their rules.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_finally_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all finally hooks with their rules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.protocols.ScopeRegistry" class="doc doc-heading">
            <code>ScopeRegistry</code>


<a href="#hookedllm.core.protocols.ScopeRegistry" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for managing scopes.</p>
<p>Single Responsibility: Scope lifecycle management only.</p>











<div class="doc doc-children">








<h7 id="hookedllm.core.protocols.ScopeRegistry-functions">Functions<a href="#hookedllm.core.protocols.ScopeRegistry-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.ScopeRegistry.get_global_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_global_scope</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span></code>

<a href="#hookedllm.core.protocols.ScopeRegistry.get_global_scope" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the global scope (always active).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_global_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the global scope (always active).&quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.ScopeRegistry.get_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span></code>

<a href="#hookedllm.core.protocols.ScopeRegistry.get_scope" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get or create a named scope.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get or create a named scope.&quot;&quot;&quot;</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.protocols.ScopeRegistry.get_scopes_for_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scopes_for_client</span><span class="p">(</span><span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span></code>

<a href="#hookedllm.core.protocols.ScopeRegistry.get_scopes_for_client" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get list of scopes for a client.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/protocols.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scopes_for_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of scopes for a client.&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.core.rules" class="doc doc-heading">
            <code>rules</code>


<a href="#hookedllm.core.rules" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Rule system for conditional hook execution.</p>
<p>Rules determine when hooks should execute based on call input and context.
Supports composition via AND, OR, NOT operations.</p>










<div class="doc doc-children">







<h5 id="hookedllm.core.rules-classes">Classes<a href="#hookedllm.core.rules-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.rules.CompositeRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CompositeRule</span><span class="p">(</span><span class="n">rules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">operator</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;and&#39;</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.rules.CompositeRule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Combine multiple rules with AND/OR logic.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.rules.CustomRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CustomRule</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.rules.CustomRule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Custom predicate function.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.rules.MetadataRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">MetadataRule</span><span class="p">(</span><span class="n">conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.rules.MetadataRule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Match based on metadata key-value pairs.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.rules.ModelRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">ModelRule</span><span class="p">(</span><span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.rules.ModelRule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Match specific model(s).</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.rules.NotRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">NotRule</span><span class="p">(</span><span class="n">rule</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.rules.NotRule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Negate a rule.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.rules.RuleBuilder" class="doc doc-heading">
            <code>RuleBuilder</code>


<a href="#hookedllm.core.rules.RuleBuilder" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Fluent API for building rules.</p>
<p>Used via the 'when' global instance.</p>











<div class="doc doc-children">








<h7 id="hookedllm.core.rules.RuleBuilder-functions">Functions<a href="#hookedllm.core.rules.RuleBuilder-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.rules.RuleBuilder.always" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">always</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.rules.RuleBuilder.always" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Always matches.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="k">def</span><span class="w"> </span><span class="nf">always</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span><span class="p">:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Always matches.&quot;&quot;&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="k">return</span> <span class="n">CustomRule</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.rules.RuleBuilder.custom" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">custom</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.rules.RuleBuilder.custom" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Custom predicate function.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>when.custom(lambda i, c: c.metadata.get("score", 0) &gt; 0.8)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="k">def</span><span class="w"> </span><span class="nf">custom</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    Custom predicate function.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        when.custom(lambda i, c: c.metadata.get(&quot;score&quot;, 0) &gt; 0.8)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">return</span> <span class="n">CustomRule</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.rules.RuleBuilder.metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metadata</span><span class="p">(</span><span class="o">**</span><span class="n">conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetadataRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.rules.RuleBuilder.metadata" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Match metadata conditions.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>when.metadata(user_tier="premium", region="us-east")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="k">def</span><span class="w"> </span><span class="nf">metadata</span><span class="p">(</span><span class="o">**</span><span class="n">conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetadataRule</span><span class="p">:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    Match metadata conditions.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        when.metadata(user_tier=&quot;premium&quot;, region=&quot;us-east&quot;)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">return</span> <span class="n">MetadataRule</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.rules.RuleBuilder.model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model</span><span class="p">(</span><span class="o">*</span><span class="n">models</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.rules.RuleBuilder.model" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Match specific model(s).</p>


<details class="example" open>
  <summary>Example</summary>
  <p>when.model("gpt-4", "gpt-4-turbo")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="o">*</span><span class="n">models</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelRule</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    Match specific model(s).</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        when.model(&quot;gpt-4&quot;, &quot;gpt-4-turbo&quot;)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="k">return</span> <span class="n">ModelRule</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.rules.RuleBuilder.never" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">never</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.rules.RuleBuilder.never" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Never matches.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="k">def</span><span class="w"> </span><span class="nf">never</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CustomRule</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Never matches.&quot;&quot;&quot;</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="k">return</span> <span class="n">CustomRule</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.rules.RuleBuilder.tag" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tag</span><span class="p">(</span><span class="o">*</span><span class="n">tags</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">all_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TagRule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.core.rules.RuleBuilder.tag" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Match if context has tag(s).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>*tags</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tag names to match</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>all_</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, all tags must be present. If False, any tag matches.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>when.tag("production", "critical")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="k">def</span><span class="w"> </span><span class="nf">tag</span><span class="p">(</span><span class="o">*</span><span class="n">tags</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">all_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TagRule</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    Match if context has tag(s).</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        *tags: Tag names to match</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        all_: If True, all tags must be present. If False, any tag matches.</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        when.tag(&quot;production&quot;, &quot;critical&quot;)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">return</span> <span class="n">TagRule</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">),</span> <span class="n">require_all</span><span class="o">=</span><span class="n">all_</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.rules.TagRule" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">TagRule</span><span class="p">(</span><span class="n">tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">require_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.rules.TagRule" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Match if context has specific tag(s).</p>











<div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.core.scopes" class="doc doc-heading">
            <code>scopes</code>


<a href="#hookedllm.core.scopes" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Scope management for isolated hook execution.</p>
<p>Scopes allow hooks to be registered and executed only for specific clients,
preventing interference across different application contexts.</p>










<div class="doc doc-children">







<h5 id="hookedllm.core.scopes-classes">Classes<a href="#hookedllm.core.scopes-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.scopes.InMemoryScopeHookStore" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="n">scope_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Concrete implementation of ScopeHookStore.</p>
<p>Single Responsibility: Only stores hooks.
Stores hooks in memory with their associated rules.</p>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_name</span> <span class="o">=</span> <span class="n">scope_name</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_finally</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">





<h7 id="hookedllm.core.scopes.InMemoryScopeHookStore-attributes">Attributes<a href="#hookedllm.core.scopes.InMemoryScopeHookStore-attributes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-attribute">



<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore.name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.name" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the scope name.</p>

    </div>

</div>


<h7 id="hookedllm.core.scopes.InMemoryScopeHookStore-functions">Functions<a href="#hookedllm.core.scopes.InMemoryScopeHookStore-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore.add_after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.add_after" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add an after hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an after hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore.add_before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.add_before" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add a before hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a before hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore.add_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.add_error" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add an error hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an error hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore.add_finally" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_finally</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.add_finally" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Add a finally hook with optional execution rule.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_finally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a finally hook with optional execution rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_finally</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hook</span><span class="p">,</span> <span class="n">rule</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore.after" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">after</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.after" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Alias for add_after with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span><span class="w"> </span><span class="nf">after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AfterHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_after with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_after</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore.before" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">before</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.before" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Alias for add_before with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="k">def</span><span class="w"> </span><span class="nf">before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">BeforeHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_before with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_before</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore.error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">error</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.error" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Alias for add_error with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">ErrorHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_error with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore.finally_" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finally_</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.finally_" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Alias for add_finally with keyword 'when' parameter.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="nf">finally_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">FinallyHook</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for add_finally with keyword &#39;when&#39; parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_finally</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore.get_after_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_after_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.get_after_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all after hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_after_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AfterHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all after hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore.get_before_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_before_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.get_before_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all before hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_before_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">BeforeHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all before hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore.get_error_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_error_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.get_error_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all error hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_error_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ErrorHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all error hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeHookStore.get_finally_hooks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_finally_hooks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeHookStore.get_finally_hooks" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get all finally hooks with their rules (returns copy).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_finally_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FinallyHook</span><span class="p">,</span> <span class="n">Rule</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all finally hooks with their rules (returns copy).&quot;&quot;&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finally</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.scopes.InMemoryScopeRegistry" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">InMemoryScopeRegistry</span><span class="p">()</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeRegistry" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Concrete implementation of ScopeRegistry.</p>
<p>Single Responsibility: Only manages scope lifecycle.
Creates and retrieves scopes, manages global scope.</p>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InMemoryScopeHookStore</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_global</span> <span class="o">=</span> <span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="s2">&quot;__global__&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h7 id="hookedllm.core.scopes.InMemoryScopeRegistry-functions">Functions<a href="#hookedllm.core.scopes.InMemoryScopeRegistry-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeRegistry.get_global_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_global_scope</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeRegistry.get_global_scope" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the global scope (always active).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="InMemoryScopeHookStore(scope_name: str) (hookedllm.core.scopes.InMemoryScopeHookStore)" href="#hookedllm.core.scopes.InMemoryScopeHookStore">InMemoryScopeHookStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The global scope hook store</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_global_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    Get the global scope (always active).</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        The global scope hook store</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeRegistry.get_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeRegistry.get_scope" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get or create a named scope.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="InMemoryScopeHookStore(scope_name: str) (hookedllm.core.scopes.InMemoryScopeHookStore)" href="#hookedllm.core.scopes.InMemoryScopeHookStore">InMemoryScopeHookStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scope hook store for the named scope</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Get or create a named scope.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        name: Scope name</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        Scope hook store for the named scope</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">InMemoryScopeHookStore</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeRegistry.get_scopes_for_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scopes_for_client</span><span class="p">(</span><span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeRegistry.get_scopes_for_client" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get list of scopes for a client.</p>
<p>Always includes the global scope, plus any requested scopes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>scope_names</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope names, or None for global only</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.protocols.ScopeHookStore)" href="#hookedllm.core.protocols.ScopeHookStore">ScopeHookStore</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope hook stores (global + requested scopes)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_scopes_for_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Get list of scopes for a client.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Always includes the global scope, plus any requested scopes.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        scope_names: List of scope names, or None for global only</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        List of scope hook stores (global + requested scopes)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_global</span><span class="p">]</span>  <span class="c1"># Always include global</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="n">scope_names</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">scope_names</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">scopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">return</span> <span class="n">scopes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.scopes.InMemoryScopeRegistry.scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scope</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span></code>

<a href="#hookedllm.core.scopes.InMemoryScopeRegistry.scope" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Alias for get_scope for more fluent API.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/scopes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="k">def</span><span class="w"> </span><span class="nf">scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InMemoryScopeHookStore</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias for get_scope for more fluent API.&quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scope</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.core.types" class="doc doc-heading">
            <code>types</code>


<a href="#hookedllm.core.types" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Core data types for hookedllm.</p>
<p>These types represent the data that flows through the hook system.</p>










<div class="doc doc-children">







<h5 id="hookedllm.core.types-classes">Classes<a href="#hookedllm.core.types-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.types.CallContext" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallContext</span><span class="p">(</span><span class="n">call_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))(),</span> <span class="n">parent_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">route</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;chat&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="n">started_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))(),</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">())</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.types.CallContext" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Context for a single LLM call lifecycle.</p>
<p>Contains metadata about the call including timing, tags, and custom metadata.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.types.CallInput" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallInput</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Message</span><span class="p">],</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">())</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.types.CallInput" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Normalized input for an LLM call.</p>
<p>This represents the input parameters in a provider-agnostic way.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.types.CallOutput" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallOutput</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">raw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">usage</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">finish_reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.types.CallOutput" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Normalized output from an LLM call.</p>
<p>This represents the response in a provider-agnostic way while
preserving the original response object.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.types.CallResult" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">CallResult</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">CallOutput</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ended_at</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">elapsed_ms</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.types.CallResult" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Complete result of an LLM call.</p>
<p>Contains the input, output, context, any error that occurred,
and timing information. This is passed to finally hooks.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.types.Message" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">Message</span><span class="p">(</span><span class="n">role</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.core.types.Message" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>A single message in an LLM conversation.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.core.wrapper" class="doc doc-heading">
            <code>wrapper</code>


<a href="#hookedllm.core.wrapper" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Transparent wrapper for intercepting LLM API calls.</p>
<p>Wraps provider clients to inject hook execution while preserving
the original SDK interface and return types.</p>










<div class="doc doc-children">







<h5 id="hookedllm.core.wrapper-classes">Classes<a href="#hookedllm.core.wrapper-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.wrapper.HookedClientWrapper" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">HookedClientWrapper</span><span class="p">(</span><span class="n">original_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">)</span></code>

<a href="#hookedllm.core.wrapper.HookedClientWrapper" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Transparent proxy with all dependencies injected.</p>
<p>No global state - all dependencies passed via constructor (DI).
Intercepts provider SDK methods to inject hook execution.</p>

        <p>Initialize wrapper with injected dependencies.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>original_client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The original provider client</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scopes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.protocols.ScopeHookStore)" href="#hookedllm.core.protocols.ScopeHookStore">ScopeHookStore</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope hook stores to use</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>executor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="HookExecutor (hookedllm.core.protocols.HookExecutor)" href="#hookedllm.core.protocols.HookExecutor">HookExecutor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hook executor instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">):</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Initialize wrapper with injected dependencies.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        original_client: The original provider client</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        scopes: List of scope hook stores to use</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        executor: Hook executor instance</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_original</span> <span class="o">=</span> <span class="n">original_client</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span> <span class="o">=</span> <span class="n">scopes</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">executor</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span> <span class="o">=</span> <span class="n">_detect_provider_adapter</span><span class="p">(</span><span class="n">original_client</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span><span class="o">.</span><span class="n">get_wrapper_path</span><span class="p">(</span><span class="n">original_client</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h7 id="hookedllm.core.wrapper.HookedClientWrapper-functions">Functions<a href="#hookedllm.core.wrapper.HookedClientWrapper-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.wrapper.HookedClientWrapper.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

<a href="#hookedllm.core.wrapper.HookedClientWrapper.__getattr__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Intercept attribute access.</p>
<p>Wraps attributes based on the detected provider's wrapper path.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Intercept attribute access.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Wraps attributes based on the detected provider&#39;s wrapper path.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="c1"># Check if this attribute is part of the wrapper path</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="c1"># Create a dynamic wrapper for the next level</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">return</span> <span class="n">_create_wrapper_for_path</span><span class="p">(</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_path</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">return</span> <span class="n">attr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.wrapper.HookedCompletionsWrapper" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">HookedCompletionsWrapper</span><span class="p">(</span><span class="n">original_completions</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">,</span> <span class="n">adapter</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span></code>

<a href="#hookedllm.core.wrapper.HookedCompletionsWrapper" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Wraps completions.create() with hook execution.</p>
<p>All dependencies injected, no global state.</p>

        <p>Initialize completions wrapper.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>original_completions</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original completions object from SDK</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scopes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.protocols.ScopeHookStore)" href="#hookedllm.core.protocols.ScopeHookStore">ScopeHookStore</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope hook stores</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>executor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="HookExecutor (hookedllm.core.protocols.HookExecutor)" href="#hookedllm.core.protocols.HookExecutor">HookExecutor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hook executor instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>adapter</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Provider adapter instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="n">original_completions</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">,</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="n">adapter</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="p">):</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    Initialize completions wrapper.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        original_completions: Original completions object from SDK</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        scopes: List of scope hook stores</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        executor: Hook executor instance</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        adapter: Provider adapter instance</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_original</span> <span class="o">=</span> <span class="n">original_completions</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span> <span class="o">=</span> <span class="n">scopes</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">executor</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span> <span class="o">=</span> <span class="n">adapter</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h7 id="hookedllm.core.wrapper.HookedCompletionsWrapper-functions">Functions<a href="#hookedllm.core.wrapper.HookedCompletionsWrapper-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.wrapper.HookedCompletionsWrapper.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

<a href="#hookedllm.core.wrapper.HookedCompletionsWrapper.__getattr__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Pass through other attributes to original object.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass through other attributes to original object.&quot;&quot;&quot;</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.wrapper.HookedCompletionsWrapper.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.core.wrapper.HookedCompletionsWrapper.create" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Hooked create method.</p>
<p>Flow:
1. Use adapter to normalize input (extracts tags, metadata, creates CallInput/Context)
2. Collect all hooks from all scopes
3. Execute before hooks
4. Call original SDK method
5. Use adapter to normalize output
6. Execute after hooks (on success) or error hooks (on failure)
7. Always execute finally hooks
8. Return original SDK response type</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>messages</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of message dicts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Other parameters passed to SDK</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original SDK response object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    Hooked create method.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">    Flow:</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">    1. Use adapter to normalize input (extracts tags, metadata, creates CallInput/Context)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    2. Collect all hooks from all scopes</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    3. Execute before hooks</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    4. Call original SDK method</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">    5. Use adapter to normalize output</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    6. Execute after hooks (on success) or error hooks (on failure)</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    7. Always execute finally hooks</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    8. Return original SDK response type</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        model: Model name</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        messages: List of message dicts</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        **kwargs: Other parameters passed to SDK</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        Original SDK response object</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="c1"># Use adapter to normalize input</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="n">call_input</span><span class="p">,</span> <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span><span class="o">.</span><span class="n">normalize_input</span><span class="p">(</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span><span class="o">.</span><span class="n">PROVIDER_NAME</span><span class="p">,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="o">.</span><span class="n">create</span><span class="p">,</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="c1"># Collect all hooks from all scopes</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="n">all_before</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="n">all_after</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="n">all_error</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="n">all_finally</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="k">for</span> <span class="n">scope</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="n">all_before</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">get_before_hooks</span><span class="p">())</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">all_after</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">get_after_hooks</span><span class="p">())</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">all_error</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">get_error_hooks</span><span class="p">())</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="n">all_finally</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">get_finally_hooks</span><span class="p">())</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="c1"># Execute hook flow</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="c1"># Before hooks</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">execute_before</span><span class="p">(</span><span class="n">all_before</span><span class="p">,</span> <span class="n">call_input</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="c1"># Original SDK call</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="c1"># Use adapter to normalize output</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span><span class="o">.</span><span class="n">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="c1"># After hooks</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">execute_after</span><span class="p">(</span><span class="n">all_after</span><span class="p">,</span> <span class="n">call_input</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="k">return</span> <span class="n">response</span>  <span class="c1"># Return ORIGINAL SDK response!</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="n">error</span> <span class="o">=</span> <span class="n">e</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">execute_error</span><span class="p">(</span><span class="n">all_error</span><span class="p">,</span> <span class="n">call_input</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="k">raise</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="n">elapsed</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1000.0</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">CallResult</span><span class="p">(</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="nb">input</span><span class="o">=</span><span class="n">call_input</span><span class="p">,</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="n">ended_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="n">elapsed_ms</span><span class="o">=</span><span class="n">elapsed</span><span class="p">,</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">execute_finally</span><span class="p">(</span><span class="n">all_finally</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.core.wrapper.HookedPathWrapper" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">HookedPathWrapper</span><span class="p">(</span><span class="n">original_obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">remaining_path</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span> <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">,</span> <span class="n">adapter</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span></code>

<a href="#hookedllm.core.wrapper.HookedPathWrapper" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Intermediate wrapper for provider-specific attribute paths.</p>
<p>Handles paths like ["chat", "completions"] for OpenAI or ["messages"] for Anthropic.</p>

        <p>Initialize path wrapper.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>original_obj</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The object being wrapped</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>remaining_path</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Remaining attribute names to intercept</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scopes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ScopeHookStore (hookedllm.core.protocols.ScopeHookStore)" href="#hookedllm.core.protocols.ScopeHookStore">ScopeHookStore</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of scope hook stores</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>executor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="HookExecutor (hookedllm.core.protocols.HookExecutor)" href="#hookedllm.core.protocols.HookExecutor">HookExecutor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hook executor instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>adapter</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Provider adapter instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="n">original_obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="n">remaining_path</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScopeHookStore</span><span class="p">],</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="n">executor</span><span class="p">:</span> <span class="n">HookExecutor</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="n">adapter</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="p">):</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    Initialize path wrapper.</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        original_obj: The object being wrapped</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        remaining_path: Remaining attribute names to intercept</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        scopes: List of scope hook stores</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        executor: Hook executor instance</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        adapter: Provider adapter instance</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_original</span> <span class="o">=</span> <span class="n">original_obj</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_remaining_path</span> <span class="o">=</span> <span class="n">remaining_path</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span> <span class="o">=</span> <span class="n">scopes</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">executor</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span> <span class="o">=</span> <span class="n">adapter</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h7 id="hookedllm.core.wrapper.HookedPathWrapper-functions">Functions<a href="#hookedllm.core.wrapper.HookedPathWrapper-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.core.wrapper.HookedPathWrapper.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

<a href="#hookedllm.core.wrapper.HookedPathWrapper.__getattr__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Intercept attribute access.</p>
<p>If the attribute matches the next in the path, wrap it.
Otherwise pass through.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/core/wrapper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    Intercept attribute access.</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    If the attribute matches the next in the path, wrap it.</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    Otherwise pass through.</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_remaining_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remaining_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="c1"># Continue wrapping down the path</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="k">return</span> <span class="n">_create_wrapper_for_path</span><span class="p">(</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remaining_path</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapter</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="p">)</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="k">return</span> <span class="n">attr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div><h2 id="hooks">Hooks<a class="headerlink" href="#hooks" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="hookedllm.hooks" class="doc doc-heading">
            <code>hooks</code>


<a href="#hookedllm.hooks" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Built-in hook helpers for common use cases.</p>










<div class="doc doc-children">







<h3 id="hookedllm.hooks-classes">Classes<a href="#hookedllm.hooks-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.hooks.EvaluationHook" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">EvaluationHook</span><span class="p">(</span><span class="n">evaluator_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;gpt-4o-mini&#39;</span><span class="p">,</span> <span class="n">store_in_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></code>

<a href="#hookedllm.hooks.EvaluationHook" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Evaluate LLM responses using another LLM.</p>
<p>This is an after hook that calls a separate "evaluator" LLM to assess
the quality of responses based on configurable criteria.</p>


<details class="usage" open>
  <summary>Usage</summary>
  <p>from openai import AsyncOpenAI</p>
<p>evaluator = AsyncOpenAI()  # Separate client for evaluation
criteria = {
    "clarity": "Is the response clear and easy to understand?",
    "accuracy": "Is the response factually accurate?",
    "relevance": "Does the response address the user's question?"
}</p>
<p>eval_hook = EvaluationHook(evaluator, criteria)
hookedllm.scope("evaluation").after(eval_hook)</p>
</details>
        <p>Initialize evaluation hook.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>evaluator_client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OpenAI-compatible client for evaluation calls</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>criteria</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping criterion name to description</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model to use for evaluation (default: gpt-4o-mini)</p>
              </div>
            </td>
            <td>
                  <code>&#39;gpt-4o-mini&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>store_in_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, store results in context.metadata</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/hooks/evaluation.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">evaluator_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">criteria</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">store_in_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="p">):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Initialize evaluation hook.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        evaluator_client: OpenAI-compatible client for evaluation calls</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        criteria: Dict mapping criterion name to description</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        model: Model to use for evaluation (default: gpt-4o-mini)</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        store_in_metadata: If True, store results in context.metadata</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">evaluator_client</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">store_in_metadata</span> <span class="o">=</span> <span class="n">store_in_metadata</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h5 id="hookedllm.hooks.EvaluationHook-functions">Functions<a href="#hookedllm.hooks.EvaluationHook-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.hooks.EvaluationHook.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.hooks.EvaluationHook.__call__" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Evaluate the LLM response.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The original call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_output</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM response</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/evaluation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Evaluate the LLM response.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        call_input: The original call input</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        call_output: The LLM response</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">call_output</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="c1"># Nothing to evaluate</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="k">return</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="c1"># Extract the original query</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">original_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_query</span><span class="p">(</span><span class="n">call_input</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="c1"># Build evaluation prompt</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">eval_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_evaluation_prompt</span><span class="p">(</span><span class="n">original_query</span><span class="p">,</span> <span class="n">call_output</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="c1"># Call evaluator</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">eval_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">eval_prompt</span><span class="p">}],</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="n">temperature</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Deterministic evaluation</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="c1"># Extract evaluation result</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">eval_text</span> <span class="o">=</span> <span class="n">eval_response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="c1"># Try to parse as JSON</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">eval_result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">eval_text</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="c1"># If not JSON, store raw text</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">eval_result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;raw_evaluation&quot;</span><span class="p">:</span> <span class="n">eval_text</span><span class="p">}</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="c1"># Store in context if requested</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_in_metadata</span><span class="p">:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">context</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;evaluation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eval_result</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">context</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;evaluation_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="c1"># Evaluation failed - don&#39;t break the main flow</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_in_metadata</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="n">context</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;evaluation_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.hooks.MetricsHook" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">MetricsHook</span><span class="p">(</span><span class="n">stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#hookedllm.hooks.MetricsHook" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Track metrics across LLM calls.</p>
<p>This is a finally hook that aggregates metrics including:
- Total calls
- Total tokens used
- Error count
- Average latency</p>


<details class="usage" open>
  <summary>Usage</summary>
  <p>metrics = MetricsHook()
hookedllm.finally_(metrics)</p>
<h5 id="hookedllm.hooks.MetricsHook--later-access-metrics">Later, access metrics<a class="headerlink" href="#hookedllm.hooks.MetricsHook--later-access-metrics" title="Permanent link">&para;</a></h5>
<p>print(metrics.stats)</p>
</details>
        <p>Initialize metrics hook.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>stats</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional existing stats dict to update.
   If None, creates a new dict.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    Initialize metrics hook.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        stats: Optional existing stats dict to update.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">               If None, creates a new dict.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="k">if</span> <span class="n">stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>            <span class="s2">&quot;total_calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>            <span class="s2">&quot;successful_calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="s2">&quot;failed_calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="s2">&quot;total_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="s2">&quot;prompt_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>            <span class="s2">&quot;completion_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="s2">&quot;total_latency_ms&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="p">}</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">





<h5 id="hookedllm.hooks.MetricsHook-attributes">Attributes<a href="#hookedllm.hooks.MetricsHook-attributes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-attribute">



<h6 id="hookedllm.hooks.MetricsHook.average_latency_ms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">average_latency_ms</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.hooks.MetricsHook.average_latency_ms" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Calculate average latency.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="hookedllm.hooks.MetricsHook.error_rate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">error_rate</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.hooks.MetricsHook.error_rate" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Calculate error rate (0.0 to 1.0).</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="hookedllm.hooks.MetricsHook.success_rate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">success_rate</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.hooks.MetricsHook.success_rate" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Calculate success rate (0.0 to 1.0).</p>

    </div>

</div>


<h5 id="hookedllm.hooks.MetricsHook-functions">Functions<a href="#hookedllm.hooks.MetricsHook-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.hooks.MetricsHook.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.hooks.MetricsHook.__call__" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Update metrics based on call result.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallResult(input: CallInput, output: CallOutput | None, context: CallContext, error: BaseException | None, ended_at: datetime, elapsed_ms: float)

  
      dataclass
   (hookedllm.core.types.CallResult)" href="#hookedllm.core.types.CallResult">CallResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complete call result</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Update metrics based on call result.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        result: The complete call result</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="c1"># Increment total calls</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;total_calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="c1"># Track success/failure</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;successful_calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;failed_calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="c1"># Track tokens</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">usage</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">usage</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">usage</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;total_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;prompt_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prompt_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;completion_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;completion_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="c1"># Track latency</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;total_latency_ms&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">result</span><span class="o">.</span><span class="n">elapsed_ms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.hooks.MetricsHook.reset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reset</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.hooks.MetricsHook.reset" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Reset all metrics to zero.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset all metrics to zero.&quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">:</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.hooks.MetricsHook.summary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">summary</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>

<a href="#hookedllm.hooks.MetricsHook.summary" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get a summary of metrics including calculated values.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict with all metrics plus calculated averages</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    Get a summary of metrics including calculated values.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        Dict with all metrics plus calculated averages</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="s2">&quot;average_latency_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_latency_ms</span><span class="p">,</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="s2">&quot;success_rate&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_rate</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="s2">&quot;error_rate&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_rate</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<h3 id="hookedllm.hooks-modules">Modules<a href="#hookedllm.hooks-modules" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.hooks.evaluation" class="doc doc-heading">
            <code>evaluation</code>


<a href="#hookedllm.hooks.evaluation" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Built-in evaluation hook helper.</p>
<p>Provides a helper for evaluating LLM responses using another LLM.</p>










<div class="doc doc-children">







<h5 id="hookedllm.hooks.evaluation-classes">Classes<a href="#hookedllm.hooks.evaluation-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.hooks.evaluation.EvaluationHook" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">EvaluationHook</span><span class="p">(</span><span class="n">evaluator_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;gpt-4o-mini&#39;</span><span class="p">,</span> <span class="n">store_in_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></code>

<a href="#hookedllm.hooks.evaluation.EvaluationHook" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Evaluate LLM responses using another LLM.</p>
<p>This is an after hook that calls a separate "evaluator" LLM to assess
the quality of responses based on configurable criteria.</p>


<details class="usage" open>
  <summary>Usage</summary>
  <p>from openai import AsyncOpenAI</p>
<p>evaluator = AsyncOpenAI()  # Separate client for evaluation
criteria = {
    "clarity": "Is the response clear and easy to understand?",
    "accuracy": "Is the response factually accurate?",
    "relevance": "Does the response address the user's question?"
}</p>
<p>eval_hook = EvaluationHook(evaluator, criteria)
hookedllm.scope("evaluation").after(eval_hook)</p>
</details>
        <p>Initialize evaluation hook.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>evaluator_client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OpenAI-compatible client for evaluation calls</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>criteria</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping criterion name to description</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model to use for evaluation (default: gpt-4o-mini)</p>
              </div>
            </td>
            <td>
                  <code>&#39;gpt-4o-mini&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>store_in_metadata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, store results in context.metadata</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/hooks/evaluation.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">evaluator_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">criteria</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">store_in_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="p">):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Initialize evaluation hook.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        evaluator_client: OpenAI-compatible client for evaluation calls</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        criteria: Dict mapping criterion name to description</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        model: Model to use for evaluation (default: gpt-4o-mini)</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        store_in_metadata: If True, store results in context.metadata</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">evaluator_client</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">store_in_metadata</span> <span class="o">=</span> <span class="n">store_in_metadata</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">








<h7 id="hookedllm.hooks.evaluation.EvaluationHook-functions">Functions<a href="#hookedllm.hooks.evaluation.EvaluationHook-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.hooks.evaluation.EvaluationHook.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.hooks.evaluation.EvaluationHook.__call__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Evaluate the LLM response.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>call_input</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The original call input</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>call_output</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM response</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The call context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/evaluation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">call_input</span><span class="p">:</span> <span class="n">CallInput</span><span class="p">,</span> <span class="n">call_output</span><span class="p">:</span> <span class="n">CallOutput</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">CallContext</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Evaluate the LLM response.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        call_input: The original call input</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        call_output: The LLM response</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        context: The call context</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">call_output</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="c1"># Nothing to evaluate</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="k">return</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="c1"># Extract the original query</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">original_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_query</span><span class="p">(</span><span class="n">call_input</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="c1"># Build evaluation prompt</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">eval_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_evaluation_prompt</span><span class="p">(</span><span class="n">original_query</span><span class="p">,</span> <span class="n">call_output</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="c1"># Call evaluator</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">eval_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">eval_prompt</span><span class="p">}],</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="n">temperature</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Deterministic evaluation</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="c1"># Extract evaluation result</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">eval_text</span> <span class="o">=</span> <span class="n">eval_response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="c1"># Try to parse as JSON</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">eval_result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">eval_text</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="c1"># If not JSON, store raw text</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">eval_result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;raw_evaluation&quot;</span><span class="p">:</span> <span class="n">eval_text</span><span class="p">}</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="c1"># Store in context if requested</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_in_metadata</span><span class="p">:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">context</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;evaluation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eval_result</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">context</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;evaluation_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="c1"># Evaluation failed - don&#39;t break the main flow</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_in_metadata</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="n">context</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;evaluation_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.hooks.metrics" class="doc doc-heading">
            <code>metrics</code>


<a href="#hookedllm.hooks.metrics" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Built-in metrics tracking hook.</p>
<p>Tracks token usage, call counts, and error rates across LLM calls.</p>










<div class="doc doc-children">







<h5 id="hookedllm.hooks.metrics-classes">Classes<a href="#hookedllm.hooks.metrics-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.hooks.metrics.MetricsHook" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">MetricsHook</span><span class="p">(</span><span class="n">stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#hookedllm.hooks.metrics.MetricsHook" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Track metrics across LLM calls.</p>
<p>This is a finally hook that aggregates metrics including:
- Total calls
- Total tokens used
- Error count
- Average latency</p>


<details class="usage" open>
  <summary>Usage</summary>
  <p>metrics = MetricsHook()
hookedllm.finally_(metrics)</p>
<h6 id="hookedllm.hooks.metrics.MetricsHook--later-access-metrics">Later, access metrics<a class="headerlink" href="#hookedllm.hooks.metrics.MetricsHook--later-access-metrics" title="Permanent link">&para;</a></h6>
<p>print(metrics.stats)</p>
</details>
        <p>Initialize metrics hook.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>stats</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional existing stats dict to update.
   If None, creates a new dict.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    Initialize metrics hook.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        stats: Optional existing stats dict to update.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">               If None, creates a new dict.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="k">if</span> <span class="n">stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>            <span class="s2">&quot;total_calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>            <span class="s2">&quot;successful_calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="s2">&quot;failed_calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="s2">&quot;total_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="s2">&quot;prompt_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>            <span class="s2">&quot;completion_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="s2">&quot;total_latency_ms&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="p">}</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">





<h7 id="hookedllm.hooks.metrics.MetricsHook-attributes">Attributes<a href="#hookedllm.hooks.metrics.MetricsHook-attributes" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-attribute">



<h8 id="hookedllm.hooks.metrics.MetricsHook.average_latency_ms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">average_latency_ms</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.hooks.metrics.MetricsHook.average_latency_ms" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Calculate average latency.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="hookedllm.hooks.metrics.MetricsHook.error_rate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">error_rate</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.hooks.metrics.MetricsHook.error_rate" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Calculate error rate (0.0 to 1.0).</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="hookedllm.hooks.metrics.MetricsHook.success_rate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">success_rate</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hookedllm.hooks.metrics.MetricsHook.success_rate" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Calculate success rate (0.0 to 1.0).</p>

    </div>

</div>


<h7 id="hookedllm.hooks.metrics.MetricsHook-functions">Functions<a href="#hookedllm.hooks.metrics.MetricsHook-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.hooks.metrics.MetricsHook.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#hookedllm.hooks.metrics.MetricsHook.__call__" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Update metrics based on call result.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>result</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallResult(input: CallInput, output: CallOutput | None, context: CallContext, error: BaseException | None, ended_at: datetime, elapsed_ms: float)

  
      dataclass
   (hookedllm.core.types.CallResult)" href="#hookedllm.core.types.CallResult">CallResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complete call result</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">CallResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Update metrics based on call result.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        result: The complete call result</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="c1"># Increment total calls</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;total_calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="c1"># Track success/failure</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;successful_calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;failed_calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="c1"># Track tokens</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">usage</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">usage</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">usage</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;total_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;prompt_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prompt_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;completion_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;completion_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="c1"># Track latency</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;total_latency_ms&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">result</span><span class="o">.</span><span class="n">elapsed_ms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.hooks.metrics.MetricsHook.reset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reset</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.hooks.metrics.MetricsHook.reset" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Reset all metrics to zero.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset all metrics to zero.&quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">:</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.hooks.metrics.MetricsHook.summary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">summary</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>

<a href="#hookedllm.hooks.metrics.MetricsHook.summary" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get a summary of metrics including calculated values.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict with all metrics plus calculated averages</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/hooks/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    Get a summary of metrics including calculated values.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        Dict with all metrics plus calculated averages</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="s2">&quot;average_latency_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_latency_ms</span><span class="p">,</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="s2">&quot;success_rate&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_rate</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="s2">&quot;error_rate&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_rate</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div><h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="hookedllm.config" class="doc doc-heading">
            <code>config</code>


<a href="#hookedllm.config" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Configuration loading for hookedllm.</p>
<p>Provides YAML-based configuration loading (requires pyyaml).</p>










<div class="doc doc-children">







<h3 id="hookedllm.config-classes">Classes<a href="#hookedllm.config-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.config.HookConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">HookConfig</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;finally&#39;</span><span class="p">],</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">function</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">WhenConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.HookConfig" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Single hook configuration from YAML.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.config.RootConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">RootConfig</span><span class="p">(</span><span class="n">global_hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HookConfig</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ScopeConfig</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.RootConfig" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Root configuration schema.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.config.ScopeConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">ScopeConfig</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HookConfig</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.ScopeConfig" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Scope configuration with its hooks.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.config.WhenConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">WhenConfig</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">all_calls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.WhenConfig" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">



        <p>Rule configuration from YAML.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>
<h3 id="hookedllm.config-functions">Functions<a href="#hookedllm.config-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="hookedllm.config.load_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_config</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.config.load_config" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Load hooks from a YAML configuration file.</p>
<p>Requires pyyaml: pip install hookedllm[config]</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML config file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional HookedLLMContext to use (default: uses default context)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example-yaml" open>
  <summary>Example YAML</summary>
  <p>global_hooks:
  - name: metrics
    type: finally
    module: hookedllm.hooks.metrics
    class_name: MetricsHook</p>
<p>scopes:
  evaluation:
    hooks:
      - name: evaluate
        type: after
        module: my_app.hooks
        function: evaluate_response
        when:
          model: gpt-4</p>
</details>

<details class="example-usage" open>
  <summary>Example usage</summary>
  <p>import hookedllm
hookedllm.load_config("hooks.yaml")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/config/loader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_config</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    Load hooks from a YAML configuration file.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    Requires pyyaml: pip install hookedllm[config]</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        path: Path to YAML config file</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        context: Optional HookedLLMContext to use (default: uses default context)</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Example YAML:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        global_hooks:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">          - name: metrics</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">            type: finally</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">            module: hookedllm.hooks.metrics</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">            class_name: MetricsHook</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        scopes:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">          evaluation:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            hooks:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">              - name: evaluate</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">                type: after</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                module: my_app.hooks</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                function: evaluate_response</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                when:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                  model: gpt-4</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Example usage:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        import hookedllm</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        hookedllm.load_config(&quot;hooks.yaml&quot;)</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="s2">&quot;PyYAML is required for config loading. &quot;</span> <span class="s2">&quot;Install with: pip install hookedllm[config]&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="c1"># Load YAML file</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="n">config_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">config_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config file not found: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="k">return</span>  <span class="c1"># Empty config</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="c1"># Use provided context or default</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">hookedllm</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">ctx</span> <span class="o">=</span> <span class="n">hookedllm</span><span class="o">.</span><span class="n">_default_context</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="c1"># Load global hooks</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="k">if</span> <span class="s2">&quot;global_hooks&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;global_hooks&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">for</span> <span class="n">hook_config</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;global_hooks&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="n">_register_hook_from_config</span><span class="p">(</span><span class="n">hook_config</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">global_scope</span><span class="p">(),</span> <span class="n">ctx</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="c1"># Load scoped hooks</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">if</span> <span class="s2">&quot;scopes&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;scopes&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="k">for</span> <span class="n">scope_name</span><span class="p">,</span> <span class="n">scope_data</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;scopes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">scope</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">scope</span><span class="p">(</span><span class="n">scope_name</span><span class="p">)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="k">if</span> <span class="s2">&quot;hooks&quot;</span> <span class="ow">in</span> <span class="n">scope_data</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>                <span class="k">for</span> <span class="n">hook_config</span> <span class="ow">in</span> <span class="n">scope_data</span><span class="p">[</span><span class="s2">&quot;hooks&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>                    <span class="n">_register_hook_from_config</span><span class="p">(</span><span class="n">hook_config</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h3 id="hookedllm.config-modules">Modules<a href="#hookedllm.config-modules" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.config.loader" class="doc doc-heading">
            <code>loader</code>


<a href="#hookedllm.config.loader" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>YAML configuration loader for hookedllm.</p>
<p>Loads hook configurations from YAML files and registers them.</p>










<div class="doc doc-children">







<h5 id="hookedllm.config.loader-classes">Classes<a href="#hookedllm.config.loader-classes" class="headerlink" title="Permanent link">&para;</a></h5>
<h5 id="hookedllm.config.loader-functions">Functions<a href="#hookedllm.config.loader-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.config.loader.load_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_config</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

<a href="#hookedllm.config.loader.load_config" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Load hooks from a YAML configuration file.</p>
<p>Requires pyyaml: pip install hookedllm[config]</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML config file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional HookedLLMContext to use (default: uses default context)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example-yaml" open>
  <summary>Example YAML</summary>
  <p>global_hooks:
  - name: metrics
    type: finally
    module: hookedllm.hooks.metrics
    class_name: MetricsHook</p>
<p>scopes:
  evaluation:
    hooks:
      - name: evaluate
        type: after
        module: my_app.hooks
        function: evaluate_response
        when:
          model: gpt-4</p>
</details>

<details class="example-usage" open>
  <summary>Example usage</summary>
  <p>import hookedllm
hookedllm.load_config("hooks.yaml")</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/config/loader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_config</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    Load hooks from a YAML configuration file.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    Requires pyyaml: pip install hookedllm[config]</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        path: Path to YAML config file</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        context: Optional HookedLLMContext to use (default: uses default context)</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Example YAML:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        global_hooks:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">          - name: metrics</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">            type: finally</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">            module: hookedllm.hooks.metrics</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">            class_name: MetricsHook</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        scopes:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">          evaluation:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            hooks:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">              - name: evaluate</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">                type: after</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                module: my_app.hooks</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                function: evaluate_response</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                when:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                  model: gpt-4</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Example usage:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        import hookedllm</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        hookedllm.load_config(&quot;hooks.yaml&quot;)</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="s2">&quot;PyYAML is required for config loading. &quot;</span> <span class="s2">&quot;Install with: pip install hookedllm[config]&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="c1"># Load YAML file</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="n">config_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">config_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config file not found: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="k">return</span>  <span class="c1"># Empty config</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="c1"># Use provided context or default</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">hookedllm</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">ctx</span> <span class="o">=</span> <span class="n">hookedllm</span><span class="o">.</span><span class="n">_default_context</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="c1"># Load global hooks</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="k">if</span> <span class="s2">&quot;global_hooks&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;global_hooks&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">for</span> <span class="n">hook_config</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;global_hooks&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="n">_register_hook_from_config</span><span class="p">(</span><span class="n">hook_config</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">global_scope</span><span class="p">(),</span> <span class="n">ctx</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="c1"># Load scoped hooks</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">if</span> <span class="s2">&quot;scopes&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;scopes&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="k">for</span> <span class="n">scope_name</span><span class="p">,</span> <span class="n">scope_data</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;scopes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">scope</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">scope</span><span class="p">(</span><span class="n">scope_name</span><span class="p">)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="k">if</span> <span class="s2">&quot;hooks&quot;</span> <span class="ow">in</span> <span class="n">scope_data</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>                <span class="k">for</span> <span class="n">hook_config</span> <span class="ow">in</span> <span class="n">scope_data</span><span class="p">[</span><span class="s2">&quot;hooks&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>                    <span class="n">_register_hook_from_config</span><span class="p">(</span><span class="n">hook_config</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.config.schema" class="doc doc-heading">
            <code>schema</code>


<a href="#hookedllm.config.schema" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Configuration schema for YAML-based hook registration.</p>
<p>Defines the structure of YAML configuration files.</p>










<div class="doc doc-children">







<h5 id="hookedllm.config.schema-classes">Classes<a href="#hookedllm.config.schema-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.config.schema.HookConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">HookConfig</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;finally&#39;</span><span class="p">],</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">function</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="n">WhenConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.schema.HookConfig" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Single hook configuration from YAML.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.config.schema.RootConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">RootConfig</span><span class="p">(</span><span class="n">global_hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HookConfig</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ScopeConfig</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.schema.RootConfig" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Root configuration schema.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.config.schema.ScopeConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">ScopeConfig</span><span class="p">(</span><span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HookConfig</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.schema.ScopeConfig" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Scope configuration with its hooks.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.config.schema.WhenConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">WhenConfig</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">all_calls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hookedllm.config.schema.WhenConfig" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Rule configuration from YAML.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div><h2 id="providers">Providers<a class="headerlink" href="#providers" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="hookedllm.providers" class="doc doc-heading">
            <code>providers</code>


<a href="#hookedllm.providers" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Provider adapters for multi-provider support.</p>
<p>Each adapter handles provider-specific logic for detecting clients,
normalizing input/output, and extracting callable methods.</p>










<div class="doc doc-children">







<h3 id="hookedllm.providers-classes">Classes<a href="#hookedllm.providers-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="hookedllm.providers.ProviderAdapter" class="doc doc-heading">
            <code>ProviderAdapter</code>


<a href="#hookedllm.providers.ProviderAdapter" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for provider-specific adapters.</p>
<p>Each adapter handles:
- Detecting if a client belongs to this provider
- Normalizing provider-specific input/output formats
- Extracting the callable method from the client</p>
<p>This follows the Open/Closed Principle: new providers can be added
by implementing this protocol without modifying existing code.</p>











<div class="doc doc-children">








<h5 id="hookedllm.providers.ProviderAdapter-functions">Functions<a href="#hookedllm.providers.ProviderAdapter-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.providers.ProviderAdapter.detect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.ProviderAdapter.detect" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Detect if a client belongs to this provider.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if this adapter can handle the client, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Detect if a client belongs to this provider.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        client: The client instance to check</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        True if this adapter can handle the client, False otherwise</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.providers.ProviderAdapter.get_callable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.ProviderAdapter.get_callable" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get the callable method from the client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The callable method (e.g., client.chat.completions.create)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AttributeError">AttributeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the callable cannot be found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Get the callable method from the client.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        client: The client instance</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        The callable method (e.g., client.chat.completions.create)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        AttributeError: If the callable cannot be found</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.providers.ProviderAdapter.get_wrapper_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.ProviderAdapter.get_wrapper_path" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get the attribute path to wrap (e.g., ["chat", "completions"]).</p>
<p>This is used by the wrapper to intercept the correct attributes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of attribute names to wrap</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    Get the attribute path to wrap (e.g., [&quot;chat&quot;, &quot;completions&quot;]).</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    This is used by the wrapper to intercept the correct attributes.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        client: The client instance</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        List of attribute names to wrap</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.providers.ProviderAdapter.normalize_input" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_input</span><span class="p">(</span><span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.ProviderAdapter.normalize_input" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Normalize provider-specific input to CallInput and CallContext.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>provider_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the provider (e.g., "openai", "anthropic")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callable_method</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The callable method being called</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Positional arguments passed to the callable</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments passed to the callable</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a>, <a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (CallInput, CallContext)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_input</span><span class="p">(</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Normalize provider-specific input to CallInput and CallContext.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        provider_name: Name of the provider (e.g., &quot;openai&quot;, &quot;anthropic&quot;)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        callable_method: The callable method being called</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        *args: Positional arguments passed to the callable</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        **kwargs: Keyword arguments passed to the callable</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        Tuple of (CallInput, CallContext)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="hookedllm.providers.ProviderAdapter.normalize_output" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.ProviderAdapter.normalize_output" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Normalize provider-specific response to CallOutput.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>response</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The raw response from the provider SDK</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized CallOutput</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span><span class="p">:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    Normalize provider-specific response to CallOutput.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        response: The raw response from the provider SDK</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Normalized CallOutput</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<h3 id="hookedllm.providers-modules">Modules<a href="#hookedllm.providers-modules" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.providers.anthropic" class="doc doc-heading">
            <code>anthropic</code>


<a href="#hookedllm.providers.anthropic" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Anthropic provider adapter.</p>
<p>Handles Anthropic SDK-specific logic for detecting clients,
normalizing input/output, and extracting callable methods.</p>










<div class="doc doc-children">







<h5 id="hookedllm.providers.anthropic-classes">Classes<a href="#hookedllm.providers.anthropic-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.providers.anthropic.AnthropicAdapter" class="doc doc-heading">
            <code>AnthropicAdapter</code>


<a href="#hookedllm.providers.anthropic.AnthropicAdapter" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Adapter for Anthropic SDK clients.</p>
<p>Supports both AsyncAnthropic and Anthropic clients.
Handles the Anthropic-specific API structure: client.messages.create()</p>











<div class="doc doc-children">








<h7 id="hookedllm.providers.anthropic.AnthropicAdapter-functions">Functions<a href="#hookedllm.providers.anthropic.AnthropicAdapter-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.anthropic.AnthropicAdapter.detect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.anthropic.AnthropicAdapter.detect" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Detect if a client is an Anthropic client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if client has Anthropic SDK structure, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/anthropic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    Detect if a client is an Anthropic client.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        client: The client instance to check</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        True if client has Anthropic SDK structure, False otherwise</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="c1"># Check for Anthropic structure</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="c1"># Must have messages.create and it should be callable</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">):</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="c1"># Verify it&#39;s actually callable (not just a MagicMock attribute)</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>            <span class="n">create_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">create_method</span><span class="p">):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>                <span class="c1"># Additional check: if client also has OpenAI structure (chat.completions.create),</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>                <span class="c1"># we need to prefer Anthropic only if messages.create was explicitly set</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>                <span class="c1"># For MagicMock, check if chat.completions.create exists - if it does and is callable,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>                <span class="c1"># we need to verify which one was set explicitly</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>                <span class="c1"># Since Anthropic is checked first, if both exist, prefer Anthropic</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>                <span class="c1"># But we should verify messages.create is the primary structure</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>                <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="k">pass</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.anthropic.AnthropicAdapter.get_callable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.anthropic.AnthropicAdapter.get_callable" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the Anthropic messages.create callable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Anthropic client instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The messages.create method</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AttributeError">AttributeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the callable cannot be found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/anthropic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    Get the Anthropic messages.create callable.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        client: The Anthropic client instance</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        The messages.create method</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        AttributeError: If the callable cannot be found</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">create</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.anthropic.AnthropicAdapter.get_wrapper_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.anthropic.AnthropicAdapter.get_wrapper_path" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the attribute path to wrap for Anthropic.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>["messages"] - the path to intercept</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/anthropic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    Get the attribute path to wrap for Anthropic.</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        [&quot;messages&quot;] - the path to intercept</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.anthropic.AnthropicAdapter.normalize_input" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_input</span><span class="p">(</span><span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.anthropic.AnthropicAdapter.normalize_input" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Normalize Anthropic input to CallInput and CallContext.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>provider_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Provider name (should be "anthropic")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callable_method</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The callable method (unused for Anthropic)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Positional arguments (unused for Anthropic)</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments including model, messages, etc.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a>, <a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (CallInput, CallContext)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/anthropic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_input</span><span class="p">(</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    Normalize Anthropic input to CallInput and CallContext.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        provider_name: Provider name (should be &quot;anthropic&quot;)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        callable_method: The callable method (unused for Anthropic)</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        *args: Positional arguments (unused for Anthropic)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        **kwargs: Keyword arguments including model, messages, etc.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        Tuple of (CallInput, CallContext)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">messages</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;messages&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="c1"># Anthropic uses metadata parameter instead of extra_body</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="n">metadata_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">tags</span> <span class="o">=</span> <span class="n">metadata_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;hookedllm_tags&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">custom_metadata</span> <span class="o">=</span> <span class="n">metadata_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;hookedllm_metadata&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">custom_metadata</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="c1"># Normalize messages to internal format</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="c1"># Anthropic messages have role and content fields</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">normalized_messages</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">role</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="c1"># Anthropic content can be a string or list of content blocks</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">content</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="c1"># Extract text from first text block if it&#39;s a list</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="n">first_block</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_block</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">first_block</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">first_block</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_block</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="n">content</span> <span class="o">=</span> <span class="n">first_block</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">normalized_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Message</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">))</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="c1"># Create normalized input</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">call_input</span> <span class="o">=</span> <span class="n">CallInput</span><span class="p">(</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">normalized_messages</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">custom_metadata</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="c1"># Create context</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="n">context</span> <span class="o">=</span> <span class="n">CallContext</span><span class="p">(</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">provider</span><span class="o">=</span><span class="n">provider_name</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">custom_metadata</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="k">return</span> <span class="n">call_input</span><span class="p">,</span> <span class="n">context</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.anthropic.AnthropicAdapter.normalize_output" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.anthropic.AnthropicAdapter.normalize_output" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Normalize Anthropic response to CallOutput.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>response</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Anthropic SDK response object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized CallOutput</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/anthropic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    Normalize Anthropic response to CallOutput.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        response: Anthropic SDK response object</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        Normalized CallOutput</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="c1"># Extract text from response</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="c1"># Anthropic response has content as a list of content blocks</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">text</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="n">first_content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_content</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">first_content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">first_content</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">first_content</span><span class="o">.</span><span class="n">text</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="c1"># Extract usage</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="c1"># Anthropic uses input_tokens and output_tokens</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="n">usage</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;usage&quot;</span><span class="p">):</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="n">usage_obj</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">usage</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;input_tokens&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;output_tokens&quot;</span><span class="p">):</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                <span class="c1"># Convert to dict format</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;model_dump&quot;</span><span class="p">):</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                    <span class="n">usage</span> <span class="o">=</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;dict&quot;</span><span class="p">):</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                    <span class="n">usage</span> <span class="o">=</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;__dict__&quot;</span><span class="p">):</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                    <span class="n">usage</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">usage_obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                    <span class="c1"># Fallback: create dict manually</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                    <span class="n">usage</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                        <span class="s2">&quot;input_tokens&quot;</span><span class="p">:</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">input_tokens</span><span class="p">,</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                        <span class="s2">&quot;output_tokens&quot;</span><span class="p">:</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">output_tokens</span><span class="p">,</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                        <span class="s2">&quot;total_tokens&quot;</span><span class="p">:</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">input_tokens</span> <span class="o">+</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">output_tokens</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                    <span class="p">}</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                <span class="c1"># Ensure total_tokens is present</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="k">if</span> <span class="n">usage</span> <span class="ow">and</span> <span class="s2">&quot;total_tokens&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">usage</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                    <span class="n">usage</span><span class="p">[</span><span class="s2">&quot;total_tokens&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;input_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                        <span class="s2">&quot;output_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                    <span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="c1"># Extract stop_reason (Anthropic&#39;s finish_reason)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">finish_reason</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;stop_reason&quot;</span><span class="p">):</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="n">finish_reason</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">stop_reason</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="k">return</span> <span class="n">CallOutput</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">,</span> <span class="n">finish_reason</span><span class="o">=</span><span class="n">finish_reason</span><span class="p">)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="c1"># If normalization fails, return minimal output with raw response</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="k">return</span> <span class="n">CallOutput</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">finish_reason</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.providers.openai" class="doc doc-heading">
            <code>openai</code>


<a href="#hookedllm.providers.openai" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>OpenAI provider adapter.</p>
<p>Handles OpenAI SDK-specific logic for detecting clients,
normalizing input/output, and extracting callable methods.</p>










<div class="doc doc-children">







<h5 id="hookedllm.providers.openai-classes">Classes<a href="#hookedllm.providers.openai-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.providers.openai.OpenAIAdapter" class="doc doc-heading">
            <code>OpenAIAdapter</code>


<a href="#hookedllm.providers.openai.OpenAIAdapter" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">



        <p>Adapter for OpenAI SDK clients.</p>
<p>Supports both AsyncOpenAI and OpenAI clients.
Handles the OpenAI-specific API structure: client.chat.completions.create()</p>











<div class="doc doc-children">








<h7 id="hookedllm.providers.openai.OpenAIAdapter-functions">Functions<a href="#hookedllm.providers.openai.OpenAIAdapter-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.openai.OpenAIAdapter.detect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.openai.OpenAIAdapter.detect" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Detect if a client is an OpenAI client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if client has OpenAI SDK structure, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/openai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    Detect if a client is an OpenAI client.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        client: The client instance to check</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        True if client has OpenAI SDK structure, False otherwise</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="c1"># Check for OpenAI structure</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="c1"># Must have chat.completions.create and it should be callable</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="c1"># Use getattr with sentinel to avoid MagicMock auto-creation</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="n">_SENTINEL</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="c1"># Check for OpenAI structure</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="n">chat</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s2">&quot;chat&quot;</span><span class="p">,</span> <span class="n">_SENTINEL</span><span class="p">)</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="k">if</span> <span class="n">chat</span> <span class="ow">is</span> <span class="n">_SENTINEL</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="n">completions</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">chat</span><span class="p">,</span> <span class="s2">&quot;completions&quot;</span><span class="p">,</span> <span class="n">_SENTINEL</span><span class="p">)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="k">if</span> <span class="n">completions</span> <span class="ow">is</span> <span class="n">_SENTINEL</span><span class="p">:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="n">create_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">completions</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="n">_SENTINEL</span><span class="p">)</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="k">if</span> <span class="n">create_method</span> <span class="ow">is</span> <span class="n">_SENTINEL</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">create_method</span><span class="p">):</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="c1"># Check if it also has Anthropic structure</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="c1"># If both exist, Anthropic should have matched first</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="c1"># But if Anthropic didn&#39;t match, it means messages.create wasn&#39;t properly set</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="c1"># So we can match OpenAI</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="c1"># However, to avoid false positives with MagicMock, we check:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="c1"># If messages.create exists and is callable, don&#39;t match OpenAI</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="c1"># (Anthropic should have matched if it was properly set)</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="n">messages</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">,</span> <span class="n">_SENTINEL</span><span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="k">if</span> <span class="n">messages</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_SENTINEL</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="n">messages_create</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="n">_SENTINEL</span><span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="k">if</span> <span class="n">messages_create</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_SENTINEL</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">messages_create</span><span class="p">):</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="c1"># Both structures exist - since Anthropic is checked first,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                <span class="c1"># if we get here, Anthropic didn&#39;t match, which means messages.create</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>                <span class="c1"># was auto-created by MagicMock. So we should still match OpenAI.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                <span class="c1"># But to be safe, if both are properly callable, prefer Anthropic</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                <span class="c1"># Actually, let&#39;s be conservative: if both exist, don&#39;t match OpenAI</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">pass</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.openai.OpenAIAdapter.get_callable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.openai.OpenAIAdapter.get_callable" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the OpenAI completions.create callable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The OpenAI client instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The chat.completions.create method</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AttributeError">AttributeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the callable cannot be found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/openai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Get the OpenAI completions.create callable.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        client: The OpenAI client instance</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        The chat.completions.create method</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        AttributeError: If the callable cannot be found</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.openai.OpenAIAdapter.get_wrapper_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.openai.OpenAIAdapter.get_wrapper_path" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the attribute path to wrap for OpenAI.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>["chat", "completions"] - the path to intercept</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/openai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    Get the attribute path to wrap for OpenAI.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        [&quot;chat&quot;, &quot;completions&quot;] - the path to intercept</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;chat&quot;</span><span class="p">,</span> <span class="s2">&quot;completions&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.openai.OpenAIAdapter.normalize_input" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_input</span><span class="p">(</span><span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.openai.OpenAIAdapter.normalize_input" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Normalize OpenAI input to CallInput and CallContext.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>provider_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Provider name (should be "openai")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callable_method</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The callable method (unused for OpenAI)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Positional arguments (unused for OpenAI)</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments including model, messages, etc.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a>, <a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (CallInput, CallContext)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/openai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_input</span><span class="p">(</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    Normalize OpenAI input to CallInput and CallContext.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        provider_name: Provider name (should be &quot;openai&quot;)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        callable_method: The callable method (unused for OpenAI)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        *args: Positional arguments (unused for OpenAI)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        **kwargs: Keyword arguments including model, messages, etc.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        Tuple of (CallInput, CallContext)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">messages</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;messages&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="c1"># Extract hookedllm-specific params from extra_body</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">extra_body</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extra_body&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">extra_body</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">tags</span> <span class="o">=</span> <span class="n">extra_body</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;hookedllm_tags&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">extra_body</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;hookedllm_metadata&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="c1"># Normalize messages to internal format</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="n">normalized_messages</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">Message</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">content</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">messages</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="p">]</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="c1"># Create normalized input</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="n">call_input</span> <span class="o">=</span> <span class="n">CallInput</span><span class="p">(</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">normalized_messages</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="c1"># Create context</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">context</span> <span class="o">=</span> <span class="n">CallContext</span><span class="p">(</span><span class="n">provider</span><span class="o">=</span><span class="n">provider_name</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">return</span> <span class="n">call_input</span><span class="p">,</span> <span class="n">context</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.openai.OpenAIAdapter.normalize_output" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.openai.OpenAIAdapter.normalize_output" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Normalize OpenAI response to CallOutput.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>response</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OpenAI SDK response object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized CallOutput</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/openai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    Normalize OpenAI response to CallOutput.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        response: OpenAI SDK response object</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        Normalized CallOutput</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="c1"># Extract text from response</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">text</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;choices&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">choice</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">choice</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">):</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="n">text</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="c1"># Extract usage</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="n">usage</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;usage&quot;</span><span class="p">):</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="c1"># Try to convert to dict</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">usage_obj</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">usage</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;model_dump&quot;</span><span class="p">):</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="n">usage</span> <span class="o">=</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;dict&quot;</span><span class="p">):</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                <span class="n">usage</span> <span class="o">=</span> <span class="n">usage_obj</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage_obj</span><span class="p">,</span> <span class="s2">&quot;__dict__&quot;</span><span class="p">):</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                <span class="n">usage</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">usage_obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="c1"># Extract finish_reason</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">finish_reason</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;choices&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">finish_reason</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;finish_reason&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="k">return</span> <span class="n">CallOutput</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">,</span> <span class="n">finish_reason</span><span class="o">=</span><span class="n">finish_reason</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="c1"># If normalization fails, return minimal output with raw response</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="k">return</span> <span class="n">CallOutput</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">finish_reason</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="hookedllm.providers.protocol" class="doc doc-heading">
            <code>protocol</code>


<a href="#hookedllm.providers.protocol" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Provider adapter protocol for multi-provider support.</p>
<p>Defines the interface that all provider adapters must implement,
following the Dependency Inversion Principle.</p>










<div class="doc doc-children">







<h5 id="hookedllm.providers.protocol-classes">Classes<a href="#hookedllm.providers.protocol-classes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-class">



<h6 id="hookedllm.providers.protocol.ProviderAdapter" class="doc doc-heading">
            <code>ProviderAdapter</code>


<a href="#hookedllm.providers.protocol.ProviderAdapter" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for provider-specific adapters.</p>
<p>Each adapter handles:
- Detecting if a client belongs to this provider
- Normalizing provider-specific input/output formats
- Extracting the callable method from the client</p>
<p>This follows the Open/Closed Principle: new providers can be added
by implementing this protocol without modifying existing code.</p>











<div class="doc doc-children">








<h7 id="hookedllm.providers.protocol.ProviderAdapter-functions">Functions<a href="#hookedllm.providers.protocol.ProviderAdapter-functions" class="headerlink" title="Permanent link">&para;</a></h7>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.protocol.ProviderAdapter.detect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.protocol.ProviderAdapter.detect" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Detect if a client belongs to this provider.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if this adapter can handle the client, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Detect if a client belongs to this provider.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        client: The client instance to check</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        True if this adapter can handle the client, False otherwise</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.protocol.ProviderAdapter.get_callable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.protocol.ProviderAdapter.get_callable" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the callable method from the client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The callable method (e.g., client.chat.completions.create)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AttributeError">AttributeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the callable cannot be found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_callable</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Get the callable method from the client.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        client: The client instance</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        The callable method (e.g., client.chat.completions.create)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        AttributeError: If the callable cannot be found</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.protocol.ProviderAdapter.get_wrapper_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.protocol.ProviderAdapter.get_wrapper_path" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Get the attribute path to wrap (e.g., ["chat", "completions"]).</p>
<p>This is used by the wrapper to intercept the correct attributes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The client instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of attribute names to wrap</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_wrapper_path</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    Get the attribute path to wrap (e.g., [&quot;chat&quot;, &quot;completions&quot;]).</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    This is used by the wrapper to intercept the correct attributes.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        client: The client instance</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        List of attribute names to wrap</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.protocol.ProviderAdapter.normalize_input" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_input</span><span class="p">(</span><span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.protocol.ProviderAdapter.normalize_input" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Normalize provider-specific input to CallInput and CallContext.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>provider_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the provider (e.g., "openai", "anthropic")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callable_method</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The callable method being called</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Positional arguments passed to the callable</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments passed to the callable</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="CallInput(model: str, messages: Sequence[Message], params: dict[str, Any] = dict(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallInput)" href="#hookedllm.core.types.CallInput">CallInput</a>, <a class="autorefs autorefs-internal" title="CallContext(call_id: str = (lambda: str(uuid4()))(), parent_id: str | None = None, provider: str = '', model: str = '', route: str = 'chat', tags: list[str] = list(), started_at: datetime = (lambda: datetime.now(timezone.utc))(), metadata: dict[str, Any] = dict())

  
      dataclass
   (hookedllm.core.types.CallContext)" href="#hookedllm.core.types.CallContext">CallContext</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (CallInput, CallContext)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_input</span><span class="p">(</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callable_method</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CallInput</span><span class="p">,</span> <span class="n">CallContext</span><span class="p">]:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Normalize provider-specific input to CallInput and CallContext.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        provider_name: Name of the provider (e.g., &quot;openai&quot;, &quot;anthropic&quot;)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        callable_method: The callable method being called</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        *args: Positional arguments passed to the callable</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        **kwargs: Keyword arguments passed to the callable</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        Tuple of (CallInput, CallContext)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="hookedllm.providers.protocol.ProviderAdapter.normalize_output" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#hookedllm.providers.protocol.ProviderAdapter.normalize_output" class="headerlink" title="Permanent link">&para;</a></h8>


    <div class="doc doc-contents ">

        <p>Normalize provider-specific response to CallOutput.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>response</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The raw response from the provider SDK</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CallOutput(text: str | None, raw: Any, usage: dict[str, Any] | None = None, finish_reason: str | None = None)

  
      dataclass
   (hookedllm.core.types.CallOutput)" href="#hookedllm.core.types.CallOutput">CallOutput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized CallOutput</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/hookedllm/providers/protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_output</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOutput</span><span class="p">:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    Normalize provider-specific response to CallOutput.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        response: The raw response from the provider SDK</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Normalized CallOutput</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.code.annotate", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>